!function(t){t.getitembycls=function(t,i){return Laya.Pool.getItemByClass(t,i)},t.recover=function(t,i){return Laya.Pool.recover(t,i)},t.clearbysign=function(t){Laya.Pool.clearBySign(t)}}(utils||(utils={})),function(t){var i=function(){function i(){this.m_dir=0,this.m_framecount=0,this.m_ptcount=0,this.m_pt_arr=null,this.m_pt_max=4,this.m_invalid_pt=new Laya.Point(0,0),this.init()}return i.prototype.init=function(){this.m_pt_arr=new Array;for(var t=0;t<this.m_pt_max;++t)this.m_pt_arr.push(new Array)},i.prototype.dispose=function(){},i.prototype.add_pt=function(t,i,e){this.m_pt_arr[t].push(new Laya.Point(i,e))},i.prototype.get_pt=function(t,i){return i>=this.m_pt_arr[t].length?this.m_pt_arr[t].length<=0?this.m_invalid_pt:this.m_pt_arr[t][i%this.m_pt_arr[t].length]:this.m_pt_arr[t][i]},i.prototype.print_data=function(){for(var i=0;i<this.m_pt_max;++i){for(var e="ptidx "+i.toString()+" ",_=0;_<this.m_pt_arr[i].length;++_)e=e+this.m_pt_arr[i][_].x.toString()+","+this.m_pt_arr[i][_].y.toString()+" ";t.core_tiplog("avatardirlink ",e)}},i}();t.avatardirlink=i;var e=function(){function e(){this.m_id=0,this.m_action=0,this.m_sign=0,this.m_sign_txt="",this.m_version=0,this.m_dircount=0,this.m_dir_max=8,this.m_dir_arr=null,this.init()}return e.prototype.print_data=function(){t.core_tiplog("avatarlink ",this.m_id,this.m_version,this.m_dircount);for(var i=0;i<this.m_dir_max;++i){var e=this.m_dir_arr[i];t.core_tiplog("dir data:",e.m_dir,e.m_framecount,e.m_ptcount),e.print_data()}},e.prototype.dispose=function(){if(null!=this.m_dir_arr){for(var t=0;t<this.m_dir_arr.length;++t)utils.recover("avatardirlink",this.m_dir_arr[t]);this.m_dir_arr=null}},e.prototype.get_pt=function(t,i,e){return this.m_dir_arr[t].get_pt(i,e)},e.prototype.init=function(){this.dispose(),this.m_dir_arr=new Array;for(var t=0;t<this.m_dir_max;++t){var e=utils.getitembycls("avatardirlink",i);e.init(),this.m_dir_arr.push(e)}},e.prototype.set_txt_buff=function(i,e){var _=i.getUTFBytes(e),r=_.split("\r\n");if(r.length<3)t.core_errlog("avatar_link set_txt_buff error line_arr.length < 3 ",_);else{var n=null,s=0;this.m_sign_txt=r[s];var a=r[s+=1];n=a.split(":"),this.m_version=parseInt(n[1]),n=(a=r[s+=1]).split(":"),this.m_dircount=parseInt(n[1]),s+=1;for(var o=0;o<this.m_dircount;++o){n=(a=r[s]).split(":");var m=parseInt(n[1]);n=(a=r[s+=1]).split(":");var h=parseInt(n[1]);n=(a=r[s+=1]).split(":");var l=parseInt(n[1]);s+=1,this.m_dir_arr[m].m_dir=m,this.m_dir_arr[m].m_framecount=h,this.m_dir_arr[m].m_ptcount=l,this.m_dir_arr[m].init();for(var c=0;c<l;++c){n=(a=r[s]).split(":");var p=parseInt(n[1]);s+=1;for(var u=0;u<h;++u){n=(a=r[s]).split(","),s+=1;var d=parseInt(n[0]),f=parseInt(n[1]);this.m_dir_arr[m].add_pt(p,d,f)}}}}},e.prototype.set_buff=function(t,i){this.m_sign=t.getUint32(),this.m_version=t.getUint8(),this.m_dircount=t.getUint8();for(var e=0;e<this.m_dircount;++e){var _=t.getUint8(),r=t.getUint8(),n=t.getUint8();this.m_dir_arr[_].m_dir=_,this.m_dir_arr[_].m_framecount=r,this.m_dir_arr[_].m_ptcount=n,this.m_dir_arr[_].init();for(var s=0;s<n;++s)for(var a=t.getUint8(),o=0;o<r;++o){var m=t.getUint16(),h=t.getUint16();this.m_dir_arr[_].add_pt(a,m,h)}}},e}();t.avatarlink=e}(core||(core={}));var blowfish,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_bk=new Laya.Sprite,i.m_text=new Laya.Text,i.m_bk_w=80,i.m_bk_h=40,i.addChild(i.m_text),i.m_text.font="h5font",i.m_text.overflow=Laya.Text.HIDDEN,i.m_text.color="#65ff65",i.m_text.stroke=2,i.m_text.strokeColor="#19591c",i.m_text.align="center",i.m_text.fontSize=22,i.m_text.size(200,40),i.m_text.y=0,i.m_text.x=-100,i.y=25,i}return __extends(i,t),i.prototype.re_init=function(){this.y=25,this.x=0},i.prototype.dispose=function(){},i}(Laya.Sprite);t.avatarname=i;var e=function(t){function i(){var i=t.call(this)||this;return i.m_progress=null,i.m_w=62,i.m_h=18,i.m_progress=new Laya.ProgressBar("avatar/blood.png"),i.m_progress.width=i.m_w,i.m_progress.height=i.m_h,i.addChild(i.m_progress),i}return __extends(i,t),i.prototype.re_init=function(){this.m_progress.value=1},i.prototype.set_v=function(t,i){this.m_progress.value=t/i},i.prototype.clear=function(){},i.prototype.dispose=function(){this.removeChildren(),null!=this.m_progress&&(this.m_progress=null)},i}(Laya.Sprite);t.avatarhp=e;var _=function(t){function i(){var i=t.call(this)||this;return i.m_id=0,i.m_shape=0,i.m_cd=0,i.m_overlap=0,i.m_datas=null,i.m_icon=null,i.m_cd_label=null,i.m_w=0,i.m_h=0,i.m_cd_label_h=12,i.m_effid=0,i.m_icon=new Laya.Sprite,i.m_cd_label=new Laya.Label,i.m_cd_label.color="#fff200",i.m_cd_label.stroke=1,i.m_cd_label.strokeColor="#000000",i.addChild(i.m_icon),i.addChild(i.m_cd_label),i}return __extends(i,t),i.prototype.re_init=function(){this.m_cd_label.y=this.m_h-this.m_cd_label_h,this.m_effid=0},i.prototype.set_id=function(t,i){this.m_id!=t&&this.m_icon.graphics.clear(),this.m_id=t,this.m_shape=i,this.m_icon.graphics.loadImage("icon/buff/"+this.m_shape.toString()+".jpg",0,0,this.m_w,this.m_h)},i.prototype.set_data=function(t,i,e){this.set_cd(t),this.m_overlap=i,this.m_datas=e},i.prototype.set_cd=function(t){this.m_cd=t,this.m_cd_label.text=this.m_cd.toString()},i.prototype.set_effid=function(t){this.m_effid=t},i.prototype.dispose=function(){this.m_icon.graphics.clear()},i}(Laya.Sprite);t.avatarbuff=_;var r=function(t){function i(){var i=t.call(this)||this;return i.m_list=null,i.m_num_per_row=3,i.m_buffw=32,i.m_buffh=32,i.m_list=new Array,i}return __extends(i,t),i.prototype._re_arrange=function(){for(var t=0,i=0,e=0,_=0,r=this.m_list;_<r.length;_++){var n=r[_];n.x=t,n.y=i,e+=1,t+=this.m_buffw,e>2&&(t=0,i+=this.m_buffh,e=0)}i+=this.m_buffh,this.x=0-this.m_buffw*this.m_num_per_row/2,this.y=-100},i.prototype.addbuff=function(t,i,e,r,n,s){void 0===s&&(s=0);var a=this.getbuff(t);null==a&&((a=utils.getitembycls("avatarbuff",_)).m_w=this.m_buffw,a.m_h=this.m_buffh,a.re_init(),this.addChild(a),a.set_id(t,i),a.set_effid(s),this.m_list.push(a),this._re_arrange()),a.set_data(e,r,n)},i.prototype.getbuff=function(t){for(var i=0,e=this.m_list;i<e.length;i++){var _=e[i];if(_.m_id==t)return _}return null},i.prototype.delbuff=function(t){for(var i=0;i<this.m_list.length;++i){var e=this.m_list[i];if(e.m_id==t)return e.removeSelf(),e.dispose(),utils.recover("avatarbuff",e),this.m_list.splice(i,1),this._re_arrange(),!0}return!1},i.prototype.buffautocd=function(){for(var t=0,i=this.m_list;t<i.length;t++){var e=i[t];e.set_cd(e.m_cd-1)}},i.prototype.delallbuff=function(){this.removeChildren();for(var t=0,i=this.m_list;t<i.length;t++){var e=i[t];e.dispose(),utils.recover("avatarbuff",e)}this.m_list.length=0},i.prototype.re_init=function(){},i.prototype.clear=function(){this.delallbuff()},i.prototype.dispose=function(){this.clear()},i}(Laya.Sprite);t.avatarbuffui=r}(core||(core={})),function(t){var i=18,e=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],_=4,r=256,n=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]],s=function(){function t(){this.m_index=0,this.m_PArray=new Array(i),this.m_SBoxes=new Array;for(var t=0;t<i;++t)this.m_PArray[t]=e[t];for(t=0;t<_;++t){this.m_SBoxes.push(new Array(r));for(var s=0;s<r;++s)this.m_SBoxes[t][s]=n[t][s]}this._print_array("constructor")}return t.prototype._print_array=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=!1),0!=e){for(var n="_print_array "+t+" ",s=0;s<i;++s){n=n+" "+(m=this.m_PArray[s]).toString(16)}core.net_errlog(n),core.net_errlog("sbox start "),n="";for(s=0;s<_;++s){this.m_SBoxes[s];for(var a=0,o=0;o<r;++o){var m;(m=this.m_SBoxes[s][o])<0&&(m=m+4294967295+1),n=n+" "+m.toString(16),a>=15?(core.net_errlog(n),n="",a=0):a+=1}}core.net_errlog("sbox end ")}},t.prototype._bf_F=function(t){var i=t>>24&255,e=t>>16&255,_=t>>8&255,r=255&t;this.m_SBoxes[0][i],this.m_SBoxes[1][e],this.m_SBoxes[2][_],this.m_SBoxes[3][r];return(this.m_SBoxes[0][i]+this.m_SBoxes[1][e]^this.m_SBoxes[2][_])+this.m_SBoxes[3][r]},t.prototype.ROUND=function(t,i,e){return t^=this._bf_F(i)^this.m_PArray[e]},t.prototype.Blowfish_encipher=function(t,i){var e=t,_=i;return e^=this.m_PArray[0],_=this.ROUND(_,e,1),e=this.ROUND(e,_,2),_=this.ROUND(_,e,3),e=this.ROUND(e,_,4),_=this.ROUND(_,e,5),e=this.ROUND(e,_,6),_=this.ROUND(_,e,7),e=this.ROUND(e,_,8),_=this.ROUND(_,e,9),e=this.ROUND(e,_,10),_=this.ROUND(_,e,11),e=this.ROUND(e,_,12),_=this.ROUND(_,e,13),e=this.ROUND(e,_,14),_=this.ROUND(_,e,15),e=this.ROUND(e,_,16),_^=this.m_PArray[17],this.m_PArray[this.m_index]^=e,this.m_index++,this.m_index>=18&&(this.m_index=0),[_,e]},t.prototype.Blowfish_decipher=function(t,i){var e=t,_=i,r=i;return e^=this.m_PArray[17],_=this.ROUND(_,e,16),e=this.ROUND(e,_,15),_=this.ROUND(_,e,14),e=this.ROUND(e,_,13),_=this.ROUND(_,e,12),e=this.ROUND(e,_,11),_=this.ROUND(_,e,10),e=this.ROUND(e,_,9),_=this.ROUND(_,e,8),e=this.ROUND(e,_,7),_=this.ROUND(_,e,6),e=this.ROUND(e,_,5),_=this.ROUND(_,e,4),e=this.ROUND(e,_,3),_=this.ROUND(_,e,2),e=this.ROUND(e,_,1),_^=this.m_PArray[0],this.m_PArray[this.m_index]^=r,this.m_index++,this.m_index>=18&&(this.m_index=0),[_,e]},t.prototype.testfunc=function(){var t=0;var i=255&(t=this.ROUND(t,713700311,1)),e=t>>8&255,_=t>>16&255,r=t>>24&255;core.net_errlog("byte01234 ",i,e,_,r)},t.prototype.InitializeKey=function(t){var i=t.length;if(!(i<=0)){for(var e=0,_=0;_<18;++_){t.pos=e;var r=t.getUint8();t.pos=(e+1)%i;var n=t.getUint8();t.pos=(e+2)%i;var s=t.getUint8();t.pos=(e+3)%i;var a=t.getUint8()|s<<8|n<<16|r<<24;this.m_PArray[_]^=a,e=(e+4)%i}this._print_array("InitializeKey1 ");var o=0,m=0;for(_=0;_<18;_+=2){o=(l=this.Blowfish_encipher(o,m))[0],m=l[1],this.m_PArray[_]=o,this.m_PArray[_+1]=m}for(_=0;_<4;++_)for(var h=0;h<256;h+=2){var l;o=(l=this.Blowfish_encipher(o,m))[0],m=l[1],this.m_SBoxes[_][h]=o,this.m_SBoxes[_][h+1]=m}this._print_array("InitializeKey2 ")}},t.prototype.Initialize=function(t){this.m_index^=t,this.m_index<0&&(this.m_index+=4294967296),this.m_index%=18;for(var i=0;i<9;i++){if(t&1<<i){var e=this.m_PArray[2*i];this.m_PArray[2*i]=this.m_PArray[2*i+1],this.m_PArray[2*i+1]=e}}for(i=9;i<18;i++){if(t&1<<i){e=this.m_PArray[i-9];this.m_PArray[i-9]=this.m_PArray[17-(i-9)],this.m_PArray[17-(i-9)]=e}}this._print_array("Initialize seed1 "+this.m_index);for(i=18;i<32;i++){if(t&1<<i){var _=i-18,r=t+this.m_index&255,n=(t>>8)+_&255;e=this.m_SBoxes[3&_][r];this.m_SBoxes[3&_][r]=this.m_SBoxes[3&this.m_index][n],this.m_SBoxes[3&this.m_index][n]=e}}this._print_array("Initialize seed2")},t.prototype.Encode=function(t){if(0!=(7&t.length))return!1;if(t.length<8)return!1;for(var i=t.pos,e=0;e<t.length;e+=8){var _=t.pos;t.pos=e;var r=t.getUint32(),n=t.getUint32(),s=this.Blowfish_encipher(r,n);t.pos=_,t.writeUint32(s[0]),t.writeUint32(s[1])}return t.pos=i,!0},t.prototype.Decode=function(t){if(0!=(7&t.length))return!1;if(t.length<8)return!1;for(var i=t.pos,e=0;e<t.length;e+=8){var _=t.pos;t.pos=e;var r=t.getUint32(),n=t.getUint32(),s=this.Blowfish_decipher(r,n);t.pos=_,t.writeUint32(s[0]),t.writeUint32(s[1])}return t.pos=i,!0},t}();t.CBlowFish=s}(blowfish||(blowfish={})),function(t){var i=function(){function t(){this.m_anchorX=0,this.m_anchorY=0,this.m_dx=0,this.m_dy=0,this.m_frameRate=24,this.m_frames=new Array}return t.prototype.set_data=function(t){var i=t.animations[0];this.m_frameRate=i.frameRate;var e=i.nodes[0].keyframes;e.anchorX&&(this.m_anchorX=e.anchorX[0].value),e.anchorY&&(this.m_anchorY=e.anchorY[0].value),e.x&&(this.m_dx=e.x[0].value),e.y&&(this.m_dy=e.y[0].value),this.m_frames.length=0;for(var _=0,r=e.skin;_<r.length;_++){var n=r[_];this.m_frames.push(n.value)}},t.parse=function(i){if(null!=i){var e=new t;return e.set_data(i),e}return null},t}();t.avatar_ani_struct=i;var e=function(){return function(){this.m_name="",this.m_w=0,this.m_h=0,this.m_source_w=0,this.m_source_h=0}}();t.avatar_atlas_img_struct=e;var _=function(){function t(){this.m_prefix="",this.m_frames=new Array}return t.prototype.set_data=function(t){this.m_prefix=t.meta.prefix,this.m_frames.length=0;for(var i=0,_=Object.keys(t.frames);i<_.length;i++){var r=_[i];if(t.frames.hasOwnProperty(r)){var n=t.frames[r],s=new e;s.m_name=r,s.m_w=n.frame.w,s.m_h=n.frame.h,s.m_source_w=n.sourceSize.w,s.m_source_h=n.sourceSize.h,this.m_frames.push(s)}}},t.parse=function(i){if(null!=i){var e=new t;return e.set_data(i),e}return null},t}();t.avatar_atlas_struct=_;var r=function(){function t(){this.m_ref=0,this.m_mat_res="",this.m_mat_id=0,t.s_mat_id+=1,this.m_mat_id=t.s_mat_id}return t.prototype.dispose=function(){},t.prototype.update=function(t){},t.prototype.load_res=function(){},t.prototype.addref=function(){this.m_ref++},t.prototype.delref=function(){this.m_ref--},t.s_mat_id=0,t}();t.material=r;var n=function(){function i(t){this.m_mat_res="",this.m_loaded=!1,this.m_loading=!1,this.m_ref=0,this.m_unload_mat=new Object,this.m_ref_tm=0,this.m_res_release=!1,this.m_extra_res=new Array,this.re_init(t)}return i.prototype.re_init=function(t){this.m_mat_res=t,this.m_loaded=!1,this.m_loading=!1,this.m_ref=0,this.m_unload_mat=new Object,this.m_ref_tm=0,this.m_extra_res=new Array},i.prototype.add_unload_mat=function(t){this.m_unload_mat[t.m_mat_id]=t},i.prototype.del_unload_mat=function(t){delete this.m_unload_mat[t.m_mat_id]},i.prototype.on_load=function(){for(var i in this.m_loaded=!0,this.m_loading=!1,this.m_unload_mat){this.m_unload_mat[i].load_res()}t.res_tiplog("material loader on_load ",this.m_mat_res),this.m_unload_mat=new Object},i.prototype.addextrares=function(t,i){this.m_loading||this.m_extra_res.push({url:t,type:i})},i.prototype.load_res=function(i){if(!this.m_loaded&&!this.m_loading)if(this.addextrares(this.m_mat_res,Laya.Loader.ATLAS),this.m_loading=!0,this.m_res_release)this.on_load();else{var e=laya.utils.Handler.create(this,this.on_load,[]);t.myload(this.m_extra_res,e,null,null,i,!0),t.res_tiplog("material loader load ",this.m_mat_res,this.m_extra_res.length)}},i.prototype.addref=function(){this.m_ref++},i.prototype.delref=function(){this.m_ref--,this.m_ref<=0&&(this.m_ref_tm=Laya.Browser.now())},i.prototype.check_release=function(){if(!this.m_loaded)return!1;if(this.m_ref<=0&&Laya.Browser.now()>this.m_ref_tm+1e4)return this.m_loaded=!1,this.m_loading=!1,Laya.Loader.clearTextureRes(this.m_mat_res),t.res_tiplog("material loader check_release ",this.m_mat_res),this.m_res_release=!0,!0;return!1},i.prototype.dispose=function(){this.m_unload_mat=new Object},i}();t.material_loader=n}(core||(core={})),function(t){var i=function(){function t(){this.m_map_grid_w=128,this.m_map_grid_h=128,this.m_map_info_dict=new Object,this.m_ani_info_dict=new Object,this.m_eff_info_dict=new Object,this.m_avatar_action_mat_dict=new Object,this.m_avatar_config=null,this.m_map_config=null,this.m_ani_config=null,this.m_eff_config=null}return t.prototype.set_avatar_config=function(t){this.m_avatar_config=t},t.prototype.set_map_config=function(t){this.m_map_config=t},t.prototype.set_ani_config=function(t){this.m_ani_config=t},t.prototype.set_eff_config=function(t){this.m_eff_config=t},t.prototype._get_avatar_info=function(t,i){var e=this.genavatarmatkey(t,i);if(0==this.m_avatar_action_mat_dict.hasOwnProperty(e.toString())){var _=this.m_avatar_config(t);if(null!=_)for(var r=0,n=_.info_data;r<n.length;r++){var s=n[r];if(s.aid==i){this.m_avatar_action_mat_dict[e]=s;break}}}return this.m_avatar_action_mat_dict[e]},t.prototype._get_map_info=function(t){return 0==this.m_map_info_dict.hasOwnProperty(t.toString())&&(this.m_map_info_dict[t]=this.m_map_config(t)),this.m_map_info_dict[t]},t.prototype._get_eff_info=function(t){return 0==this.m_eff_info_dict.hasOwnProperty(t.toString())&&(this.m_eff_info_dict[t]=this.m_eff_config(t)),this.m_eff_info_dict[t]},t.prototype._get_ani_info=function(t){return 0==this.m_ani_info_dict.hasOwnProperty(t.toString())&&(this.m_ani_info_dict[t]=this.m_ani_config(t)),this.m_ani_info_dict[t]},t.prototype.dispose=function(){},t.prototype.getmapw=function(t){var i=this._get_map_info(t),e=0;return null!=i&&null!=i&&(e=i.w),e},t.prototype.getmaph=function(t){var i=this._get_map_info(t),e=0;return null!=i&&null!=i&&(e=i.h),e},t.prototype.genmappath=function(t){return"map/city/"+t.toString()+"/"},t.prototype.geteffw=function(t){var i=16,e=this._get_eff_info(t);return null!=e&&(i=e.w),i},t.prototype.geteffh=function(t){var i=16,e=this._get_eff_info(t);return null!=e&&(i=e.h),i},t.prototype.geteffframecount=function(t){var i=30,e=this._get_eff_info(t);return null!=e&&(i=e.total),i},t.prototype.geteffframespeed=function(t){var i=30,e=this._get_eff_info(t);return null!=e&&(i=e.speed),i},t.prototype.geteffname=function(t){var i="",e=this._get_eff_info(t);return null!=e&&(i=e.name),i},t.prototype.geteffcycle=function(t){var i=!0,e=this._get_eff_info(t);return null!=e&&0==e.cycle&&(i=!1),i},t.prototype.getaniw=function(t){var i=16,e=this._get_ani_info(t);return null!=e&&(i=e.w),i},t.prototype.getanih=function(t){var i=16,e=this._get_ani_info(t);return null!=e&&(i=e.h),i},t.prototype.getaniframecount=function(t){var i=30,e=this._get_ani_info(t);return null!=e&&(i=e.total),i},t.prototype.getaniframespeed=function(t){var i=30,e=this._get_ani_info(t);return null!=e&&(i=e.speed),i},t.prototype.getanitexprefix=function(t){var i="",e=this._get_ani_info(t);return null!=e&&(i=e.prefix),i},t.prototype.genavatarmatkey=function(t,i){return 100*t+i},t.prototype.getavataractionw=function(t,i){var e=16,_=(this.genavatarmatkey(t,i),this._get_avatar_info(t,i));return null!=_&&(e=_.w),e},t.prototype.getavataractionh=function(t,i){var e=16,_=(this.genavatarmatkey(t,i),this._get_avatar_info(t,i));return null!=_&&(e=_.h),e},t.prototype.getavataractionframecount=function(t,i){var e=30,_=(this.genavatarmatkey(t,i),this._get_avatar_info(t,i));return null!=_&&(e=_.total),e},t.prototype.getavataractionframespeed=function(t,i){var e=30,_=(this.genavatarmatkey(t,i),this._get_avatar_info(t,i));return null!=_&&(e=_.speed),e},t.prototype.getavataractiontexprefix=function(t,i){var e="",_=this._get_avatar_info(t,i);return null!=_&&(e=_.prefix),e},t.prototype._gen_avatarlink_key=function(t,i){return(1e4*t+i).toString()},t.prototype._gen_avatarlink_filename=function(t,i){var e="",_=this._get_avatar_info(t,i);return null!=_&&(e=_.link),null==e&&(e=""),e},t.prototype.get_backride_shape=function(t){return 0},t}();t.materialinfomgr=i;var e=null;t.matinfo_mgr=function(){return null==e&&(e=new i),e}}(core||(core={})),function(t){var i=0,e=!1,_=new Array;function r(t,i){!function(){if(!e){e=!0;for(var t=0;t<1280;++t)_.push(0);for(var i=1048577,r=0,n=0;n<256;n++)for(r=n,t=0;t<5;++t){var s=(65535&(i=(125*i+3)%2796203))<<16,a=65535&(i=(125*i+3)%2796203);_[r]=s|a,r+=256}}}();var r,n=2146271213,s=4008636142;t=t.toUpperCase();for(var a=0;a<t.length;++a){r=t.charCodeAt(a),n=_[(i<<8)+r]^n+s,s=r+(n&=4294967295)+s+(s<<5)+3,s&=4294967295}return n<0&&(n=n+4294967295+1),n}t.get_file_key=function(t){return r(t,i)}}(core||(core={}));var myrandom,myencode,processencode,game_event,protocol_def,protocolbuf;__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(){function t(){this.m_nSeed=4090270810}return t.prototype.GetSeed=function(){return this.m_nSeed},t.prototype.SetSeed=function(t){this.m_nSeed=t},t.prototype.Random_01=function(){return 0},t.prototype.RandomInt=function(){return 0},t.prototype.Random=function(t,i){void 0===i&&(i=0);var e=t-i+1;return i+(e*=this.Random_01())},t}();t.CRandBase=i;var e=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.Random_01=function(){var t=this.m_nSeed/127773;return this.m_nSeed=16807*(this.m_nSeed-127773*t)-2836*t,this.m_nSeed<=0&&(this.m_nSeed+=2147483647),4.656612875e-10*this.m_nSeed},i.prototype.RandomInt=function(){var t=this.m_nSeed/127773;return this.m_nSeed=16807*(this.m_nSeed-127773*t)-2836*t,this.m_nSeed<=0&&(this.m_nSeed+=2147483647),65535&this.m_nSeed},i}(i);t.CLcg1_Rand=e;var _=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.Random_01=function(){var t=this.m_nSeed;t=t>>16&32767,this.m_nSeed=214013*this.m_nSeed+2531011;var i=this.m_nSeed;return i=i>>16&32767,this.m_nSeed=214013*this.m_nSeed+2531011,(t<<15|i)/1073741824},i.prototype.RandomInt=function(){return this.m_nSeed=214013*this.m_nSeed+2531011,this.m_nSeed&=4294967295,this.m_nSeed<0&&(this.m_nSeed+=4294967296),this.m_nSeed>>15&65535},i}(i);t.CLcg2_Rand=_}(myrandom||(myrandom={})),function(t){var i=function(){function t(){this.m_rand=new myrandom.CLcg2_Rand,this.m_remain=0,this.m_flag=0,this.m_rand.SetSeed(4090270810)}return t.prototype.Encode=function(t){if(t.length<1)return!1;var i=0,e=0;if(this.m_remain>65535&&(t.pos=i,e=(e=t.getUint8())^255&this.m_remain^this.m_flag^171,t.pos=i,t.writeUint8(e),this.m_flag=e,this.m_remain=0,i++),t.length<i+2)return!1;for(var _=0;i<t.length-1;i+=2)_=65535&this.m_rand.RandomInt(),t.pos=i,e=(e=t.getUint8())^255&_^this.m_flag,t.pos=i,t.writeUint8(e),t.pos=i+1,e=(e=t.getUint8())^_>>8&255^this.m_flag^171,t.pos=i+1,t.writeUint8(e),this.m_flag=e;return i<t.length&&(_=65535&this.m_rand.RandomInt(),t.pos=t.length-1,e=(e=t.getUint8())^255&_^this.m_flag,t.pos=t.length-1,t.writeUint8(e),this.m_remain=65536+(_>>8)),!0},t.prototype.Decode=function(t){if(t.length<1)return!1;var i=0,e=0;if(this.m_remain>65535&&(this.m_remain=255&this.m_remain^this.m_flag^171,t.pos=i,e=t.getUint8(),this.m_flag=e,e=255&(e^this.m_remain),t.pos=0,t.writeUint8(e),this.m_remain=0,i++),t.length<i+2)return!1;for(var _=0;i<t.length-1;i+=2)_=65535&this.m_rand.RandomInt(),t.pos=i,e=(e=t.getUint8())^255&_^this.m_flag,t.pos=i,t.writeUint8(e),_=_>>8&255^this.m_flag^171,t.pos=i+1,this.m_flag=t.getUint8(),e=255&(this.m_flag^255&_),t.pos=i+1,t.writeUint8(e);return i<t.length&&(_=65535&this.m_rand.RandomInt(),t.pos=t.length-1,e=(e=t.getUint8())^255&_^this.m_flag,t.pos=t.length-1,t.writeUint8(e),this.m_remain=65536+(_>>8)),!0},t}();t.MyEncode=i}(myencode||(myencode={})),function(t){var i,e;(e=i=t.log_level_enum||(t.log_level_enum={}))[e.LOG_ERROR=0]="LOG_ERROR",e[e.LOG_WARNNING=1]="LOG_WARNNING",e[e.LOG_TIPS=2]="LOG_TIPS",e[e.LOG_MAX=3]="LOG_MAX";var _,r,n=i.LOG_MAX;(r=_=t.log_module_enum||(t.log_module_enum={}))[r.MODULE_CORE=0]="MODULE_CORE",r[r.MODULE_RES=1]="MODULE_RES",r[r.MODULE_COMBAT=2]="MODULE_COMBAT",r[r.MODULE_NET=3]="MODULE_NET",r[r.MODULE_UI=4]="MODULE_UI",r[r.MODULE_GAME=5]="MODULE_GAME",r[r.MODULE_OTHER=6]="MODULE_OTHER",r[r.MODULE_LOADING=7]="MODULE_LOADING",r[r.MODULE_ALL=8]="MODULE_ALL";var s=_.MODULE_ALL;function a(t,i){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];t>n||s!=_.MODULE_ALL&&i!=s||function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];console.log("module:"+t+" "+i)}(i,e)}function o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_LOADING,t)}function m(i,e){if(t.g_b_open_loadinglog)if(e instanceof Array){o("gameload complete time ",Laya.Browser.now());for(var _=0,r=e;_<r.length;_++){var n=r[_];o("gameload complete ",n.type,n.url)}}else o("gameload complete ",Laya.Browser.now(),e);i.run()}t.set_log_level=function(t){n=t},t.set_log_module=function(t){s=t},t.log=a,t.res_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_RES,t)},t.res_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_RES,t)},t.res_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_RES,t)},t.core_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_CORE,t)},t.core_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_CORE,t)},t.core_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_CORE,t)},t.net_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_NET,t)},t.net_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_NET,t)},t.net_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_NET,t)},t.combat_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_COMBAT,t)},t.combat_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_COMBAT,t)},t.combat_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_COMBAT,t)},t.ui_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_UI,t)},t.ui_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_UI,t)},t.ui_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_UI,t)},t.game_errlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_ERROR,_.MODULE_GAME,t)},t.game_warnlog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_WARNNING,_.MODULE_GAME,t)},t.game_tiplog=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_GAME,t)},t.game_log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a(i.LOG_TIPS,_.MODULE_GAME,t)},t.loading_tiplog=o,t.g_b_open_loadinglog=!1,t.open_loading_log=function(i){t.g_b_open_loadinglog=i},t.myload=function(i,e,_,r,n,s,a,h){if(t.g_b_open_loadinglog)if(i instanceof Array){o("gameload start time ",Laya.Browser.now());for(var l=0,c=i;l<c.length;l++){var p=c[l];o("gameload start ",p.type,p.url)}}else o("gameload start ",Laya.Browser.now(),i);var u=Laya.Handler.create(null,m,[e,i]);return Laya.loader.load(i,u,_,r,n,s,a,h)}}(core||(core={})),function(t){var i=[3056417706,958607066,1846441372,733894765,2884932728,3849091325,3112974538,1031800198,3695952152,2747108422,3986058167,551430739,1102935060,40613399,1809096094,759965995,923583685,2539800367,3846827613,4266654447,2132897078,3570701490,3331251513,2908467070,3314168189,168194867,1303738077,2734862194,2018056724,38839819,1934508562,3111940130,1722473874,2348973755,1687569764,290925782,3441175467,3326302810,642692458,3744823602,3187420969,1112861567,1907514446,488319787,2706074989,3785453277,2658466098,1874680856,3534138414,857260280,4098874734,1951088814,4118496565,3725783226,2824606752,3664561855,1973592766,241920811,2309113215,3016926545,4063968121,1107232400,3981583398,3415822226],e=256,_=new Array(e);var r=!1;t.RC4_InitCode=function(){if(!r){r=!0;for(var t=4*i.length,n=new Array(t),s=0;s<t/4;++s){var a=i[s]%30091<<16|i[s]%29017,o=a>>24&255,m=a>>16&255,h=a>>8&255,l=255&a;n[4*s]=l,n[4*s+1]=h,n[4*s+2]=m,n[4*s+3]=o}var c=0,p=0;for(s=0;s<t;++s)c=(c+n[s])%t,p=n[s],n[s]=n[c],n[c]=p;!function(t){for(var i=t.length,r=0;r<e;++r)_[r]=r;var n=0,s=0;for(r=0;r<e;++r)n=(n+t[r%i]+_[r])%e,s=_[r],_[r]=_[n],_[n]=s}(n)}};var n=function(){function t(){this.m_SBox=new Array(e),this.m_x=0,this.m_y=0,this.m_seed=0;for(var t=0;t<e;++t)this.m_SBox[t]=_[t]}return t.prototype.Create=function(t){this.m_seed=t,this.m_x=4095&this.m_seed^3617,this.m_y=this.m_seed>>12&4095^858},t.prototype.Encode=function(t){for(var i=0,_=0,r=this.m_SBox,n=this.m_x,s=this.m_y,a=0;a<t.length;++a)s=(r[n=(n+7)%e]+s)%e,i=r[n],r[n]=r[s],r[s]=i,i=(r[n]+r[s])%e,t.pos=a,_=t.getUint8(),t.pos=a,t.writeUint8(_^r[i]);this.m_x=n,this.m_y=s},t.prototype.Encode2=function(t){for(var i=0,_=0,r=this.m_SBox,n=this.m_x,s=this.m_y,a=0;a<t.length;++a)r[n=r[s=(s+5+n)%e]%e]^=r[s],r[s]^=r[n],r[n]^=r[s],i=(r[n]+r[s]+9)%e,t.pos=a,_=t.getUint8(),t.pos=a,t.writeUint8(_^r[i]);this.m_x=n,this.m_y=s},t}();t.CProcessEncode=n}(processencode||(processencode={})),function(t){t.EVENT_NET_PACKET="net_packet",t.EVENT_NET_CONNECTED="net_connected",t.EVENT_NET_CLOSED="net_closed",t.EVENT_NET_ERROR="net_error",t.EVENT_WIDGET_ONSHOW="ui_widget_onshow",t.EVENT_WIDGET_ONHIDE="ui_widget_onhide",t.EVENT_WIDGET_ONDISPOSE="ui_widget_ondispose",t.EVENT_WIDGET_ALLDISPOSE="ui_widget_alldispose",t.EVENT_TESTCOMBAT="test_combat",t.EVENT_TESTCOMBATPROTO="test_combatproto",t.gen_netcmd_event=function(i){return t.EVENT_NET_PACKET+"_"+i.toString()}}(game_event||(game_event={})),function(t){t.C2S_CMD_2_TYPE={},t.S2C_CMD_2_TYPE={},t.C2S_CMD_2_PROTO={},t.S2C_CMD_2_PROTO={},t.register_cmd=function(i,e){for(var _ in i)i.hasOwnProperty(_)&&(t.C2S_CMD_2_PROTO[_]=i[_]);for(var _ in e)e.hasOwnProperty(_)&&(t.S2C_CMD_2_PROTO[_]=e[_])},t.Protocol_desc_map={},t.register_protocol_desc=function(i){t.Protocol_desc_map=i}}(protocol_def||(protocol_def={})),function(t){var i=function(){function t(){this.m_temp=new laya.utils.Byte}return t.prototype.get_desc_byname=function(t){return protocol_def.Protocol_desc_map[t]},t.prototype.pack_uint8=function(t,i){t.writeUint8(i)},t.prototype.unpack_uint8=function(t){return t.getUint8()},t.prototype.pack_uint16=function(t,i){t.writeUint16(i)},t.prototype.unpack_uint16=function(t){return t.getUint16()},t.prototype.pack_uint32=function(t,i){t.writeUint32(i)},t.prototype.unpack_uint32=function(t){return t.getUint32()},t.prototype.pack_int8=function(t,i){i<0&&(i+=256),t.writeUint8(i)},t.prototype.unpack_int8=function(t){var i=t.getUint8();return i>127&&(i-=256),i},t.prototype.pack_int16=function(t,i){t.writeInt16(i)},t.prototype.unpack_int16=function(t){return t.getInt16()},t.prototype.pack_int32=function(t,i){t.writeInt32(i)},t.prototype.unpack_int32=function(t){return t.getInt32()},t.prototype.pack_byte=function(t,i){if(!(null==i||null==i||i.length<=0))for(i.pos=0;i.bytesAvailable>0;)t.writeUint8(i.getUint8())},t.prototype.unpack_byte=function(t,i){for(var e=new Laya.Byte;t.bytesAvailable>0&&i>0;)e.writeUint8(t.getUint8()),i-=1;return e},t.prototype.pack_byte8=function(t,i){if(null!=i){i.pos=0,t.writeUint8(i.length);var e=i.length;if(e>255&&(e=255),i.length>0)for(;i.bytesAvailable>0&&e>0;)t.writeUint8(i.getUint8()),e-=1}else t.writeUint8(0)},t.prototype.unpack_byte8=function(t){for(var i=new Laya.Byte,e=t.getUint8();t.bytesAvailable>0&&e>0;)i.writeUint8(t.getUint8()),e-=1;return i},t.prototype.pack_byte16=function(t,i){if(null!=i){i.pos=0,t.writeUint16(i.length);var e=i.length;if(e>65535&&(e=65535),i.length>0)for(;i.bytesAvailable>0&&e>0;)t.writeUint8(i.getUint8()),e-=1}else t.writeUint16(0)},t.prototype.unpack_byte16=function(t){for(var i=new Laya.Byte,e=t.getUint16();t.bytesAvailable>0&&e>0;)i.writeUint8(t.getUint8()),e-=1;return i},t.prototype.pack_byte32=function(t,i){if(null!=i){i.pos=0,t.writeUint32(i.length);var e=i.length;if(e>4294967295&&(e=4294967295),i.length>0)for(;i.bytesAvailable>0&&e>0;)t.writeUint8(i.getUint8()),e-=1}else t.writeUint32(0)},t.prototype.unpack_byte32=function(t){for(var i=new Laya.Byte,e=t.getUint32();t.bytesAvailable>0&&e>0;)i.writeUint8(t.getUint8()),e-=1;return i},t.prototype.pack_string8=function(t,i){null!=i&&null!=i||(i="");var e=t.pos;t.writeUint8(i.length);var _=t.pos;t.writeUTFBytes(i);var r=t.pos,n=r-_;t.pos=e,t.writeUint8(n),t.pos=r},t.prototype.unpack_string8=function(t){var i=t.getUint8();return t.getUTFBytes(i)},t.prototype.pack_string16=function(t,i){null!=i&&null!=i||(i="");var e=t.pos;t.writeUint16(i.length);var _=t.pos;t.writeUTFBytes(i);var r=t.pos,n=r-_;t.pos=e,t.writeUint16(n),t.pos=r},t.prototype.unpack_string16=function(t){var i=t.getUint16();return t.getUTFBytes(i)},t.prototype.pack_string32=function(t,i){null!=i&&null!=i||(i="");var e=t.pos;t.writeUint32(i.length);var _=t.pos;t.writeUTFBytes(i);var r=t.pos,n=r-_;t.pos=e,t.writeUint32(n),t.pos=r},t.prototype.unpack_string32=function(t){var i=t.getUint32();return t.getUTFBytes(i)},t.prototype.pack_int_data=function(t,i,e){"uint8"==i?this.pack_uint8(t,e):"uint16"==i?this.pack_uint16(t,e):"uint32"==i?this.pack_uint32(t,e):"int8"==i?this.pack_int8(t,e):"int16"==i?this.pack_int16(t,e):"int32"==i&&this.pack_int32(t,e)},t.prototype.unpack_int_data=function(t,i){return"uint8"==i?this.unpack_uint8(t):"uint16"==i?this.unpack_uint16(t):"uint32"==i?this.unpack_uint32(t):"int8"==i?this.unpack_int8(t):"int16"==i?this.unpack_int16(t):"int32"==i?this.unpack_int32(t):0},t.prototype.pack_string_data=function(t,i,e){"string8"==i?this.pack_string8(t,e):"string16"==i?this.pack_string16(t,e):"string32"==i&&this.pack_string32(t,e)},t.prototype.unpack_string_data=function(t,i){return"string8"==i?this.unpack_string8(t):"string16"==i?this.unpack_string16(t):"string32"==i?this.unpack_string32(t):""},t.prototype.pack_data=function(t,i,e,_){if("int8"==i||"int16"==i||"int32"==i||"uint8"==i||"uint16"==i||"uint32"==i)this.pack_int_data(t,i,_);else if("string8"==i||"string16"==i||"string32"==i)this.pack_string_data(t,i,_);else if("byte8"==i)this.pack_byte8(t,_);else if("byte16"==i)this.pack_byte16(t,_);else if("byte32"==i)this.pack_byte32(t,_);else if("byte"==i)this.pack_byte(t,_);else if("list8"==i||"list16"==i||"list32"==i){var r=_,n=r.length;"list8"==i?this.pack_uint8(t,n):"list16"==i?this.pack_uint16(t,n):"list32"==i&&this.pack_uint32(t,n);for(var s=e,a=0,o=r;a<o.length;a++){var m=o[a];if("int8"==s||"int16"==s||"int32"==s||"uint8"==s||"uint16"==s||"uint32"==s)this.pack_int_data(t,s,m);else if("string8"==s||"string16"==s||"string32"==s)this.pack_string_data(t,s,m);else if("byte8"==s)this.pack_byte8(t,m);else if("byte16"==s)this.pack_byte16(t,m);else if("byte32"==s)this.pack_byte32(t,m);else if("byte"==s)this.pack_byte(t,m);else for(var h=0,l=this.get_desc_byname(s);h<l.length;h++){var c=(y=l[h])[0],p=y[1],u=y[2];this.pack_data(t,p,u,m[c])}}}else for(var d=0,f=this.get_desc_byname(i);d<f.length;d++){var y;c=(y=f[d])[0],p=y[1],u=y[2];this.pack_data(t,p,u,_[c])}},t.prototype.unpack_data=function(t,i,e,_){var r,n,s;if(void 0===_&&(_=-1),_<0&&(_=e.length),"int8"==t||"int16"==t||"int32"==t||"uint8"==t||"uint16"==t||"uint32"==t)return r=this.unpack_int_data(e,t);if("string8"==t||"string16"==t||"string32"==t)return n=this.unpack_string_data(e,t);if("byte8"==t)return s=this.unpack_byte8(e);if("byte16"==t)return s=this.unpack_byte8(e);if("byte32"==t)return s=this.unpack_byte8(e);if("byte"==t)return s=this.unpack_byte(e,_);if("list8"==t||"list16"==t||"list32"==t){var a=0;"list8"==t?a=this.unpack_uint8(e):"list16"==t?a=this.unpack_uint16(e):"list32"==t&&(a=this.unpack_uint32(e));for(var o=i,m=[],h=0;h<a;++h)if("int8"==o||"int16"==o||"int32"==o||"uint8"==o||"uint16"==o||"uint32"==o)r=this.unpack_int_data(e,o),m.push(r);else if("string8"==o||"string16"==o||"string32"==o)n=this.unpack_string_data(e,o),m.push(n);else if("byte8"==o)s=this.unpack_byte8(e),m.push(s);else if("byte16"==o)s=this.unpack_byte8(e),m.push(s);else if("byte32"==o)s=this.unpack_byte8(e),m.push(s);else if("byte"==o)s=this.unpack_byte(e,_),m.push(s);else{for(var l={},c=0,p=this.get_desc_byname(o);c<p.length;c++){var u=(v=p[c])[0],d=v[1],f=v[2];l[u]=this.unpack_data(d,f,e,_)}m.push(l)}return m}l={};for(var y=0,g=this.get_desc_byname(t);y<g.length;y++){var v;u=(v=g[y])[0],d=v[1],f=v[2];l[u]=this.unpack_data(d,f,e,_)}return l},t.prototype.c2s_rawbuff2buf=function(t,i){var e=new Laya.Byte;e.endian=Laya.Byte.BIG_ENDIAN,e.writeByte(19),e.writeByte(82),e.writeByte(8),e.writeByte(28),e.writeByte(1),e.writeInt32(1);var _=e.pos;for(e.writeInt32(0),e.writeInt32(t),i.pos=0;i.pos<i.length;)e.writeUint8(i.getUint8());var r=e.pos-_-4;return e.pos=_,e.writeInt32(r),e.pos=0,e},t.prototype.c2s_data2buf=function(t,i){var e=new Laya.Byte;e.endian=Laya.Byte.BIG_ENDIAN,e.writeByte(19),e.writeByte(82),e.writeByte(8),e.writeByte(28),e.writeByte(1),e.writeInt32(1);var _=e.pos;if(e.writeInt32(0),e.writeInt32(t),null!=protocol_def.C2S_CMD_2_PROTO[t])for(var r=protocol_def.C2S_CMD_2_PROTO[t],n=0,s=this.get_desc_byname(r);n<s.length;n++){var a=s[n],o=a[0],m=a[1],h=a[2];this.pack_data(e,m,h,i[o])}var l=e.pos-_-4;return e.pos=_,e.writeInt32(l),e.pos=0,e},t.prototype.s2c_buf2data=function(t){core.net_errlog("s2c_buf2data ",t);var i,e={};t.getByte(),t.getByte(),t.getByte(),t.getByte(),t.getByte(),t.getInt32();var _=t.getInt32();if(i=t.getInt32(),core.net_errlog("s2c_buf2data1 ",t.length,t.pos,_,i),null!=protocol_def.S2C_CMD_2_PROTO[i])for(var r=protocol_def.S2C_CMD_2_PROTO[i],n=0,s=this.get_desc_byname(r);n<s.length;n++){var a=s[n],o=a[0],m=a[1],h=a[2];e[o]=this.unpack_data(m,h,t)}var l={};return l.cmd=i,l.data=e,l},t.prototype.c2s_rawbuff2buf_tl=function(t,i,e){var _=i.length;for(_+=2,e.clear(),e.endian=Laya.Byte.LITTLE_ENDIAN,_<255?e.writeUint8(_):(e.pos=0,e.writeUint8(255),e.writeUint32(_),e.pos=4),e.writeInt16(t),i.pos=0;i.pos<i.length;)e.writeUint8(i.getUint8());return e.pos=0,e},t.prototype.c2s_data2buf_tl=function(t,i,e){this.m_temp.clear();var _=this.m_temp;if(_.endian=Laya.Byte.LITTLE_ENDIAN,_.writeInt16(t),null!=protocol_def.C2S_CMD_2_PROTO[t])for(var r=protocol_def.C2S_CMD_2_PROTO[t],n=0,s=this.get_desc_byname(r);n<s.length;n++){var a=s[n],o=a[0],m=a[1],h=a[2];this.pack_data(_,m,h,i[o])}var l=_.length;e.clear();var c=e;for(c.endian=Laya.Byte.LITTLE_ENDIAN,l<255?c.writeUint8(l):(c.pos=0,c.writeUint8(255),c.writeUint32(l),c.pos=4),_.pos=0;_.pos<_.length;)c.writeUint8(_.getUint8());return c.pos=0,c},t.prototype.s2c_buf2data_tl=function(t){var i,e=0,_={},r=t.pos;i=t.getUint8();var n=t.length-t.pos,s=0;if(255==i?(t.pos=r,s=t.getUint32(),s>>=8,n-=3):s=i,s>n)return core.net_errlog("s2c_buf2data_tl is not enough ",s,n,t.length),t.pos=r,null;if(e=t.getInt16(),s-=2,core.net_tiplog("s2c_buf2data_tl ",e.toString(16),t.length,t.pos,s),null!=protocol_def.S2C_CMD_2_PROTO[e])for(var a=protocol_def.S2C_CMD_2_PROTO[e],o=0,m=this.get_desc_byname(a);o<m.length;o++){var h=m[o],l=h[0],c=h[1],p=h[2];_[l]=this.unpack_data(c,p,t,s)}else t.getUTFBytes(s),core.net_errlog("cmd is not defined! ",e.toString(16));var u={};return u.cmd=e,u.data=_,u},t}();t.protocolbuf=i}(protocolbuf||(protocolbuf={})),function(t){var i=function(){function t(t){this.re_init(t)}return t.prototype.re_init=function(t){this.m_obj=t,null!=this.m_obj&&this.update_z()},t.prototype.update_z=function(){this.m_screen_z=this.m_obj.y},t.prototype.dispose=function(){this.m_obj=null},t.prototype.render=function(t){t.m_view.m_unitView.addChild(this.m_obj)},t.prototype.is_contain=function(t,i){return!1},t}();t.rendercommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_box=new laya.maths.Rectangle,i.m_rc=null,i.set_id(),i}return __extends(i,t),i.prototype.set_id=function(){this.m_obj_id=this.get_obj_id()},i.prototype.set_pos=function(t,i){this.x=t,this.y=i,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height),this.m_rc.update_z()},Object.defineProperty(i.prototype,"set_x",{get:function(){return this.x},set:function(t){this.x=t,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"set_y",{get:function(){return this.y},set:function(t){this.y=t,this.m_box.setTo(this.x-this.m_box.width/2,this.y-this.m_box.height/2,this.m_box.width,this.m_box.height),this.m_rc.update_z()},enumerable:!0,configurable:!0}),i.prototype.set_scale=function(t,i){},i.prototype.get_obj_id=function(){return i.S_RO_IDMAX++},i.prototype.dispose=function(){this.removeSelf()},i.prototype.update=function(t){},i.prototype.is_contain=function(t,i){return this.m_box.contains(t,i)},i.prototype.project=function(t){return!!t.m_camera.is_project(this.m_box)&&(t.m_render.addrc(this.m_rc),!0)},i.S_RO_IDMAX=1,i}(laya.display.Sprite);t.renderobject=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){1==this.m_obj.m_data?this.m_screen_z=-5e8+this.m_obj.y:this.m_screen_z=-1e8+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){1==this.m_obj.m_data?t.m_view.m_ani_underunit_View.addChild(this.m_obj):t.m_view.m_ani_uponunit_view.addChild(this.m_obj)},i}(t.rendercommand);t.anicommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){this.m_screen_z=-4e8+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){t.m_view.m_unitView.addChild(this.m_obj)},i.prototype.is_contain=function(t,i){return this.m_obj.is_contain(t,i)},i}(t.rendercommand);t.avatarcommand=i;var e=function(t){function i(i){void 0===i&&(i=null);var e=t.call(this,i)||this;return e.m_a=i,e}return __extends(i,t),i.prototype.re_init=function(i){t.prototype.re_init.call(this,i),this.m_a=i},i.prototype.update_z=function(){this.m_screen_z=-4e8+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){if(t.m_view.m_unitView.addChild(this.m_obj),this.m_obj.alpha>0){var i=this.m_obj.x+this.m_a.m_dx,e=this.m_obj.y+this.m_a.m_dy;null!=this.m_a.m_aura_adorn&&this.m_a.m_aura_adorn.draw2sp(t.m_view.m_unitground_View,i,e,!1),null!=this.m_a.m_title_adorn&&this.m_a.m_title_adorn.draw2sp(t.m_view.m_unitfront_View,i,e),null!=this.m_a.m_shadow_sp&&t.m_view.m_unitshadow_View.graphics.drawTexture(this.m_a.m_shadow_sp,i-50,e-35),this.m_a.m_name.length>0&&t.m_view.m_unitname_View.graphics.fillBorderText(this.m_a.m_name,i+this.m_a.m_name_dx,e+25+this.m_a.m_name_dy,"22px h5font","#65ff65","#19591c",2,"center")}},i.prototype.is_contain=function(t,i){return this.m_obj.is_contain(t,i)},i}(t.rendercommand);t.avatarcommand_new=e}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){1==this.m_obj.m_data?this.m_screen_z=-5e8+this.m_obj.y:this.m_screen_z=-1e8+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){1==this.m_obj.m_data?t.m_view.m_ani_underunit_View.addChild(this.m_obj):t.m_view.m_ani_uponunit_view.addChild(this.m_obj)},i}(t.rendercommand);t.effcommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){this.m_screen_z=-1e9},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){t.m_view.m_mapView.addChild(this.m_obj)},i}(t.rendercommand);t.mapbkcommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){this.m_screen_z=-1e9},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){t.m_view.m_ani_underunit_View.addChild(this.m_obj)},i}(t.rendercommand);t.mapblockcommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){this.m_screen_z=-1e9+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){var i=t.m_view.m_mapView,e=this.m_obj;null!=e.m_mat&&null!=e.m_mat.m_tex&&i.graphics.drawTexture(e.m_mat.m_tex,e.x,e.y)},i}(t.rendercommand);t.mapslotcommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i){return void 0===i&&(i=null),t.call(this,i)||this}return __extends(i,t),i.prototype.update_z=function(){this.m_screen_z=-1e8+this.m_obj.y},i.prototype.dispose=function(){this.m_obj=null},i.prototype.render=function(t){this.m_obj.m_b_upon_unit?t.m_view.m_ani_uponunit_view.addChild(this.m_obj):t.m_view.m_ani_underunit_View.addChild(this.m_obj)},i}(t.rendercommand);t.spritecommand=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_res_path=null,t.m_ani_id=0,t.m_ready=!1,t.m_graphic=new laya.display.Animation,t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat_res=""},e.prototype.ani_index_pad=function(t,i){for(var e=t.toString(),_=e.length;_<i;)e="0"+e,_++;return e},e.prototype.aniUrls=function(t,i,e,_){for(var r=[],n=0;n<_;n++)r.push(t+i+this.ani_index_pad(n,e)+".png");return r},e.prototype.load_res=function(){this.loadres(t.matinfo_mgr().getanitexprefix(this.m_ani_id),"0",4,t.matinfo_mgr().getaniframecount(this.m_ani_id))},e.prototype.loadres=function(t,i,e,_){this.m_graphic.loadImages(this.aniUrls(t,i,e,_)),this.m_ready=!0,this.m_graphic.play(),this.m_graphic.gotoAndStop(0)},e.prototype.goto_frame=function(t){this.m_ready&&this.m_graphic.gotoAndStop(t)},e.prototype.clear=function(){this.m_graphic.clear(),this.m_ready=!1},e.prototype.dispose=function(){this.m_graphic.clear(),this.m_graphic=null},e.prototype.update=function(t){},e}(t.material);t.animaterial=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_ready=!1,i.m_dir=0,i.m_graphic=new laya.display.Animation,i}return __extends(i,t),i.prototype.re_init=function(){this.m_graphic.clear(),this.m_ready=!1},i.prototype.get_rect=function(){var t=null;return this.m_ready&&(t=this.m_graphic.getGraphicBounds(!0)),t},i.prototype.ani_index_pad=function(t,i){for(var e=t.toString(),_=e.length;_<i;)e="0"+e,_++;return e},i.prototype.aniUrls=function(t,i,e,_){for(var r=[],n=0;n<_;n++)r.push(t+i+this.ani_index_pad(n,e)+".png");return r},i.prototype.loadres=function(t,i,e,_){this.m_graphic.loadImages(this.aniUrls(t,i,e,_)),this.m_ready=!0,this.m_graphic.play(),this.m_graphic.gotoAndStop(0)},i.prototype.goto_frame=function(t){this.m_ready&&this.m_graphic.gotoAndStop(t)},i.prototype.clear=function(){this.m_graphic.clear(),this.m_ready=!1},i.prototype.dispose=function(){this.m_graphic.clear(),this.m_graphic=null},i.prototype.update=function(t){},i}(t.material);t.avataractiondirmaterial=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_shape=0,t.m_action=0,t.m_curdir=0,t.m_curdirmat=null,t.m_dir_list={},t.m_width=0,t.m_height=0,t.m_b_mirrior=!0,t.m_b_dir4=!1,t.m_alink=null,t.m_cur_link=new Laya.Point(0,0),t.m_b_loaded=!1,t.m_cur_mirrior=!1,t.m_link_sp=null,t.m_graphic=new laya.display.Sprite,t.m_link_sp=new Laya.Sprite,t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat_res="",this.m_shape=0,this.m_action=0,this.m_curdir=0,this.m_curdirmat=null,this.m_width=0,this.m_height=0,this.m_b_mirrior=!0,this.m_b_dir4=!1,this.m_alink=null,this.m_cur_link=new Laya.Point(0,0),this.m_b_loaded=!1,this.m_cur_mirrior=!1},e.prototype.get_link=function(t,i,e){var _=this.m_dir_list[t];return null!=_&&_.m_dir!=t&&(t=_.m_dir),null!=this.m_alink?this.m_alink.get_pt(t,i,e):this.m_cur_link},e.prototype.goto_frame=function(t){null!=this.m_curdirmat&&this.m_curdirmat.goto_frame(t)},e.prototype.is_dir_loaded=function(t){return null!=this.m_dir_list[t]&&null!=this.m_dir_list[t]&&this.m_dir_list[t].m_ready},e.prototype.load_res=function(){for(var i=t.matinfo_mgr()._get_avatar_info(this.m_shape,this.m_action),e=(i.prefix,i.dir.split(",")),_=t.matinfo_mgr().getavataractiontexprefix(this.m_shape,this.m_action),r=t.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),n=0,s=0,a=e;s<a.length;s++){var o=a[s];this.adddirmat(_,n,o,4,r),n+=1}this.m_b_loaded=!0},e.prototype.adddirmat=function(i,e,_,r,n){if(null!=this.m_graphic){var s=null;(s=utils.getitembycls("avataractiondirmaterial",t.avataractiondirmaterial)).re_init(),s.loadres(i,_.toString(),r,n),s.m_dir=_,s.m_ready=!0,this.m_dir_list[e]=s,e==this.m_curdir&&this.changedir(this.m_curdir),this.m_b_loaded=!0}else t.core_tiplog("avataractionmaterial adddirmat already release ",i,e,r,n)},e.prototype.changedir=function(t){this.m_curdir=t,this.m_graphic.removeChildren(),this.m_curdirmat=null;this.m_curdir;var i=1;this.m_cur_mirrior=!1;var e=this.m_dir_list[this.m_curdir];null!=e&&(e.m_dir!=this.m_curdir&&this.m_b_mirrior&&(3==this.m_curdir?5==e.m_dir&&(i=-1,this.m_cur_mirrior=!0):5==this.m_curdir?3==e.m_dir&&(i=-1,this.m_cur_mirrior=!0):1==this.m_curdir?7==e.m_dir&&(i=-1,this.m_cur_mirrior=!0):7==this.m_curdir?1==e.m_dir&&(i=-1,this.m_cur_mirrior=!0):2==this.m_curdir?e.m_dir>4&&(i=-1,this.m_cur_mirrior=!0):6==this.m_curdir&&e.m_dir<4&&(i=-1,this.m_cur_mirrior=!0)),this.m_curdirmat=e,this.m_graphic.pivotX=this.m_width>>1,this.m_graphic.scaleX=i,this.m_graphic.addChild(this.m_curdirmat.m_graphic))},e.prototype.get_rect=function(){return null!=this.m_curdirmat?this.m_curdirmat.get_rect():null},e.prototype.clear=function(){for(var t in this.m_b_loaded=!1,this.m_graphic.removeChildren(),this.m_curdirmat=null,this.m_dir_list){var i=this.m_dir_list[t];null!=i&&(i.clear(),utils.recover("avataractiondirmaterial",i))}this.m_dir_list={}},e.prototype.dispose=function(){for(var t in this.clear(),this.m_graphic=null,this.m_link_sp=null,this.m_dir_list){var i=this.m_dir_list[t];null!=i&&i.dispose()}this.m_dir_list={}},e.prototype.update=function(t){},e}(t.material);t.avataractionmaterial=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_ani_path=null,t.m_res_path=null,t.m_ani_id=0,t.m_ready=!1,t.m_graphic=new laya.display.Animation,t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat_res=""},e.prototype.load_res=function(){this.loadres(t.matinfo_mgr().geteffname(this.m_ani_id),t.matinfo_mgr().geteffcycle(this.m_ani_id))},e.prototype.loadres=function(t,i){null!=this.m_graphic&&(this.m_graphic.loadAnimation(this.m_ani_path),this.m_ready=!0,this.m_graphic.play(0,i,t),this.m_graphic.gotoAndStop(0))},e.prototype.goto_frame=function(t){this.m_ready&&this.m_graphic.gotoAndStop(t)},e.prototype.clear=function(){this.m_graphic&&this.m_graphic.clear(),this.m_ready=!1},e.prototype.dispose=function(){this.m_graphic&&(this.m_graphic.clear(),this.m_graphic=null),this.m_ready=!1},e.prototype.update=function(t){},e}(t.material);t.effmaterial=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(){function t(){this.m_tex=null,this.m_path="",this.m_dx=0,this.m_dy=0}return t.prototype.re_init=function(){this.clear()},t.prototype.load_res=function(){this.m_tex=Laya.Loader.getRes(this.m_path)},t.prototype.clear=function(){this.m_tex=null,this.m_dx=0,this.m_dy=0},t.prototype.dispose=function(){this.clear()},t}();t.avatar_ani_frame=i;var e=function(e){function _(){var t=e.call(this)||this;return t.m_atlas_path="",t.m_ani_path="",t.m_atlas_data=null,t.m_ani_data=null,t.m_frames=new Array,t.m_b_loaded=!1,t.m_framemillsec=0,t.m_frametotalmillsec=0,t}return __extends(_,e),_.prototype.re_init=function(){this.clear(),this.m_atlas_data=null,this.m_ani_data=null,this.m_aniid=0,this.m_framecount=1,this.m_framespeed=2,this.m_framemillsec=0,this.m_frametotalmillsec=0},_.prototype.load_res=function(){this.m_ani_data=t.mat_mgr().get_avatar_anidata(this.m_ani_path),this.m_atlas_data=t.mat_mgr().get_avatar_anitalasdata(this.m_atlas_path);var e=this.m_ani_data.m_frames.length;this.m_framecount!=e&&(this.m_framecount=e,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed);for(var _=this.m_ani_data.m_anchorX,r=this.m_ani_data.m_anchorY,n=this.m_ani_data.m_dx,s=this.m_ani_data.m_dy,a=0;a<e;++a){var o=utils.getitembycls("avatar_ani_frame",i);o.re_init(),o.m_path=this.m_ani_data.m_frames[a];var m=512;a<this.m_atlas_data.m_frames.length&&(m=this.m_atlas_data.m_frames[a].m_source_w);var h=512;a<this.m_atlas_data.m_frames.length&&(h=this.m_atlas_data.m_frames[a].m_source_h),o.m_dx=n-m*_,o.m_dy=s-h*r,o.load_res(),this.m_frames.push(o)}this.m_b_loaded=!0},_.prototype.clear=function(){this.m_b_loaded=!1;for(var t=0,i=this.m_frames;t<i.length;t++){var e=i[t];e.dispose(),utils.recover("avatar_ani_frame",e)}this.m_frames=new Array},_.prototype.dispose=function(){this.clear()},_}(t.material);t.avatar_ani_mat=e;var _=function(){function t(){this.m_tex=null}return t.prototype.re_init=function(){this.m_tex=null},t.prototype.dispose=function(){this.m_tex=null},t}();t.lavatartexture=_;var r=function(){function t(){this.m_frames=new Array,this.m_use_dir=0,this.m_dir=0,this.m_b_mirror=!1,this.m_m=new Laya.Matrix,this.m_mm=new Laya.Matrix,this.m_matrix=null,this.m_m.a=1,this.m_m.tx=0,this.m_mm.a=-1,this.m_mm.tx=0,this.m_matrix=this.m_m}return t.prototype.set_mirror=function(t){this.m_b_mirror=t,this.m_b_mirror?this.m_matrix=this.m_mm:this.m_matrix=this.m_m},t.prototype.matrix=function(){return this.m_b_mirror?this.m_mm:this.m_m},t.prototype.re_init=function(){this.clear()},t.prototype.clear=function(){for(var t=0,i=this.m_frames;t<i.length;t++){var e=i[t];e.dispose(),utils.recover("lavatartexture",e)}this.m_frames=new Array},t.prototype.dispose=function(){this.clear()},t}();t.lavatartextureframes=r;var n=function(i){function e(){var t=i.call(this)||this;t.m_shape=0,t.m_action=0,t.m_b_loaded=!1,t.m_dir_tex=new Array,t.m_texture_map=new Object,t.m_alink=null,t.m_width=0,t.m_height=0,t.m_cur_link=new Laya.Point(0,0);for(var e=0;e<8;++e)t.m_dir_tex.push(new r);return t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat_res="",this.m_shape=0,this.m_action=0,this.m_alink=null,this.m_width=0,this.m_height=0,this.m_b_loaded=!1,this.clear()},e.prototype.get_link=function(t,i,e){return null!=this.m_alink?this.m_alink.get_pt(this.m_dir_tex[t].m_use_dir,i,e):this.m_cur_link},e.prototype._gen_res_path=function(t,i,e){var _="";_=i.toString();for(var r=e.toString(),n=_.length+r.length;n<5;)_+="0",n++;return _+=r,_=t+(_+=".png")},e.prototype._gen_tex_key=function(t,i){return 1e4*t+i},e.prototype.load_res=function(){for(var i=t.matinfo_mgr()._get_avatar_info(this.m_shape,this.m_action),e=i.prefix,r=i.dir.split(","),n=t.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),s=1==i.mirror,a=0,o=0,m=r;o<m.length;o++){var h=m[o];this.m_dir_tex[a].m_dir=a,this.m_dir_tex[a].m_use_dir=h,this.m_dir_tex[a].set_mirror(!1),s&&(3==a?5==h&&this.m_dir_tex[a].set_mirror(!0):5==a?3==h&&this.m_dir_tex[a].set_mirror(!0):1==a?7==h&&this.m_dir_tex[a].set_mirror(!0):7==a?1==h&&this.m_dir_tex[a].set_mirror(!0):6==a?2==h&&this.m_dir_tex[a].set_mirror(!0):2==a&&6==h&&this.m_dir_tex[a].set_mirror(!0));for(var l=0;l<n;++l){var c=this._gen_res_path(e,h,l),p=this._gen_tex_key(h,l),u=this.m_texture_map[p];null==u&&(null!=(u=Laya.Loader.getRes(c))&&null!=u||console.log("error!tex = null",c),this.m_texture_map[p]=u);var d=utils.getitembycls("lavatartexture",_);d.re_init(),d.m_tex=u,this.m_dir_tex[a].m_frames.push(d)}a+=1}this.m_b_loaded=!0},e.prototype.clear=function(){this.m_alink=null,this.m_b_loaded=!1;for(var t=0,i=this.m_dir_tex;t<i.length;t++){i[t].clear()}for(var e in this.m_texture_map)if(this.m_texture_map.hasOwnProperty(e))this.m_texture_map[e];this.m_texture_map=new Object},e.prototype.dispose=function(){this.clear();for(var t=0,i=this.m_dir_tex;t<i.length;t++){i[t].dispose()}this.m_dir_tex=null},e.prototype.update=function(t){},e}(t.material);t.lavataractionmat=n}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_graphic=new laya.display.Sprite,i}return __extends(i,t),i.prototype.re_init=function(t){this.m_graphic.graphics.clear(),this.m_graphic.loadImage(t)},i.prototype.clear=function(){this.m_graphic.graphics.clear()},i.prototype.dispose=function(){this.m_graphic.graphics.clear(),this.m_graphic=null},i.prototype.update=function(t){},i}(t.material);t.mapbkmaterial=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_res_path=null,t.m_map_id=0,t.m_grid_w=32,t.m_grid_h=32,t.m_buf=null,t.m_block_array=null,t.m_block_w_num=0,t.m_block_h_num=0,t.m_b_n_per_byte=8,t.m_init_sp=!1,t.m_block_cache=null,t.m_graphic=new laya.display.Sprite,t}return __extends(e,i),e.prototype.re_init=function(){},e.prototype.load=function(i){null!=this.m_buf&&(this.m_buf.clear(),this.m_buf=null),this.m_map_id=i,t.mat_mgr().getmapblock(this,this.m_map_id)},e.prototype.setbuff=function(i){this.m_buf=new laya.utils.Byte(i);var e;t.core_tiplog("mapblock setbuff len ",this.m_buf.length),t.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),t.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),t.core_tiplog("mapblock setbuff ",this.m_buf.getByte().toString(16)),t.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),t.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),t.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),t.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),t.core_tiplog("mapblock setbuff bw1 ",this.m_buf.getUint16()),t.core_tiplog("mapblock setbuff bh1 ",this.m_buf.getUint16()),t.core_tiplog("mapblock setbuff ",this.m_buf.getUint32()),this.m_block_w_num=this.m_buf.getUint32(),this.m_block_h_num=this.m_buf.getUint32(),t.core_tiplog("mapblock setbuff bw ",this.m_block_w_num),t.core_tiplog("mapblock setbuff bh ",this.m_block_h_num),e=this.m_buf.getUint32(),t.core_tiplog("mapblock setbuff block_len ",e),this.m_block_array=this.m_buf.getUint8Array(39,e),this.m_init_sp=!1,this.m_block_cache=new Uint8Array(this.m_block_w_num*this.m_block_h_num);for(var _=0;_<this.m_block_h_num;++_)for(var r=0;r<this.m_block_w_num;++r)this.m_block_cache[_*this.m_block_w_num+r]=this.is_block(r,_)?1:0},e.prototype._is_block=function(t,i){return 0!=(t&128>>i)},e.prototype.is_block=function(t,i){if(null!=this.m_buf){var e=i*this.m_block_w_num+t,_=Math.floor(e/this.m_b_n_per_byte),r=this.m_block_array[_],n=e%this.m_b_n_per_byte;return this._is_block(r,n)}return!0},e.prototype.is_block_cache=function(t,i){return null==this.m_buf||t<0||i<0||t>=this.m_block_w_num||i>=this.m_block_h_num||0!=this.m_block_cache[i*this.m_block_w_num+t]},e.prototype.get_block_sp=function(){this.m_init_sp=!0,this.m_graphic.removeChildren();for(var t=0;t<this.m_block_w_num;++t)for(var i=0;i<this.m_block_h_num;++i){0,this.is_block_cache(t,i)?20==t?this.m_graphic.graphics.drawRect(32*t,32*i,32,32,"#ffff00","#000000"):this.m_graphic.graphics.drawRect(32*t,32*i,32,32,"#ff0000","#000000"):this.m_graphic.graphics.drawRect(32*t,32*i,32,32,"#00ff00","#000000")}return this.m_graphic},e.prototype.dispose=function(){this.m_block_array=null,this.m_block_cache=null,null!=this.m_buf&&(this.m_buf.clear(),this.m_buf=null),null!=this.m_graphic&&(this.m_graphic.removeChildren(),this.m_graphic.graphics.clear(),this.m_graphic=null)},e.prototype.update=function(t){},e}(t.material);t.mapblock=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_graphic=null,i.m_tex=null,i.m_res_path=null,i.m_map_id=0,i.m_grid_w=0,i.m_grid_h=0,i.m_graphic=new laya.display.Sprite,i}return __extends(i,t),i.prototype.init=function(){this.m_tex=null},i.prototype.clear=function(){this.m_graphic.graphics.clear(),this.m_tex=null},i.prototype.dispose=function(){this.m_tex=null,this.m_graphic.graphics.clear(),this.m_graphic=null},i.prototype.update=function(t){},i}(t.material);t.mapslotmaterial=i}(core||(core={})),function(t){var i=function(){function i(){this.m_map_slot_dict=new Object,this.m_ani_mat_dict=new Object,this.m_eff_mat_dict=new Object,this.m_avatar_link_dict=new Object,this.m_lavatar_mat_dict=new Object,this.m_lavatar_animat_dict=new Object,this.m_lavatar_anidata_dict=new Object,this.m_lavatar_aniatlasdata_dict=new Object,this.m_mat_loader=new Object,this.m_avatar_shadow_mat=null}return i.prototype.dispose=function(){},i.prototype.get_avatar_shadow_mat=function(){return null==this.m_avatar_shadow_mat&&(this.m_avatar_shadow_mat=new Laya.Texture,this.m_avatar_shadow_mat.load("avatar/shadow.png")),this.m_avatar_shadow_mat},i.prototype.check_release=function(){for(var t in this.m_mat_loader)this.m_mat_loader[t].check_release()},i.prototype.get_avatar_anidata=function(i){if(this.m_lavatar_anidata_dict.hasOwnProperty(i))return this.m_lavatar_anidata_dict[i];var e=Laya.Loader.getRes(i);if(null!=e){var _=t.avatar_ani_struct.parse(e);return this.m_lavatar_anidata_dict[i]=_,_}return null},i.prototype.get_avatar_anitalasdata=function(i){if(this.m_lavatar_aniatlasdata_dict.hasOwnProperty(i))return this.m_lavatar_aniatlasdata_dict[i];var e=Laya.Loader.getRes(i);if(null!=e){var _=t.avatar_atlas_struct.parse(e);return this.m_lavatar_aniatlasdata_dict[i]=_,_}return null},i.prototype.get_mat_loader=function(i){return 0==this.m_mat_loader.hasOwnProperty(i)&&(this.m_mat_loader[i]=new t.material_loader(i)),this.m_mat_loader[i]},i.prototype.add_mat_ref=function(t){this.get_mat_loader(t).addref()},i.prototype.del_mat_ref=function(t){this.get_mat_loader(t).delref()},i.prototype.update=function(t){},i.prototype.onLoadmapslot=function(i,e){var _=Laya.loader.getRes(e),r=this.m_map_slot_dict[i];null!=r?(r.m_graphic.graphics.drawTexture(_,0,0),r.m_tex=_,r.m_res_path=e):t.core_tiplog("materialmgr onLoadmapslot set error ",i,e)},i.prototype.getmapslot=function(i,e,_){var r=i.toString()+"_"+e.toString()+"_"+_.toString(),n=this.m_map_slot_dict[r];if(null==n){var s=t.matinfo_mgr().genmappath(i)+i.toString()+"_tile/"+e.toString()+"_"+_.toString()+".png",a=laya.utils.Handler.create(this,this.onLoadmapslot,[r,s]);t.myload(s,a,null,Laya.Loader.IMAGE,2,!0,i.toString()),(n=utils.getitembycls("mapslotmaterial",t.mapslotmaterial)).init(),n.m_map_id=i,n.m_grid_w=t.matinfo_mgr().m_map_grid_w,n.m_grid_h=t.matinfo_mgr().m_map_grid_h,this.m_map_slot_dict[r]=n,t.core_tiplog("materialmgr getmapslot load ",r,s)}return this.m_map_slot_dict[r]},i.prototype.clearallmapslot=function(){for(var t in this.m_map_slot_dict){var i=this.m_map_slot_dict[t];if(null!=i&&null!=i.m_res_path){Laya.loader.clearResByGroup(i.m_map_id.toString()),i.clear(),utils.recover("mapslotmaterial",i);break}}this.m_map_slot_dict={}},i.prototype.onLoadmapblock=function(i,e){var _=Laya.loader.getRes(e);null!=i&&null!=_&&null!=_?(i.setbuff(_),i.m_res_path=e):t.core_tiplog("rendermap onLoadmapblock set error ",e)},i.prototype.getmapblock=function(i,e){var _=t.matinfo_mgr().genmappath(e)+e.toString()+".bin",r=i,n=laya.utils.Handler.create(this,this.onLoadmapblock,[r,_]);return r.m_map_id=e,t.myload(_,n,null,Laya.Loader.BUFFER,0,!0,e.toString()),r},i.prototype.getmapbkres=function(i){var e=utils.getitembycls("mapbkmaterial",t.mapbkmaterial);return e.re_init(i),e},i.prototype.delmapbkres=function(t){t.clear(),utils.recover("mapbkmaterial",t)},i.prototype.geteffmat=function(i){var e=null,_=t.matinfo_mgr()._get_eff_info(i).path,r=t.matinfo_mgr()._get_eff_info(i).res;(e=utils.getitembycls("effmaterial",t.effmaterial)).re_init(),e.m_ani_id=i,e.m_res_path=r,e.m_ani_path=_,e.m_mat_res=r,e.addref();var n=this.get_mat_loader(e.m_mat_res);return n.m_loaded?e.load_res():(n.add_unload_mat(e),n.load_res(4)),n.addref(),t.core_tiplog("materialmgr geteffmat load ",i,_),e},i.prototype.deleffmat=function(t){var i=this.get_mat_loader(t.m_mat_res);i.del_unload_mat(t),i.delref(),t.delref(),t.clear(),utils.recover("effmaterial",t)},i.prototype.getanimat=function(i){var e=null,_="ani/"+t.matinfo_mgr()._get_ani_info(i).path;(e=utils.getitembycls("animaterial",t.animaterial)).re_init(),e.m_ani_id=i,e.m_res_path=_,e.m_mat_res=_,e.addref();var r=this.get_mat_loader(e.m_mat_res);return r.m_loaded?e.load_res():(r.add_unload_mat(e),r.load_res(4)),r.addref(),t.core_tiplog("materialmgr getanimat load ",i,_),e},i.prototype.delanimat=function(t){var i=this.get_mat_loader(t.m_mat_res);i.del_unload_mat(t),i.delref(),t.delref(),t.clear(),utils.recover("animaterial",t)},i.prototype.onLoadavatar=function(t){null!=t&&t.load_res()},i.prototype.getavataractionmat=function(i,e){var _,r=t.matinfo_mgr().genavatarmatkey(i,e);(_=utils.getitembycls("avataractionmaterial",t.avataractionmaterial)).re_init(),_.m_shape=i,_.m_action=e,_.m_alink=this.getavatarlinkdata(i,e);var n=t.matinfo_mgr()._get_avatar_info(i,e);if(_.addref(),null!=n){var s="avatar/"+n.path;_.m_width=n.w,_.m_height=n.h,1==n.mirror?_.m_b_mirrior=!0:_.m_b_mirrior=!1,1==n.dir4?_.m_b_dir4=!0:_.m_b_dir4=!1,_.m_mat_res=s;var a=this.get_mat_loader(_.m_mat_res);a.m_loaded?_.load_res():(a.add_unload_mat(_),a.load_res(3)),a.addref(),t.core_tiplog("materialmgr getavatarmat load ",r,s)}return _},i.prototype.delavataractionmaterial=function(t){if(t.m_mat_res.length>0){var i=this.get_mat_loader(t.m_mat_res);i.del_unload_mat(t),i.delref()}t.delref(),t.clear(),utils.recover("avataractionmaterial",t)},i.prototype.getlavatarmat=function(i,e){var _,r=t.matinfo_mgr().genavatarmatkey(i,e);if(this.m_lavatar_mat_dict.hasOwnProperty(r.toString()))return(_=this.m_lavatar_mat_dict[r]).addref(),_;(_=utils.getitembycls("lavataractionmat",t.lavataractionmat)).re_init(),_.m_shape=i,_.m_action=e,_.m_alink=this.getavatarlinkdata(i,e);var n=t.matinfo_mgr()._get_avatar_info(i,e);if(_.addref(),null!=n){var s="avatar/"+n.path;_.m_width=n.w,_.m_height=n.h,_.m_mat_res=s;var a=this.get_mat_loader(_.m_mat_res);a.m_loaded?_.load_res():(a.add_unload_mat(_),a.load_res(3)),a.addref(),t.core_tiplog("materialmgr getlavatarmat load ",r,s)}return _},i.prototype.dellavatarmaterial=function(i){if(i.delref(),i.m_ref<=0){var e=t.matinfo_mgr().genavatarmatkey(i.m_shape,i.m_action);if(i.m_mat_res.length>0){var _=this.get_mat_loader(i.m_mat_res);_.del_unload_mat(i),_.delref()}i.clear(),utils.recover("lavataractionmat",i),delete this.m_lavatar_mat_dict[e]}},i.prototype.getlavataranimat=function(i){var e=null;if(this.m_lavatar_animat_dict.hasOwnProperty(i.toString()))return(e=this.m_lavatar_animat_dict[i]).addref(),e;(e=utils.getitembycls("avatar_ani_mat",t.avatar_ani_mat)).re_init();var _=t.matinfo_mgr()._get_eff_info(i).path,r=t.matinfo_mgr()._get_eff_info(i).res;e.m_aniid=i,e.m_ani_path=_,e.m_mat_res=r,e.m_atlas_path=r,e.m_aw=t.matinfo_mgr().geteffw(i),e.m_ah=t.matinfo_mgr().geteffh(i),e.m_framecount=t.matinfo_mgr().geteffframecount(i),e.m_framespeed=t.matinfo_mgr().geteffframespeed(i),e.m_framemillsec=1e3/e.m_framespeed,e.m_frametotalmillsec=1e3*e.m_framecount/e.m_framespeed,e.addref();var n=this.get_mat_loader(e.m_mat_res);return n.m_loaded?e.load_res():(n.addextrares(e.m_ani_path,Laya.Loader.JSON),n.add_unload_mat(e),n.load_res(4)),n.addref(),t.core_tiplog("materialmgr getlavataranimat load ",i,_),e},i.prototype.dellavataranimat=function(t){if(t.delref(),t.m_ref<=0){if(t.m_mat_res.length>0){var i=this.get_mat_loader(t.m_mat_res);i.del_unload_mat(t),i.delref()}t.clear(),utils.recover("avatar_ani_mat",t),delete this.m_lavatar_animat_dict[t.m_aniid]}},i.prototype.setavatarlinkdata=function(i,e,_,r,n){this.clearavatarlinkdata(i,e);var s=utils.getitembycls("avatarlink",t.avatarlink);s.init(),n?s.set_txt_buff(_,r):s.set_buff(_,r);var a=t.matinfo_mgr()._gen_avatarlink_key(i,e);this.m_avatar_link_dict[a]=s},i.prototype.clearavatarlinkdata=function(i,e){var _=t.matinfo_mgr()._gen_avatarlink_key(i,e);if(this.m_avatar_link_dict.hasOwnProperty(_)){var r=this.m_avatar_link_dict[_];r.dispose(),utils.recover("avatarlink",r),delete this.m_avatar_link_dict[_]}},i.prototype.getavatarlinkdata=function(i,e){var _=t.matinfo_mgr()._gen_avatarlink_key(i,e);if(this.m_avatar_link_dict.hasOwnProperty(_))return this.m_avatar_link_dict[_];var r=t.matinfo_mgr()._gen_avatarlink_filename(i,e);if(null==r||r.length<=0)return null;var n,s=!0,a=null;if(null==(a=t.filepack_ins().get_file("link_data_txt",r))&&(a=t.filepack_ins().get_file("link_data",r),s=!1),null==a)return null;n=s?t.filepack_ins().get_file_len("link_data_txt",r):t.filepack_ins().get_file_len("link_data",r);var o=utils.getitembycls("avatarlink",t.avatarlink);return o.init(),s?o.set_txt_buff(a,n):o.set_buff(a,n),this.m_avatar_link_dict[_]=o,o},i}();t.materialmgr=i;var e=null;t.mat_mgr=function(){return null==e&&(e=new i),e}}(core||(core={}));var net;__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(){return function(t,i){this.m_cmd=0,this.m_data=null,this.m_cmd=t,this.m_data=i}}();t.protocol_item=i;var e=function(){function e(){this.m_b_connect=!1,this.m_recv_list=new Array,this.m_protocol_map=new Object,this.m_s2c_protocol_map=new Object,this.m_protobuf_root=null,this.m_buf_handle=new protocolbuf.protocolbuf,this.m_byte=new Laya.Byte,this.m_tmp_buf=new Laya.Byte,this.m_byte.endian=Laya.Byte.BIG_ENDIAN,this.m_socket=new Laya.Socket,this.m_socket.on(Laya.Event.OPEN,this,this.openHandler),this.m_socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.m_socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.m_socket.on(Laya.Event.ERROR,this,this.errorHandler)}return e.prototype.init=function(){null==this.m_protobuf_root&&core.net_errlog("game_net_mgr init")},e.prototype.on_protobuf_loaded=function(i,e){core.net_errlog("game_net_mgr on_protobuf_loaded ",i,e),t.net_ins().m_protobuf_root=e},e.prototype.get_s2c_protocol_cls=function(t){if(null==this.m_s2c_protocol_map[t]){if(null==protocol_def.S2C_CMD_2_TYPE[t])return core.net_errlog("game_net_mgr get_s2c_protocol_cls error!! ",t),null;var i=protocol_def.S2C_CMD_2_TYPE[t.toString()],e=this.m_protobuf_root.lookupType(i);this.m_s2c_protocol_map[t]=e}return this.m_s2c_protocol_map[t]},e.prototype.get_protocol_cls=function(t){if(null==this.m_protocol_map[t]){if(null==protocol_def.C2S_CMD_2_TYPE[t])return core.net_errlog("game_net_mgr get_protocol_cls error!! ",t),null;var i=protocol_def.C2S_CMD_2_TYPE[t.toString()],e=this.m_protobuf_root.lookupType(i);this.m_protocol_map[t]=e}return this.m_protocol_map[t]},e.prototype.openHandler=function(t){void 0===t&&(t=null),core.net_errlog("=======openHandler ",t),this.m_b_connect=!0,utils.event_ins().fire_event(game_event.EVENT_NET_CONNECTED)},e.prototype.receiveHandler=function(t){void 0===t&&(t=null);var e=this.m_buf_handle.s2c_buf2data(this.m_socket.input),_=e.cmd,r=e.data;this.m_recv_list.push(new i(_,r)),core.net_errlog("recv ",_,r)},e.prototype.closeHandler=function(t){void 0===t&&(t=null),core.net_errlog("=======closeHandler ",t),utils.event_ins().fire_event(game_event.EVENT_NET_CLOSED,t),this.close()},e.prototype.errorHandler=function(t){void 0===t&&(t=null),core.net_errlog("=======errorHandler ",t),utils.event_ins().fire_event(game_event.EVENT_NET_ERROR,t),this.close()},e.prototype.connect=function(t,i,e){void 0===e&&(e=11),this.m_b_connect&&this.close();var _="ws://"+t+":"+i.toString();this.m_socket.connectByUrl(_)},e.prototype.close=function(){this.m_b_connect&&(this.m_socket.close(),this.m_socket.cleanSocket()),this.m_b_connect=!1},e.prototype.send_raw_buff=function(t,i){if(core.net_errlog("send send_raw_buff ",t.toString(16)),0!=this.m_b_connect){var e=this.m_buf_handle.c2s_rawbuff2buf(t,i);this.m_socket.send(e.buffer),core.net_errlog("send send_raw_buff ",t.toString(16),e.length),this.m_socket.flush()}},e.prototype.send=function(t,i){if(void 0===i&&(i=null),core.net_tiplog("game_net_mgr send ",t,i,this.m_b_connect),0!=this.m_b_connect){var e=this.m_buf_handle.c2s_data2buf(t,i);core.net_tiplog("c2s buf ",e),core.net_tiplog("send databuflen ",e.length),this.m_socket.send(e.buffer),core.net_tiplog("send bufferlen ",e.length),this.m_socket.flush()}},e.prototype.update=function(){if(this.m_recv_list.length>0){for(var t=0,i=this.m_recv_list;t<i.length;t++){var e=i[t];utils.event_ins().fire_event(game_event.gen_netcmd_event(e.m_cmd),e.m_data)}this.m_recv_list=new Array}},e.prototype.dispose=function(){this.m_b_connect&&this.close()},e}();t.game_net_mgr=e;var _=[2421017128,944700278,3597879372,543195225,615609371,79095973,2885087988,2014019705,3182056064,933482824,2837597272,2270166524,4262461171,2410585700,3110862077,4135951199,2096971708,1870535724,807074513,3100559001,2750774944,3034115174,2332016203,1921350898,2393502071,3608787775,3946381035,2138888167,2279707291,525803258,3753769097,325057777,1306726518,3452919620,3244222623,722984785,2401034239,4232246011,2615356152,706510068,790418703,2104616424,3204118350,939478278,4042798641,3896753369,1739758764,2638025168,2097149256,4188968811,1944768271,2909158585,3533173142,3293651166,999980935,1066444197,1247435342,3773656417,1996108900,589768527,1304154597,3078156774,2408315896,398644441],r=function(){function t(){this.m_seed=0,this.m_bfish=new blowfish.CBlowFish,this.m_buff=new Laya.Byte;for(var t=0;t<_.length;++t)this.m_buff.writeUint32(_[t]);this.m_buff.pos=0,this.m_bfish.InitializeKey(this.m_buff),this.m_bfish.Initialize(3022389628)}return t.prototype.print_data=function(){this.m_bfish._print_array("print_data",!0)},t.prototype.MixKey=function(t){this.m_bfish.InitializeKey(t)},t.prototype.Create=function(t){this.m_bfish.Initialize(t)},t.prototype.Encode=function(t){this.m_bfish.Encode(t)},t.prototype.Decode=function(t){this.m_bfish.Decode(t)},t.prototype.GetSeed=function(){return this.m_seed},t}();t.CLoginEncode=r;var n=[1851554275,1986835509,4189688633,1012854005,3714495462,1619558451,3792216072,1764367207,362855653,2131378364,3858518866,3031713739,494281646,645737092,3120145297,3897244085,2064705853,1975659352,2661204187,3398779783,1640207804,834224019,3656231674,4122874472,3423678618,1228553645,2554098444,383313281,2439000095,2167838853,2551399170,2902517165,4132634850,2812983208,185456121,1961678951,3014995244,1775643882,3140414513,3598669284,2678620157,3304132233,3577231914,1743844886,2939582962,3647095842,1467598307,4088362055,3665214298,3439858470,115598572,1945394254,20494853,68691148,4271188760,2028697492,2767983744,2916594463,1844568672,2824467365,2299960696,3062497994,4290442823,858888274],s=function(){function t(){this.m_seed=0,this.m_bfish=new blowfish.CBlowFish,this.m_buff=new Laya.Byte;for(var t=0;t<n.length;++t)this.m_buff.writeUint32(n[t]);this.m_buff.pos=0,this.m_bfish.InitializeKey(this.m_buff)}return t.prototype.MixKey=function(t){this.m_bfish.InitializeKey(t)},t.prototype.Create=function(t){this.m_bfish.Initialize(t)},t.prototype.Encode=function(t){this.m_bfish.Encode(t)},t.prototype.Decode=function(t){this.m_bfish.Decode(t)},t.prototype.GetSeed=function(){return this.m_seed},t}();t.CLoginDecode=s;var a=function(t){function e(){var i=t.call(this)||this;return i.m_buff=new laya.utils.Byte,i.m_svrid=0,i.m_host="",i.m_port=0,i.m_loginstep=0,i.m_b_connected=!1,i.m_loginencode=null,i.m_logindecode=null,i.m_sendencode=new myencode.MyEncode,i.m_recvdecode=null,i.m_loginIdx=0,i.m_decodebuff=new laya.utils.Byte,i.m_sendbuff=new laya.utils.Byte,i.m_parent=null,i.m_testsendcount=999,i.m_buff.endian=Laya.Byte.BIG_ENDIAN,processencode.RC4_InitCode(),i.m_recvdecode=new processencode.CProcessEncode,i}return __extends(e,t),e.prototype.connect=function(t,i,e){void 0===e&&(e=11),this.close(),this.m_svrid=e,this.m_host=t,this.m_port=i,null==this.m_socket&&(this.m_socket=new laya.net.Socket,this.m_socket.endian=Laya.Byte.BIG_ENDIAN,this.m_socket.on(Laya.Event.OPEN,this,this.openHandler),this.m_socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.m_socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.m_socket.on(Laya.Event.ERROR,this,this.errorHandler)),this.m_socket.connectByUrl("ws://"+t+":"+i.toString())},e.prototype._getbuffuint8=function(t,i){var e=t.pos;t.pos=i;var _=t.getUint8();return t.pos=e,_},e.prototype._setbuffuint8=function(t,i,e){var _=t.pos;t.pos=i,t.writeUint8(e),t.pos=_},e.prototype.testfunc2=function(){for(var t=[202,194,246,253,63,48,46,4,224,246,143,166,113,167,242,11,185,210,239,233,213,207,43,17,175,128,139,58,99,147,86,115],i=new laya.utils.Byte,e=0;e<t.length;++e)i.writeUint8(t[e]);this._print_pkg(i,"recv src "),this.m_recvdecode.Create(4148050427),this.m_recvdecode.Encode(i),this._print_pkg(i,"recv decode ")},e.prototype.testfunc=function(){for(var t=new laya.utils.Byte,i=[202,194,246,253,63,48,46,4,224,246,143,166,113,167,242,11,185,210,239,233,213,207,43,17,175,128,139,58,99,147,86,115,33,178,208,174,211,59,151,157],e=0;e<40;++e)t.writeUint8(i[e]);this._print_pkg(t,"testbuff "),this.m_loginIdx=0,t.pos=0;for(e=0;e<39;++e)this.m_loginIdx+=this._getbuffuint8(t,e)^this._getbuffuint8(t,e+1);this.m_loginIdx=this.m_loginIdx%36,core.net_errlog("this.m_loginIdx ",this.m_loginIdx);var _=new laya.utils.Byte;t.pos=3;for(e=0;e<32;++e)_.writeUint8(t.getUint8());this._print_pkg(_,"testbuff mixkey "),_.pos=0,null==this.m_logindecode&&(this.m_logindecode=new s),this.m_logindecode.MixKey(_),_.pos=0,null==this.m_loginencode&&(this.m_loginencode=new r),this.m_loginencode.MixKey(_);var n=new r;_.pos=0,n.MixKey(_);var a=[241,115,60,37,104,16,197,226,44,133,19,255,239,107,60,228,136,172,68,104,140,93,67,158,78,18,32,116,4,5,11,124,103,158,186,110,198,60,64,195],o=new laya.utils.Byte;for(e=0;e<40;++e)o.writeUint8(a[e]);o.pos=0,this.m_logindecode.Decode(o),this._print_pkg(o,"tempbuff "),o.pos=27;var m=o.getUint32();o.pos=this.m_loginIdx;var h=o.getUint32();core.net_errlog("m_nToken tmpkey ",m.toString(16),h.toString(16));var l=[217,166,31,153,168,8,104,233,157,89,84,131,219,33,82,166],c=new laya.utils.Byte;for(e=0;e<l.length;++e)c.writeUint8(l[e]);this._print_pkg(c,"send secondpkg src "),c.pos=0,this.m_loginencode.Encode(c),this._print_pkg(c,"send secondpkg encoded "),c.pos=0,n.Decode(c),this._print_pkg(c," econdpkg decode ")},e.prototype._print_pkg=function(t,i){void 0===i&&(i=""),core.net_errlog("======_print_pkg start ",i,t.length);var e=t.pos;t.pos=0;for(var _="",r=0;r<t.length;){_="";for(var n=0;n<32;++n){var s=t.getUint8();if(_=s<=15?_+" 0"+s.toString(16):_+" "+s.toString(16),(r+=1)>=t.length)break}core.net_errlog(_)}core.net_errlog("======_print_pkg end"),t.pos=e},e.prototype._gen_firstpkg=function(){for(var t=new laya.utils.Byte,i=0,e=0;e<40;++e)i=Math.floor(255*Math.random()),t.writeUint8(i);var _=65535&(27285^this.m_svrid);t.pos=35,t.writeUint16(_),this._setbuffuint8(t,35,this._getbuffuint8(t,35)^this._getbuffuint8(t,5)),this._setbuffuint8(t,36,this._getbuffuint8(t,36)^this._getbuffuint8(t,16)),this._setbuffuint8(t,39,114^this._getbuffuint8(t,18)),this._setbuffuint8(t,13,78^this._getbuffuint8(t,19)),this._setbuffuint8(t,17,163^this._getbuffuint8(t,12)),this._setbuffuint8(t,23,248^this._getbuffuint8(t,19)),this._setbuffuint8(t,28,149^this._getbuffuint8(t,9)),this.m_loginIdx=0,t.pos=0;for(e=0;e<39;++e)this.m_loginIdx+=this._getbuffuint8(t,e)^this._getbuffuint8(t,e+1);this.m_loginIdx=this.m_loginIdx%36;var n=new laya.utils.Byte;t.pos=3;for(e=0;e<32;++e)n.writeUint8(t.getUint8());return n.pos=0,null==this.m_logindecode&&(this.m_logindecode=new s),this.m_logindecode.MixKey(n),n.pos=0,null==this.m_loginencode&&(this.m_loginencode=new r),this.m_loginencode.MixKey(n),t},e.prototype.send_firstpkg=function(){var t=this._gen_firstpkg();t.pos=0,this.m_socket.send(t.buffer),this.m_socket.flush()},e.prototype.send_secondpkg=function(t){var i=new laya.utils.Byte;i.writeUint8(192),i.writeUint8(168),i.writeUint8(1),i.writeUint8(110);var e=new laya.utils.Byte;e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0);for(var _=[168,65,156,55],r=[84,131,219,33,82,166],n=0;n<4;++n)this._setbuffuint8(i,n,_[n]^this._getbuffuint8(i,n));for(n=0;n<6;++n)this._setbuffuint8(e,n,r[n]^this._getbuffuint8(e,n));var s=new laya.utils.Byte,a=0;for(n=0;n<6;++n)a=Math.floor(255*Math.random()),s.writeUint8(a);var o=t%3;s.pos=o,s.writeUint32(t);var m=new laya.utils.Byte;s.pos=0;for(n=0;n<s.length;++n)m.writeUint8(s.getUint8());i.pos=0;for(n=0;n<i.length;++n)m.writeUint8(i.getUint8());e.pos=0;for(n=0;n<e.length;++n)m.writeUint8(e.getUint8());m.pos=0,this.m_loginencode.Encode(m),m.pos=0,this.m_socket.send(m.buffer),this.m_socket.flush()},e.prototype.get_first_seed=function(t){void 0===t&&(t=null);for(var i=t,e=0;e<i.length;++e)this.m_buff.writeUint8(i.getUint8());if(this.m_buff.length<40)core.net_errlog("get_first_seed this.m_buff.length < firstpkglen ",this.m_buff.length);else{var _=new laya.utils.Byte;this.m_buff.pos=0;for(e=0;e<40;++e)_.writeUint8(this.m_buff.getUint8());for(var r=new laya.utils.Byte;this.m_buff.pos<this.m_buff.length;)r.writeUint8(this.m_buff.getUint8());this.m_buff=r,_.pos=0,this.m_logindecode.Decode(_);var n=this.m_loginIdx;_.pos=27;var s=_.getUint32();_.pos=n;var a=_.getUint32();this.m_logindecode.Create(a),this.send_secondpkg(s),this.m_loginIdx=0,_.pos=0;for(e=0;e<_.length-1;++e)this.m_loginIdx+=this._getbuffuint8(_,e)^this._getbuffuint8(_,e+1);this.m_loginIdx=this.m_loginIdx%32,this.m_loginstep=1}},e.prototype.get_second_seed=function(t){void 0===t&&(t=null);for(var i=t,e=0;e<i.length;++e)this.m_buff.writeUint8(i.getUint8());if(this.m_buff.length<40)core.net_errlog("get_second_seed this.m_buff.length < secondpkglen ",this.m_buff.length);else{var _=new laya.utils.Byte;this.m_buff.pos=0;for(e=0;e<40;++e)_.writeUint8(this.m_buff.getUint8());for(var r=new laya.utils.Byte;this.m_buff.pos<this.m_buff.length;)r.writeUint8(this.m_buff.getUint8());this.m_buff=r,_.pos=0,this.m_logindecode.Decode(_);var n=this.m_loginIdx;_.pos=n;var s=_.getUint32(),a=n+4;_.pos=a;_.getUint32();this.m_recvdecode.Create(s),this.m_loginstep=2,this.m_b_connected=!0,null!=this.m_parent&&this.m_parent.on_notify("connect succeed"),core.net_errlog("connected succeed"),utils.event_ins().fire_event(game_event.EVENT_NET_CONNECTED),this.m_buff.length>0&&(this.m_buff.pos=0,this._decrypt_buff(this.m_buff),this._on_split_netpack())}},e.prototype._testsend=function(t){t.toString();for(var i=8;i>0;)" lalala,hello svr!",i-=1},e.prototype.openHandler=function(t){void 0===t&&(t=null),core.net_errlog("TL_Login_net openHandler ",t),this.send_firstpkg()},e.prototype._decrypt_buff=function(t){var i=t.pos;t.pos=0,this.m_recvdecode.Encode(t),t.pos=i},e.prototype._on_split_netpack=function(){for(;this.m_buff.bytesAvailable>0;){var t=this.m_buf_handle.s2c_buf2data_tl(this.m_buff);if(null==t){if(this.m_buff.pos>0){for(var e=new laya.utils.Byte;this.m_buff.bytesAvailable>0;)e.writeUint8(this.m_buff.getUint8());this.m_buff.clear(),this.m_buff=e}return}var _=t.cmd,r=t.data;this.m_recv_list.push(new i(_,r)),core.net_tiplog("recv ",_.toString(16),r)}this.m_buff.clear()},e.prototype.receiveHandler=function(t){if(void 0===t&&(t=null),0==this.m_loginstep)this.get_first_seed(this.m_socket.input);else if(1==this.m_loginstep)this.get_second_seed(this.m_socket.input);else{core.net_errlog("TL_Login_net receiveHandler ",t,t.length,this.m_socket.input.length);var i=this.m_socket.input;for(this.m_decodebuff.clear();i.pos<i.length;)this.m_decodebuff.writeUint8(i.getUint8());for(this.m_decodebuff.pos=0,this._decrypt_buff(this.m_decodebuff),this.m_buff.length>0&&(this.m_buff.pos=this.m_buff.length-1),this.m_decodebuff.pos=0;this.m_decodebuff.pos<this.m_decodebuff.length;)this.m_buff.writeUint8(this.m_decodebuff.getUint8());this.m_buff.pos=0,this._on_split_netpack()}},e.prototype.send_raw_buff=function(t,i){core.net_errlog("send_raw_buff ",t.toString(16),i.length),this.m_sendbuff.clear(),this.m_sendbuff.endian=Laya.Byte.LITTLE_ENDIAN;var e=this.m_buf_handle.c2s_rawbuff2buf_tl(t,i,this.m_sendbuff);e.pos=0,this.m_sendencode.Encode(e),e.pos=0,this.m_socket.send(e.buffer),core.net_errlog("send send_raw_buff len ",t.toString(16),e.length),this.m_socket.flush()},e.prototype.send=function(t,i){if(void 0===i&&(i=null),this.m_b_connected){core.net_errlog("send ",t.toString(16),i),this.m_sendbuff.clear(),this.m_sendbuff.endian=Laya.Byte.LITTLE_ENDIAN;var e=this.m_buf_handle.c2s_data2buf_tl(t,i,this.m_sendbuff);e.pos=0,this.m_sendencode.Encode(e),e.pos=0,this.m_socket.send(e.buffer),core.net_errlog("send bufferlen ",t.toString(16),e.length),this.m_socket.flush()}else alert("Have not connected to svr")},e.prototype.testlogin=function(t,i){if(this.m_b_connected){this.m_sendbuff.clear();this.m_sendbuff.clear();var e=this.m_sendbuff;e.endian=Laya.Byte.BIG_ENDIAN,e.writeUint8(130),this.m_sendbuff.writeUint16(151),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(1),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(2),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(0),this.m_sendbuff.writeUint16(3),this.m_sendbuff.writeUTFBytes(t);for(var _=64-t.length;_>0;)this.m_sendbuff.writeUint8(0),_-=1;this.m_sendbuff.writeUTFBytes(i);for(var r=32-i.length;r>0;)this.m_sendbuff.writeUint8(0),r-=1;this.m_sendbuff.writeUint8(0),this.m_sendbuff.writeUint8(0),this.m_sendbuff.writeUint8(0);for(var n=11;n>0;)this.m_sendbuff.writeUint8(0),n-=1;this._print_pkg(this.m_sendbuff,"testlogin src"),this.m_sendbuff.pos=0,this.m_sendencode.Encode(this.m_sendbuff),this._print_pkg(this.m_sendbuff,"testlogin encode "),this.m_sendbuff.pos=0,this.m_socket.send(this.m_sendbuff.buffer),core.net_errlog("testlogin bufferlen ",this.m_sendbuff.length),this.m_socket.flush()}else alert("Have not connected to svr")},e.prototype.close=function(){t.prototype.close.call(this),this.m_loginstep=0,this.m_b_connected=!1},e.prototype.dispose=function(){this.close()},e}(e);t.TL_Login_net=a;var o=null,m=!1;t.net_ins=function(){return null==o&&(o=m?new e:new a),o},t.my_svr=function(t){m=t},t.is_mysvr=function(){return m},t.clear=function(){null!=o&&(o.dispose(),o=null)}}(net||(net={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_framecurrent=0,t.m_framemillsec=0,t.m_framecurrenttm=0,t}return __extends(e,i),e.prototype.re_init=function(e,_,r,n){void 0===n&&(n=!0),this.set_id(),this.m_aniid=e,this.m_rc=utils.getitembycls("anicommand",t.anicommand),this.m_rc.re_init(this),i.prototype.set_pos.call(this,_,r),this.m_data=n,this.m_mat=null,this.m_aw=t.matinfo_mgr().getaniw(this.m_aniid),this.m_ah=t.matinfo_mgr().getanih(this.m_aniid),this.m_framecount=t.matinfo_mgr().getaniframecount(this.m_aniid),this.m_framespeed=t.matinfo_mgr().getaniframespeed(this.m_aniid),this.m_framemillsec=1e3/this.m_framespeed,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah)},e.prototype.project=function(e){var _=i.prototype.project.call(this,e);return _&&null==this.m_mat&&(this.m_mat=t.mat_mgr().getanimat(this.m_aniid),this.addChild(this.m_mat.m_graphic)),_},e.prototype.update=function(t){this.m_framecurrenttm+=t;var i=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=i%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(t.mat_mgr().delanimat(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("anicommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.renderani=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.graphics.loadImage("avatar/default.png"),i}return __extends(i,t),i}(Laya.Sprite);t.renderavatar_default=i;var e=function(t){function i(){var i=t.call(this)||this;return i.graphics.loadImage("avatar/shadow.png"),i}return __extends(i,t),i}(Laya.Sprite);t.renderavatar_shadow=e;var _=function(t){function i(){var i=t.call(this)||this;return i.m_id=0,i.m_front=!0,i.m_dx=0,i.m_dy=0,i.m_id=i._gen_id(),i}return __extends(i,t),i.prototype._gen_id=function(){return i.S_ADORN_IDMAX++},i.prototype.draw2sp=function(t,i,e,_){void 0===_&&(_=!0)},i.prototype.update=function(t){},i.prototype.dispose=function(){},i.S_ADORN_IDMAX=1,i}(Laya.Sprite);t.renderavatar_adorn=_;var r=function(i){function e(){var t=i.call(this)||this;return t.m_framecurrent=0,t.m_framemillsec=0,t.m_frametotalmillsec=0,t.m_framecurrenttm=0,t.m_b_loop=!0,t.m_b_end=!1,t.m_b_autodel=!1,t.m_b_loaded=!1,t}return __extends(e,i),e.prototype.re_init=function(i){this.m_id=this._gen_id(),this.m_aniid=i,this.m_mat=null,this.m_aw=t.matinfo_mgr().geteffw(this.m_aniid),this.m_ah=t.matinfo_mgr().geteffh(this.m_aniid),this.m_framecount=t.matinfo_mgr().geteffframecount(this.m_aniid),this.m_framespeed=t.matinfo_mgr().geteffframespeed(this.m_aniid),this.m_b_loop=t.matinfo_mgr().geteffcycle(this.m_aniid),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_b_loaded=!1},e.prototype.load_res=function(){return!!this.m_b_loaded||(null==this.m_mat&&(this.m_mat=t.mat_mgr().geteffmat(this.m_aniid),this.addChild(this.m_mat.m_graphic),this.m_b_loaded=!0),!0)},e.prototype.update=function(t){if(0!=this.m_b_loaded&&!this.m_b_end){if(this.m_framecurrenttm+=t,this.m_framecurrenttm>=this.m_frametotalmillsec){if(this.m_b_autodel)return void(this.m_b_end=!0);if(0==this.m_b_loop)return void(this.m_b_end=!0)}var i=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=i%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)}},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(t.mat_mgr().deleffmat(this.m_mat),this.m_mat=null),i.prototype.dispose.call(this),utils.recover("avatar_aura",this)},e}(_);t.avatar_aura=r;var n=function(i){function e(){var t=i.call(this)||this;return t.m_framecurrent=0,t.m_framecurrenttm=0,t.m_b_loaded=!1,t}return __extends(e,i),e.prototype.re_init=function(t){this.m_id=this._gen_id(),this.m_aniid=t,this.m_mat=null,this.m_framecurrent=0,this.m_framecurrenttm=0,this.m_b_loaded=!1,this.m_dx=0,this.m_dy=0,this.m_front=!0},e.prototype.load_res=function(){return 0==this.m_b_loaded&&(null==this.m_mat&&(this.m_mat=t.mat_mgr().getlavataranimat(this.m_aniid)),this.m_b_loaded=this.m_mat.m_b_loaded),!0},e.prototype.draw2sp=function(t,i,e,_){if(void 0===_&&(_=!0),this.m_b_loaded&&null!=this.m_mat&&this.m_mat.m_b_loaded&&this.m_front==_){var r=this.m_mat.m_frames[this.m_framecurrent];t.graphics.drawTexture(r.m_tex,i+r.m_dx+this.m_dx,e+r.m_dy+this.m_dy)}},e.prototype.update=function(t){if(this.m_framecurrenttm+=t,this.m_b_loaded){var i=Math.floor(this.m_framecurrenttm/this.m_mat.m_framemillsec);this.m_framecurrent=i%this.m_mat.m_framecount}},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(t.mat_mgr().dellavataranimat(this.m_mat),this.m_mat=null),i.prototype.dispose.call(this),utils.recover("avatar_aura_new",this)},e}(_);t.avatar_aura_new=n;var s=function(_){function n(){var t=_.call(this)||this;return t.m_shape=0,t.m_shape_weapon=0,t.m_shape_wing=0,t.m_shape_ride=0,t.m_shape_backride=0,t.m_shape_hair=0,t.m_aura_id=0,t.m_aura_adorn=null,t.m_title_id=0,t.m_title_adorn=null,t.m_action=0,t.m_lastaction=0,t.m_dir=0,t.m_framecurrent=0,t.m_framemillsec=0,t.m_frametotalmillsec=0,t.m_framecurrenttm=0,t.m_mat_dx=0,t.m_mat_dy=-256,t.m_ride_h=0,t.m_user_data=0,t.m_name="",t.m_name_dx=0,t.m_name_dy=0,t.m_name_sp=null,t.m_hp=null,t.m_buff=null,t.m_b_cycle=!0,t.m_b_stop_frame=-1,t.m_sp_front=null,t.m_sp_back=null,t.m_sp_center=null,t.m_sp_center_f=null,t.m_sp_center_b=null,t.m_sp_center_c=null,t.m_sp_center_rf=null,t.m_sp_center_rb=null,t.m_adorn_list=new Array,t.m_dx=0,t.m_dy=0,t.m_org_pt=new Laya.Point(0,0),t.m_shadow_sp=null,t.m_default_sp=null,t.m_draw_avatar=!1,t.m_use_default=!0,t.m_draw_link=!1,t}return __extends(n,_),n.prototype.re_init=function(i,r,n,s){void 0===s&&(s=!0),this.set_id(),this.m_name_dx=0,this.m_name_dy=0,this.m_draw_link=!1,this.m_sp_front=new Laya.Sprite,this.m_sp_back=new Laya.Sprite,this.m_sp_center=new Laya.Sprite,this.m_sp_center_rb=new Laya.Sprite,this.m_sp_center_rf=new Laya.Sprite,this.m_sp_center_b=new Laya.Sprite,this.m_sp_center_c=new Laya.Sprite,this.m_sp_center_f=new Laya.Sprite,this.m_shadow_sp=utils.getitembycls("renderavatar_shadow",e),this.addChild(this.m_shadow_sp),this.m_shadow_sp.x=-50,this.m_shadow_sp.y=-35,this.set_ride_h(0),this.m_mat_dy=-256,this.m_use_default=s,this.m_use_default?(this.m_draw_avatar=!1,this.create_default_sp()):this.m_draw_avatar=!0,this.m_sp_center.addChild(this.m_sp_center_rb),this.m_sp_center.addChild(this.m_sp_center_b),this.m_sp_center.addChild(this.m_sp_center_c),this.m_sp_center.addChild(this.m_sp_center_f),this.m_sp_center.addChild(this.m_sp_center_rf),this.m_dx=0,this.m_dy=0,this.addChild(this.m_sp_back),this.addChild(this.m_sp_center),this.addChild(this.m_sp_front),this.m_shape=i,this.rotation=0,this.alpha=1,this.m_rc=utils.getitembycls("avatarcommand",t.avatarcommand),this.m_rc.re_init(this),_.prototype.set_pos.call(this,r,n),this.m_mat=null,this.m_mat_weapon=null,this.m_mat_wing=null,this.m_mat_ride=null,this.m_mat_backride=null,this.m_mat_hair=null,this.m_shape_weapon=0,this.m_shape_wing=0,this.m_shape_ride=0,this.m_shape_backride=0,this.m_shape_hair=0,this.m_aura_id=0,this.m_aura_adorn=null,this.m_title_id=0,this.m_title_adorn=null,this.reset_data()},n.prototype.show_shadow=function(t){t?this.addChildAt(this.m_shadow_sp,0):this.m_shadow_sp.removeSelf()},n.prototype.set_dxy=function(t,i){this.m_dx=t,this.m_dy=i,this.m_sp_front.x=this.m_dx,this.m_sp_front.y=this.m_dy,this.m_sp_center.x=this.m_dx,this.m_sp_center.y=this.m_dy,this.m_sp_back.x=this.m_dx,this.m_sp_back.y=this.m_dy},n.prototype.change_shape=function(i){i!=this.m_shape&&(null!=this.m_mat&&(this.m_mat.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat),this.m_mat=null),this.m_shape=i,this.reset_data(),this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},n.prototype.change_weapon=function(i){i!=this.m_shape_weapon&&(null!=this.m_mat_weapon&&(this.m_mat_weapon.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat_weapon),this.m_mat_weapon=null),this.m_shape_weapon=i)},n.prototype.change_wing=function(i){i!=this.m_shape_wing&&(null!=this.m_mat_wing&&(this.m_mat_wing.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat_wing),this.m_mat_wing=null),this.m_shape_wing=i)},n.prototype.change_ride=function(i,e){i!=this.m_shape_ride&&(null!=this.m_mat_ride&&(this.m_mat_ride.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(this.m_mat_backride.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat_backride),this.m_mat_backride=null),this.m_shape_ride=i,this.m_shape_backride=e,this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},n.prototype.set_ride_h=function(t){this.m_ride_h=t},n.prototype.change_hair=function(i){i!=this.m_shape_hair&&(null!=this.m_mat_hair&&(this.m_mat_hair.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(this.m_mat_hair),this.m_mat_hair=null),this.m_shape_hair=i)},n.prototype.change_aura=function(t){if(0!=this.m_aura_id&&(this.del_adorn(this.m_aura_id),this.m_aura_adorn=null,this.m_aura_id=0),0!=t){var i=utils.getitembycls("avatar_aura",r);i.re_init(t),this.m_aura_id=i.m_id,this.m_aura_adorn=i,this.add_adorn(i,!0)}},n.prototype.change_title=function(t){if(0!=this.m_title_id&&(this.del_adorn(this.m_title_id),this.m_title_adorn=null,this.m_title_id=0),0!=t){var i=utils.getitembycls("avatar_aura",r);i.re_init(t),this.m_title_id=i.m_id,this.m_title_adorn=i,this.add_adorn(i,!1)}},n.prototype.reset_data=function(){this.m_aw=t.matinfo_mgr().getavataractionw(this.m_shape,this.m_action),this.m_ah=t.matinfo_mgr().getavataractionh(this.m_shape,this.m_action),this.m_framecount=t.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),this.m_framespeed=t.matinfo_mgr().getavataractionframespeed(this.m_shape,this.m_action),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_framecurrenttm=0,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah),t.core_tiplog("renderavatar resetdata ",this.m_obj_id,this.m_shape,this.m_dir,this.m_action,this.m_framecount)},n.prototype.set_name=function(i){this.m_name=i,null==this.m_name_sp&&(this.m_name_sp=utils.getitembycls("avatarname",t.avatarname),this.m_name_sp.re_init(),this.m_sp_front.addChild(this.m_name_sp)),this.m_name_sp.m_text.text=this.m_name,this.m_name.length>0?this.m_sp_front.addChild(this.m_name_sp):this.m_name_sp.removeSelf()},n.prototype.set_name_dxy=function(t,i){this.m_name_dx=t,this.m_name_dy=i,null!=this.m_name_sp&&(this.m_name_sp.x=t,this.m_name_sp.y=i)},n.prototype.set_dy=function(t){this.m_mat_dy=t-256},n.prototype.get_buffui=function(){return null==this.m_buff&&(this.m_buff=utils.getitembycls("avatarbuffui",t.avatarbuffui),this.m_buff.re_init(),this.m_sp_front.addChild(this.m_buff)),this.m_buff},n.prototype.del_buffui=function(){null!=this.m_buff&&(this.m_buff.removeSelf(),this.m_buff.clear(),utils.recover("avatarbuffui",this.m_buff),this.m_buff=null)},n.prototype.add_buffeff=function(t){return 0},n.prototype.del_buffeff=function(t){},n.prototype.clearall_buffeff=function(){},n.prototype.set_hp=function(i,e){null==this.m_hp&&(this.m_hp=utils.getitembycls("avatarhp",t.avatarhp),this.m_hp.re_init(),this.m_sp_front.addChild(this.m_hp),this.m_hp.x=0-this.m_hp.m_w/2,this.m_hp.y=-120),this.m_hp.set_v(i,e)},n.prototype.del_hp=function(){null!=this.m_hp&&(this.m_hp.removeSelf(),this.m_hp.clear(),utils.recover("avatarhp",this.m_hp),this.m_hp=null)},n.prototype.add_adorn=function(t,i){return this.del_adorn(t.m_id),i?this.m_sp_back.addChild(t):this.m_sp_front.addChild(t),this.m_adorn_list.push(t),t.m_id},n.prototype.get_adorn=function(t){for(var i=0,e=this.m_adorn_list;i<e.length;i++){var _=e[i];if(_.m_id==t)return _;0}return null},n.prototype.del_adorn=function(t){for(var i=0,e=0,_=this.m_adorn_list;e<_.length;e++){var r=_[e];if(r.m_id==t)return r.removeSelf(),r.dispose(),void this.m_adorn_list.splice(i,1);i++}},n.prototype.change_action=function(i,e,_){void 0===e&&(e=!0),void 0===_&&(_=-1),t.core_tiplog("renderavatar change_action ",this.m_obj_id,this.m_shape,this.m_action,i,this.m_dir),this.m_lastaction=this.m_action,this.m_action=i,this.m_b_cycle=e,this.m_b_stop_frame=_,i!=this.m_action&&this.m_use_default&&(this.m_draw_avatar=!1,this.m_sp_center.removeSelf(),this.create_default_sp())},n.prototype.change_dir=function(t){if(t!=this.m_dir){if(this.m_dir=t,null!=this.m_mat&&this.m_mat.changedir(t),null!=this.m_mat_weapon){this.m_mat_weapon.changedir(t);var i=this._get_weapon_sp(t,this.m_mat_weapon.m_b_mirrior);this.m_mat_weapon.m_graphic.removeSelf(),i.addChild(this.m_mat_weapon.m_graphic)}if(null!=this.m_mat_wing){this.m_mat_wing.changedir(t);i=this._get_wing_sp(t,this.m_mat_wing.m_b_mirrior);this.m_mat_wing.m_graphic.removeSelf(),i.addChild(this.m_mat_wing.m_graphic)}null!=this.m_mat_ride&&this.m_mat_ride.changedir(t),null!=this.m_mat_backride&&this.m_mat_backride.changedir(t),null!=this.m_mat_hair&&this.m_mat_hair.changedir(t)}},n.prototype._project_mat=function(i,e,_,r,n){return void 0===n&&(n=!0),null!=i&&i.m_action!=this.m_action&&(i.m_graphic.removeSelf(),t.mat_mgr().delavataractionmaterial(i),i=null),null==i&&(i=t.mat_mgr().getavataractionmat(_,this.m_action),r&&r.addChild(i.m_graphic),i.changedir(this.m_dir)),i},n.prototype.set_scale=function(t,i){this.m_sp_center.scale(t,i)},n.prototype._get_mat_dx=function(){return this.m_mat_dx},n.prototype._get_mat_dy=function(){return this.m_mat_dy-this.m_ride_h},n.prototype._get_weapon_sp=function(t,i){return void 0===i&&(i=!1),t>=2&&t<=5?this.m_sp_center_b:this.m_sp_center_f},n.prototype._get_wing_sp=function(t,i){return void 0===i&&(i=!1),t>=2&&t<=5?this.m_sp_center_f:this.m_sp_center_b},n.prototype.project=function(t){var i=_.prototype.project.call(this,t);if(i){null!=this.m_mat&&this.m_mat.m_action!=this.m_action&&this.reset_data(),null!=this.m_aura_adorn&&this.m_aura_adorn.load_res(),null!=this.m_title_adorn&&this.m_title_adorn.load_res();var e=!0;0!=this.m_shape_backride&&(this.m_mat_backride=this._project_mat(this.m_mat_backride,5,this.m_shape_backride,this.m_sp_center_rb,5!=this.m_action),this.m_draw_avatar||(e=this.m_mat_backride.m_b_loaded));var r=!0;this.m_mat=this._project_mat(this.m_mat,0,this.m_shape,this.m_sp_center_c),this.m_draw_avatar||(r=this.m_mat.m_b_loaded),0!=this.m_shape_weapon&&(this.m_mat_weapon=this._project_mat(this.m_mat_weapon,1,this.m_shape_weapon,this._get_weapon_sp(this.m_dir))),0!=this.m_shape_wing&&(this.m_mat_wing=this._project_mat(this.m_mat_wing,2,this.m_shape_wing,this._get_wing_sp(this.m_dir)));var n=!0;0!=this.m_shape_ride&&(this.m_mat_ride=this._project_mat(this.m_mat_ride,3,this.m_shape_ride,this.m_sp_center_rf,5!=this.m_action),this.m_draw_avatar||(n=this.m_mat_ride.m_b_loaded)),0!=this.m_shape_hair&&(this.m_mat_hair=this._project_mat(this.m_mat_hair,4,this.m_shape_hair,this.m_sp_center)),this.m_draw_avatar||e&&r&&n&&(this.m_draw_avatar=!0,this.m_sp_back.removeSelf(),this.m_sp_front.removeSelf(),this.addChild(this.m_sp_back),this.addChild(this.m_sp_center),this.addChild(this.m_sp_front),this.del_default_sp())}return i},n.prototype._update_mat=function(t,i){t.goto_frame(i)},n.prototype.update=function(t){for(var i=0,e=this.m_adorn_list;i<e.length;i++){e[i].update(t)}this.m_framecurrenttm+=t;var _=Math.floor(this.m_framecurrenttm/this.m_framemillsec);if(0==this.m_b_cycle)if(0==this.m_b_stop_frame){if(_>this.m_framecount-1)return void this.change_action(this.m_lastaction)}else{var r=this.m_framecount-1;-1!=this.m_b_stop_frame&&(r=this.m_b_stop_frame),_>r&&(_=r)<0&&(_=0)}if(this.m_framecurrent=_%this.m_framecount,this.m_draw_avatar){var n=this.m_org_pt;if(null!=this.m_mat){if(n=this.m_mat.get_link(this.m_dir,0,this.m_framecurrent),this._update_mat(this.m_mat,this.m_framecurrent),this.m_mat.m_graphic.x=this._get_mat_dx(),this.m_mat.m_graphic.y=this._get_mat_dy(),null!=this.m_mat_weapon){this._update_mat(this.m_mat_weapon,this.m_framecurrent);var s=this.m_mat.get_link(this.m_dir,3,this.m_framecurrent),a=this.m_mat_weapon.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_weapon.m_graphic.x=this._get_mat_dx()+a.x-s.x:this.m_mat_weapon.m_graphic.x=this._get_mat_dx()+s.x-a.x,this.m_mat_weapon.m_graphic.y=this._get_mat_dy()+s.y-a.y}if(null!=this.m_mat_wing){this._update_mat(this.m_mat_wing,this.m_framecurrent);s=this.m_mat.get_link(this.m_dir,1,this.m_framecurrent),a=this.m_mat_wing.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_wing.m_graphic.x=this._get_mat_dx()+a.x-s.x:this.m_mat_wing.m_graphic.x=this._get_mat_dx()+s.x-a.x,this.m_mat_wing.m_graphic.y=this._get_mat_dy()+s.y-a.y}if(this.m_sp_center_b.x=0,this.m_sp_center_b.y=0,this.m_sp_center_c.x=0,this.m_sp_center_c.y=0,this.m_sp_center_f.x=0,this.m_sp_center_f.y=0,null!=this.m_mat_ride){this._update_mat(this.m_mat_ride,this.m_framecurrent);s=this.m_mat_ride.get_link(this.m_dir,3,this.m_framecurrent),a=this.m_mat_ride.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat_ride.m_graphic.x=this._get_mat_dx(),this.m_mat_ride.m_graphic.y=this._get_mat_dy()}if(null!=this.m_mat_backride){this._update_mat(this.m_mat_backride,this.m_framecurrent);s=this.m_mat_backride.get_link(this.m_dir,3,this.m_framecurrent),a=this.m_mat_backride.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat_backride.m_graphic.x=this._get_mat_dx(),this.m_mat_backride.m_graphic.y=this._get_mat_dy();var o=s.x-a.x;this.m_mat.m_cur_mirrior&&(o=a.x-s.x);var m=s.y-a.y+a.y-n.y;this.m_sp_center_b.x=o,this.m_sp_center_b.y=m,this.m_sp_center_c.x=o,this.m_sp_center_c.y=m,this.m_sp_center_f.x=o,this.m_sp_center_f.y=m}if(null!=this.m_mat_hair){this._update_mat(this.m_mat_hair,this.m_framecurrent);s=this.m_mat.get_link(this.m_dir,2,this.m_framecurrent),a=this.m_mat_hair.get_link(this.m_dir,0,this.m_framecurrent);this.m_mat.m_cur_mirrior?this.m_mat_hair.m_graphic.x=this._get_mat_dx()+a.x-s.x:this.m_mat_hair.m_graphic.x=this._get_mat_dx()+s.x-a.x,this.m_mat_hair.m_graphic.y=this._get_mat_dy()+s.y-a.y}}}},n.prototype.is_contain=function(t,i){var e=_.prototype.is_contain.call(this,t,i);if(e){var r=null;e=!1;var n=void 0,s=void 0;null!=this.m_mat&&null!=(r=this.m_mat.get_rect())&&(n=this.x+this.m_mat.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(e=!0)),e||null==this.m_mat_weapon||null!=(r=this.m_mat_weapon.get_rect())&&(n=this.x+this.m_mat_weapon.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat_weapon.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(e=!0)),e||null==this.m_mat_wing||null!=(r=this.m_mat_wing.get_rect())&&(n=this.x+this.m_mat_wing.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat_wing.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(e=!0)),e||null==this.m_mat_ride||null!=(r=this.m_mat_ride.get_rect())&&(n=this.x+this.m_mat_ride.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat_ride.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&512!=r.width&&(e=!0)),e||null==this.m_mat_backride||null!=(r=this.m_mat_backride.get_rect())&&(n=this.x+this.m_mat_backride.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat_backride.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&512!=r.width&&(e=!0)),e||null==this.m_mat_hair||null!=(r=this.m_mat_hair.get_rect())&&(n=this.x+this.m_mat_hair.m_graphic.x-this.m_aw/2+r.x-this._get_mat_dx(),s=this.y+this.m_mat_hair.m_graphic.y-this.m_ah/2+r.y-this._get_mat_dy()-this.m_ride_h,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(e=!0))}return e},n.prototype.create_default_sp=function(){null==this.m_default_sp&&(this.m_default_sp=utils.getitembycls("renderavatar_default",i),this.addChild(this.m_default_sp),this.m_default_sp.y=-120,this.m_default_sp.x=-26)},n.prototype.del_default_sp=function(){null!=this.m_default_sp&&(this.m_default_sp.removeSelf(),utils.recover("renderavatar_default",this.m_default_sp),this.m_default_sp=null)},n.prototype.dispose=function(){this.removeChildren(),null!=this.m_shadow_sp&&(this.m_shadow_sp.removeSelf(),utils.recover("renderavatar_shadow",this.m_shadow_sp),this.m_shadow_sp=null),this.del_default_sp(),null!=this.m_sp_back&&(this.m_sp_back.removeChildren(),this.m_sp_back=null),null!=this.m_sp_front&&(this.m_sp_front.removeChildren(),this.m_sp_front=null),null!=this.m_sp_center&&(this.m_sp_center.removeChildren(),this.m_sp_center=null),null!=this.m_sp_center_c&&(this.m_sp_center_c.removeChildren(),this.m_sp_center_c=null),null!=this.m_sp_center_b&&(this.m_sp_center_b.removeChildren(),this.m_sp_center_b=null),null!=this.m_sp_center_f&&(this.m_sp_center_f.removeChildren(),this.m_sp_center_f=null),null!=this.m_sp_center_rb&&(this.m_sp_center_rb.removeChildren(),this.m_sp_center_rb=null),null!=this.m_sp_center_rf&&(this.m_sp_center_rf.removeChildren(),this.m_sp_center_rf=null),0!=this.m_aura_id&&this.change_aura(0),0!=this.m_title_id&&this.change_title(0);for(var i=0,e=this.m_adorn_list;i<e.length;i++){e[i].dispose()}this.m_adorn_list.length=0,this.removeChildren(),null!=this.m_name_sp&&(this.m_name_sp.dispose(),utils.recover("avatarname",this.m_name_sp),this.m_name_sp=null),this.del_hp(),this.del_buffui(),null!=this.m_mat&&(t.mat_mgr().delavataractionmaterial(this.m_mat),this.m_mat=null),null!=this.m_mat_weapon&&(t.mat_mgr().delavataractionmaterial(this.m_mat_weapon),this.m_mat_weapon=null),null!=this.m_mat_wing&&(t.mat_mgr().delavataractionmaterial(this.m_mat_wing),this.m_mat_wing=null),null!=this.m_mat_ride&&(t.mat_mgr().delavataractionmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(t.mat_mgr().delavataractionmaterial(this.m_mat_backride),this.m_mat_backride=null),null!=this.m_mat_hair&&(t.mat_mgr().delavataractionmaterial(this.m_mat_hair),this.m_mat_hair=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("avatarcommand",this.m_rc),this.m_rc=null),_.prototype.dispose.call(this)},n}(t.renderobject);t.renderavatar_old=s;var a=function(e){function _(){var t=e.call(this)||this;return t.m_shape=0,t.m_shape_weapon=0,t.m_shape_wing=0,t.m_shape_ride=0,t.m_shape_backride=0,t.m_shape_hair=0,t.m_aura_id=0,t.m_aura_adorn=null,t.m_title_id=0,t.m_title_adorn=null,t.m_action=0,t.m_lastaction=0,t.m_dir=0,t.m_framecurrent=0,t.m_framemillsec=0,t.m_frametotalmillsec=0,t.m_framecurrenttm=0,t.m_mat_dx=0,t.m_mat_dy=-256,t.m_ride_h=0,t.m_user_data=0,t.m_name="",t.m_name_dx=0,t.m_name_dy=0,t.m_name_sp=null,t.m_hp=null,t.m_buff=null,t.m_buffeff_list=new Array,t.m_eff_list=new Array,t.m_b_cycle=!0,t.m_b_stop_frame=-1,t.m_sp_front=null,t.m_sp_back=null,t.m_sp_center=null,t.m_adorn_list=new Array,t.m_dx=0,t.m_dy=0,t.m_org_pt=new Laya.Point(0,0),t.m_shadow_sp=null,t.m_default_sp=null,t.m_draw_avatar=!1,t.m_use_default=!0,t.m_b_projected=!1,t.m_draw_link=!1,t.m_mat_rt=new Laya.Rectangle,t.m_mat_weapon_rt=new Laya.Rectangle,t.m_mat_wing_rt=new Laya.Rectangle,t.m_mat_ride_rt=new Laya.Rectangle,t.m_mat_backeride_rt=new Laya.Rectangle,t.m_mat_hair_rt=new Laya.Rectangle,t}return __extends(_,e),_.prototype.re_init=function(i,_,r,n){void 0===n&&(n=!0),this.set_id(),this.scale(1,1),this.alpha=1,this.m_draw_link=!1,this.m_name_dx=0,this.m_name_dy=0,this.m_sp_front=new Laya.Sprite,this.m_sp_back=new Laya.Sprite,this.m_sp_center=new Laya.Sprite,this.m_shadow_sp=t.mat_mgr().get_avatar_shadow_mat(),this.set_ride_h(0),this.m_mat_dy=-256,this.m_use_default=n,this.m_use_default?(this.m_draw_avatar=!1,this.create_default_sp()):this.m_draw_avatar=!0,this.m_dx=0,this.m_dy=0,this.m_shape=i,this.rotation=0,this.alpha=1,this.m_rc=utils.getitembycls("avatarcommand_new",t.avatarcommand_new),this.m_rc.re_init(this),e.prototype.set_pos.call(this,_,r),null!=this.m_mat&&t.mat_mgr().dellavatarmaterial(this.m_mat),this.m_mat=null,null!=this.m_mat_weapon&&t.mat_mgr().dellavatarmaterial(this.m_mat_weapon),this.m_mat_weapon=null,null!=this.m_mat_wing&&t.mat_mgr().dellavatarmaterial(this.m_mat_wing),this.m_mat_wing=null,null!=this.m_mat_ride&&t.mat_mgr().dellavatarmaterial(this.m_mat_ride),this.m_mat_ride=null,null!=this.m_mat_backride&&t.mat_mgr().dellavatarmaterial(this.m_mat_backride),this.m_mat_backride=null,null!=this.m_mat_hair&&t.mat_mgr().dellavatarmaterial(this.m_mat_hair),this.m_mat_hair=null,this.m_shape_weapon=0,this.m_shape_wing=0,this.m_shape_ride=0,this.m_shape_backride=0,this.m_shape_hair=0,this.m_aura_id=0,this.m_aura_adorn=null,this.m_title_id=0,this.m_title_adorn=null,this.m_buffeff_list=new Array,this.m_eff_list=new Array,this.reset_data()},_.prototype.show_shadow=function(i){this.m_shadow_sp=i?t.mat_mgr().get_avatar_shadow_mat():null},_.prototype.set_dxy=function(t,i){this.m_dx=t,this.m_dy=i,this.m_sp_front.x=this.m_dx,this.m_sp_front.y=this.m_dy,this.m_sp_center.x=this.m_dx,this.m_sp_center.y=this.m_dy,this.m_sp_back.x=this.m_dx,this.m_sp_back.y=this.m_dy},_.prototype.change_shape=function(t){t!=this.m_shape&&(this.m_shape=t,this.reset_data(),this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},_.prototype.change_weapon=function(t){t!=this.m_shape_weapon&&(this.m_shape_weapon=t)},_.prototype.change_wing=function(t){t!=this.m_shape_wing&&(this.m_shape_wing=t)},_.prototype.change_ride=function(t,i){t!=this.m_shape_ride&&(this.m_shape_ride=t,this.m_shape_backride=i,this.m_use_default&&(this.m_draw_avatar=!1,this.create_default_sp(),this.m_sp_center.removeSelf()))},_.prototype.set_ride_h=function(t){this.m_ride_h=t},_.prototype.change_hair=function(t){t!=this.m_shape_hair&&(this.m_shape_hair=t)},_.prototype.change_aura=function(t){if(0!=this.m_aura_id&&(this.del_adorn(this.m_aura_id),this.m_aura_adorn=null,this.m_aura_id=0),0!=t){var i=utils.getitembycls("avatar_aura_new",n);i.re_init(t),this.m_aura_id=i.m_id,this.m_aura_adorn=i,this.add_adorn(i,!0)}},_.prototype.change_title=function(t){if(0!=this.m_title_id&&(this.del_adorn(this.m_title_id),this.m_title_adorn=null,this.m_title_id=0),0!=t){var i=utils.getitembycls("avatar_aura_new",n);i.re_init(t),this.m_title_id=i.m_id,this.m_title_adorn=i,this.add_adorn(i,!1)}},_.prototype.reset_data=function(){this.m_aw=t.matinfo_mgr().getavataractionw(this.m_shape,this.m_action),this.m_ah=t.matinfo_mgr().getavataractionh(this.m_shape,this.m_action),this.m_framecount=t.matinfo_mgr().getavataractionframecount(this.m_shape,this.m_action),this.m_framespeed=t.matinfo_mgr().getavataractionframespeed(this.m_shape,this.m_action),this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_framecurrenttm=0,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah),t.core_tiplog("renderavatar resetdata ",this.m_obj_id,this.m_shape,this.m_dir,this.m_action,this.m_framecount)},_.prototype.set_name=function(i){this.m_name=i,null==this.m_name_sp&&(this.m_name_sp=utils.getitembycls("avatarname",t.avatarname),this.m_name_sp.re_init()),this.m_name_sp.m_text.text=this.m_name,this.m_name.length>0||this.m_name_sp.removeSelf()},_.prototype.set_name_dxy=function(t,i){this.m_name_dx=t,this.m_name_dy=i,null!=this.m_name_sp&&(this.m_name_sp.x=t,this.m_name_sp.y=i)},_.prototype.set_dy=function(t){this.m_mat_dy=t-256},_.prototype.get_buffui=function(){return null==this.m_buff&&(this.m_buff=utils.getitembycls("avatarbuffui",t.avatarbuffui),this.m_buff.re_init(),this.addChild(this.m_buff)),this.m_buff},_.prototype.del_buffui=function(){null!=this.m_buff&&(this.m_buff.removeSelf(),this.m_buff.clear(),utils.recover("avatarbuffui",this.m_buff),this.m_buff=null)},_.prototype.addeff=function(t,i,e,_){if(void 0===i&&(i=!0),void 0===e&&(e=0),void 0===_&&(_=0),0!=t){var r=utils.getitembycls("avatar_aura_new",n);r.re_init(t),r.m_dx=e,r.m_dy=_;var s=r.m_id;return this.add_adorn(r,!i),this.m_eff_list.push(r),s}},_.prototype.del_eff=function(t){for(var i=0;i<this.m_eff_list.length;++i){var e=this.m_eff_list[i];if(e.m_id==t)return this.del_adorn(e.m_id),void this.m_eff_list.splice(i,1)}},_.prototype.clearall_eff=function(){for(var t=0,i=this.m_eff_list;t<i.length;t++){var e=i[t];this.del_adorn(e.m_id)}this.m_eff_list=new Array},_.prototype.add_buffeff=function(t){if(0!=t){var i=utils.getitembycls("avatar_aura_new",n);i.re_init(t);var e=i.m_id;return this.add_adorn(i,!0),this.m_buffeff_list.push(i),e}},_.prototype.del_buffeff=function(t){for(var i=0;i<this.m_buffeff_list.length;++i){var e=this.m_buffeff_list[i];if(e.m_id==t)return this.del_adorn(e.m_id),void this.m_buffeff_list.splice(i,1)}},_.prototype.clearall_buffeff=function(){for(var t=0,i=this.m_buffeff_list;t<i.length;t++){var e=i[t];this.del_adorn(e.m_id)}this.m_buffeff_list=new Array},_.prototype.set_hp=function(i,e){null==this.m_hp&&(this.m_hp=utils.getitembycls("avatarhp",t.avatarhp),this.m_hp.re_init(),this.addChild(this.m_hp),this.m_hp.x=0-this.m_hp.m_w/2,this.m_hp.y=-120),this.m_hp.set_v(i,e)},_.prototype.del_hp=function(){null!=this.m_hp&&(this.m_hp.removeSelf(),this.m_hp.clear(),utils.recover("avatarhp",this.m_hp),this.m_hp=null)},_.prototype.add_adorn=function(t,i){return this.del_adorn(t.m_id),t.m_front=!i,this.m_adorn_list.push(t),t.m_id},_.prototype.get_adorn=function(t){for(var i=0,e=this.m_adorn_list;i<e.length;i++){var _=e[i];if(_.m_id==t)return _;0}return null},_.prototype.del_adorn=function(t){for(var i=0,e=0,_=this.m_adorn_list;e<_.length;e++){var r=_[e];if(r.m_id==t)return r.removeSelf(),r.dispose(),void this.m_adorn_list.splice(i,1);i++}},_.prototype.change_action=function(i,e,_){void 0===e&&(e=!0),void 0===_&&(_=-1),t.core_tiplog("renderavatar change_action ",this.m_obj_id,this.m_shape,this.m_action,i,this.m_dir);this.m_action;this.m_lastaction=this.m_action,this.m_action=i,this.reset_data(),this.m_b_cycle=e,this.m_b_stop_frame=_},_.prototype.change_dir=function(t){t!=this.m_dir&&(this.m_dir=t)},_.prototype._project_mat=function(i,e){return null==i||i.m_action==this.m_action&&i.m_shape==e||(t.mat_mgr().dellavatarmaterial(i),i=null),null==i&&(i=t.mat_mgr().getlavatarmat(e,this.m_action)),i},_.prototype.set_scale=function(t,i){this.scale(t,i)},_.prototype._get_mat_dx=function(){return this.m_mat_dx},_.prototype._get_mat_dy=function(){return this.m_mat_dy-this.m_ride_h},_.prototype.project=function(t){var i=e.prototype.project.call(this,t);if(this.m_b_projected=i,i){null==this.m_mat||this.m_mat.m_action==this.m_action&&this.m_mat.m_shape==this.m_shape||this.reset_data(),null!=this.m_aura_adorn&&this.m_aura_adorn.load_res(),null!=this.m_title_adorn&&this.m_title_adorn.load_res();for(var _=0,r=this.m_buffeff_list;_<r.length;_++){r[_].load_res()}for(var n=0,s=this.m_eff_list;n<s.length;n++){s[n].load_res()}var a=!0;0!=this.m_shape_backride&&(this.m_mat_backride=this._project_mat(this.m_mat_backride,this.m_shape_backride),this.m_draw_avatar||(a=this.m_mat_backride.m_b_loaded));var o=!0;this.m_mat=this._project_mat(this.m_mat,this.m_shape),this.m_draw_avatar||(o=this.m_mat.m_b_loaded),0!=this.m_shape_weapon&&(this.m_mat_weapon=this._project_mat(this.m_mat_weapon,this.m_shape_weapon)),0!=this.m_shape_wing&&(this.m_mat_wing=this._project_mat(this.m_mat_wing,this.m_shape_wing));var m=!0;0!=this.m_shape_ride&&(this.m_mat_ride=this._project_mat(this.m_mat_ride,this.m_shape_ride),this.m_draw_avatar||(m=this.m_mat_ride.m_b_loaded)),0!=this.m_shape_hair&&(this.m_mat_hair=this._project_mat(this.m_mat_hair,this.m_shape_hair)),this.m_draw_avatar||a&&o&&m&&(this.m_draw_avatar=!0,this.m_sp_back.removeSelf(),this.m_sp_front.removeSelf(),this.del_default_sp())}return i},_.prototype._draw_mat=function(t,i,e,_,r,n,s){if(null!=t&&t.m_b_loaded){var a,o=this.m_dir,m=t.m_dir_tex[this.m_dir].m_b_mirror,h=_;m&&(o=t.m_dir_tex[this.m_dir].m_use_dir);var l=this.m_mat.get_link(s,i,this.m_framecurrent),c=t.get_link(o,0,this.m_framecurrent);h=m?n?_+(this.m_aw-c.x)-(this.m_aw-l.x):_+(this.m_aw-c.x)-l.x:n?_+c.x-(this.m_aw-l.x):_+c.x-l.x,a=r+l.y-c.y;var p,u;p=(u=t.m_dir_tex[this.m_dir]).m_frames[this.m_framecurrent].m_tex,this.graphics.drawTexture(p,h,a,t.m_width,t.m_height,u.m_matrix),e.x=h+p.offsetX,m&&(e.x=h+p.sourceWidth-p.offsetX-p.width),e.y=a+p.offsetY,e.width=p.width,e.height=p.height}return e},_.prototype.update=function(t){for(var i=0,e=this.m_adorn_list;i<e.length;i++){e[i].update(t)}this.m_framecurrenttm+=t;var _=Math.floor(this.m_framecurrenttm/this.m_framemillsec);if(0==this.m_b_cycle)if(0==this.m_b_stop_frame){if(_>this.m_framecount-1)return void this.change_action(this.m_lastaction)}else{var r=this.m_framecount-1;-1!=this.m_b_stop_frame&&(r=this.m_b_stop_frame),_>r&&(_=r)<0&&(_=0)}if(this.m_framecurrent=_%this.m_framecount,this.m_draw_avatar&&this.m_b_projected&&(this.graphics.clear(),this.m_sp_back.graphics.clear(),null!=this.m_mat&&0!=this.m_mat.m_b_loaded)){var n,s,a=this.m_org_pt,o=(new Laya.Point,0),m=0,h=0,l=0,c=!1,p=-this.m_aw/2;n=this._get_mat_dx()+p,s=this._get_mat_dy();var u=this.m_dir,d=this.m_mat.m_dir_tex[this.m_dir].m_b_mirror,f=this.m_dir;d&&(f=this.m_mat.m_dir_tex[this.m_dir].m_use_dir);var y,g,v,w=this.m_mat.get_link(f,0,this.m_framecurrent);a.x=d?this.m_aw-w.x:w.x,a.y=w.y;for(var b=0,x=this.m_eff_list;b<x.length;b++){x[b].draw2sp(this,this.m_dx,this.m_dy,!1)}if(null!=this.m_mat_backride&&this.m_mat_backride.m_b_loaded){u=this.m_dir,(c=this.m_mat_backride.m_dir_tex[this.m_dir].m_b_mirror)&&(u=this.m_mat_backride.m_dir_tex[this.m_dir].m_use_dir),y=(v=(g=this.m_mat_backride).m_dir_tex[this.m_dir]).m_frames[this.m_framecurrent].m_tex;var O=this.m_mat_backride.get_link(u,3,this.m_framecurrent),k=this.m_mat_backride.get_link(u,0,this.m_framecurrent);o=O.x-k.x,c&&(o=k.x-O.x),m=O.y-a.y,h=c?n+o+(this.m_aw-O.x)-a.x+this.m_dx:n+o+O.x-a.x+this.m_dx,l=s+this.m_dy,this.graphics.drawTexture(y,h,l,g.m_width,g.m_height,v.m_matrix),this.m_mat_backeride_rt.x=h+y.offsetX,c&&(this.m_mat_backeride_rt.x=h+y.sourceWidth-y.offsetX-y.width),this.m_mat_backeride_rt.y=l+y.offsetY,this.m_mat_backeride_rt.width=y.width,this.m_mat_backeride_rt.height=y.height}if(this.m_dir>=2&&this.m_dir<=5?this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,n+o+this.m_dx,s+m+this.m_dy,d,f):this.m_mat_wing_rt=this._draw_mat(this.m_mat_wing,1,this.m_mat_wing_rt,n+o+this.m_dx,s+m+this.m_dy,d,f),y=(v=(g=this.m_mat).m_dir_tex[this.m_dir]).m_frames[this.m_framecurrent].m_tex,this.graphics.drawTexture(y,n+o+this.m_dx,s+m+this.m_dy,g.m_width,g.m_height,v.m_matrix),this.m_mat_rt.x=n+o+y.offsetX+this.m_dx,c&&(this.m_mat_rt.x=n+o+y.sourceWidth-y.offsetX-y.width+this.m_dx),this.m_mat_rt.y=s+m+y.offsetY+this.m_dy,this.m_mat_rt.width=y.width,this.m_mat_rt.height=y.height,this.m_dir>=2&&this.m_dir<=5?this.m_mat_wing_rt=this._draw_mat(this.m_mat_wing,1,this.m_mat_wing_rt,n+o+this.m_dx,s+m+this.m_dy,d,f):this.m_mat_weapon_rt=this._draw_mat(this.m_mat_weapon,3,this.m_mat_weapon_rt,n+o+this.m_dx,s+m+this.m_dy,d,f),null!=this.m_mat_ride&&this.m_mat_ride.m_b_loaded){u=this.m_dir,(c=this.m_mat_ride.m_dir_tex[this.m_dir].m_b_mirror)&&(u=this.m_mat_ride.m_dir_tex[this.m_dir].m_use_dir);O=this.m_mat_ride.get_link(u,3,this.m_framecurrent),k=this.m_mat_ride.get_link(u,0,this.m_framecurrent);h=c?n+o+(this.m_aw-O.x)-a.x+this.m_dx:n+o+O.x-a.x+this.m_dx,l=s+this.m_dy,y=(v=(g=this.m_mat_ride).m_dir_tex[this.m_dir]).m_frames[this.m_framecurrent].m_tex,this.graphics.drawTexture(y,h,l,g.m_width,g.m_height,v.m_matrix),this.m_mat_ride_rt.x=h+y.offsetX,c&&(this.m_mat_ride_rt.x=l+y.sourceWidth-y.offsetX-y.width),this.m_mat_ride_rt.y=l+y.offsetY,this.m_mat_ride_rt.width=y.width,this.m_mat_ride_rt.height=y.height}this.m_mat_hair_rt=this._draw_mat(this.m_mat_hair,2,this.m_mat_hair_rt,n+o+this.m_dx,s+m+this.m_dy,d,f);for(var E=0,A=this.m_buffeff_list;E<A.length;E++){A[E].draw2sp(this,this.m_dx,this.m_dy,!0)}for(var C=0,T=this.m_eff_list;C<T.length;C++){T[C].draw2sp(this,this.m_dx,this.m_dy,!0)}}},_.prototype.is_contain=function(t,i){var _=e.prototype.is_contain.call(this,t,i);if(_){var r=null;_=!1;var n=void 0,s=void 0;null!=this.m_mat&&this.m_mat.m_b_loaded&&(r=this.m_mat_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(_=!0)),!_&&null!=this.m_mat_weapon&&this.m_mat_weapon.m_b_loaded&&(r=this.m_mat_weapon_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(_=!0)),!_&&null!=this.m_mat_wing&&this.m_mat_wing.m_b_loaded&&(r=this.m_mat_wing_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(_=!0)),!_&&null!=this.m_mat_ride&&this.m_mat_ride.m_b_loaded&&(r=this.m_mat_ride_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&512!=r.width&&(_=!0)),!_&&null!=this.m_mat_backride&&this.m_mat_backride.m_b_loaded&&(r=this.m_mat_backeride_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&512!=r.width&&(_=!0)),!_&&null!=this.m_mat_hair&&this.m_mat_hair.m_b_loaded&&(r=this.m_mat_hair_rt,n=this.x+r.x,s=this.y+r.y,t>=n&&t<=n+r.width&&i>=s&&i<=s+r.height&&(_=!0))}return _},_.prototype.create_default_sp=function(){null==this.m_default_sp&&(this.m_default_sp=utils.getitembycls("renderavatar_default",i),this.addChild(this.m_default_sp),this.m_default_sp.y=-120,this.m_default_sp.x=-26)},_.prototype.del_default_sp=function(){null!=this.m_default_sp&&(this.m_default_sp.removeSelf(),utils.recover("renderavatar_default",this.m_default_sp),this.m_default_sp=null)},_.prototype.dispose=function(){this.removeChildren(),null!=this.m_shadow_sp&&(this.m_shadow_sp=null),this.del_default_sp(),null!=this.m_sp_back&&(this.m_sp_back.removeChildren(),this.m_sp_back=null),null!=this.m_sp_front&&(this.m_sp_front.removeChildren(),this.m_sp_front=null),null!=this.m_sp_center&&(this.m_sp_center.removeChildren(),this.m_sp_center=null),0!=this.m_aura_id&&this.change_aura(0),0!=this.m_title_id&&this.change_title(0),this.m_buffeff_list=new Array,this.m_eff_list=new Array;for(var i=0,_=this.m_adorn_list;i<_.length;i++){_[i].dispose()}this.m_adorn_list.length=0,this.removeChildren(),null!=this.m_name_sp&&(this.m_name_sp.dispose(),utils.recover("avatarname",this.m_name_sp),this.m_name_sp=null),this.del_hp(),this.del_buffui(),null!=this.m_mat&&(t.mat_mgr().dellavatarmaterial(this.m_mat),this.m_mat=null),null!=this.m_mat_weapon&&(t.mat_mgr().dellavatarmaterial(this.m_mat_weapon),this.m_mat_weapon=null),null!=this.m_mat_wing&&(t.mat_mgr().dellavatarmaterial(this.m_mat_wing),this.m_mat_wing=null),null!=this.m_mat_ride&&(t.mat_mgr().dellavatarmaterial(this.m_mat_ride),this.m_mat_ride=null),null!=this.m_mat_backride&&(t.mat_mgr().dellavatarmaterial(this.m_mat_backride),this.m_mat_backride=null),null!=this.m_mat_hair&&(t.mat_mgr().dellavatarmaterial(this.m_mat_hair),this.m_mat_hair=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("avatarcommand_new",this.m_rc),this.m_rc=null),e.prototype.dispose.call(this)},_}(t.renderobject);t.renderavatar_new=a;var o=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(a);t.renderavatar=o}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_framecurrent=0,t.m_framemillsec=0,t.m_frametotalmillsec=0,t.m_framecurrenttm=0,t.m_b_loop=!0,t.m_b_end=!1,t.m_b_autodel=!1,t}return __extends(e,i),e.prototype.re_init=function(e,_,r,n,s){void 0===n&&(n=!0),void 0===s&&(s=!1),this.set_id(),this.m_aniid=e,this.m_rc=utils.getitembycls("effcommand",t.effcommand),this.m_rc.re_init(this),i.prototype.set_pos.call(this,_,r),this.m_data=n,this.m_mat=null,this.m_aw=t.matinfo_mgr().geteffw(this.m_aniid),this.m_ah=t.matinfo_mgr().geteffh(this.m_aniid),this.m_framecount=t.matinfo_mgr().geteffframecount(this.m_aniid),this.m_framespeed=t.matinfo_mgr().geteffframespeed(this.m_aniid),this.m_b_loop=t.matinfo_mgr().geteffcycle(this.m_aniid),this.m_b_autodel=s,this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_box.setTo(this.x-this.m_aw/2,this.y-this.m_ah/2,this.m_aw,this.m_ah)},e.prototype.project=function(e){var _=i.prototype.project.call(this,e);return _&&null==this.m_mat&&(this.m_mat=t.mat_mgr().geteffmat(this.m_aniid),this.addChild(this.m_mat.m_graphic)),_},e.prototype.update=function(t){if(!this.m_b_end){if(this.m_framecurrenttm+=t,this.m_framecurrenttm>=this.m_frametotalmillsec){if(this.m_b_autodel)return void(this.m_b_end=!0);if(0==this.m_b_loop)return void(this.m_b_end=!0)}var i=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=i%this.m_framecount,null!=this.m_mat&&this.m_mat.goto_frame(this.m_framecurrent)}},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(t.mat_mgr().deleffmat(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("effcommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.rendereff=i}(core||(core={})),function(t){var i=function(){function i(){this.m_mapid=0,this.m_bk=null,this.m_slots=new Array,this.m_block=new t.rendermapblock,this.m_pathfind=new t.pathfind(null,0,0)}return i.prototype.setmapid=function(i,e){if(void 0===e&&(e=!0),t.core_tiplog("rendermap setmapid 1 ",i,this.m_mapid),i!=this.m_mapid&&(this.clear(),0!=i)){t.core_tiplog("rendermap setmapid 2 ",i,this.m_mapid),this.m_mapid=i,this.m_block.setmapid(this.m_mapid);var _=t.matinfo_mgr().getmapw(this.m_mapid),r=t.matinfo_mgr().getmaph(this.m_mapid);if(this.m_mapw=_,this.m_maph=r,e)for(var n=t.matinfo_mgr().m_map_grid_w,s=t.matinfo_mgr().m_map_grid_h,a=_/n,o=r/s,m=0;m<a;++m)for(var h=0;h<o;++h){var l=m*n,c=h*s,p=utils.getitembycls("rendermapslot",t.rendermapslot);p.re_init(i,l,c,m,h),this.m_slots.push(p)}}},i.prototype.delallslot=function(){for(var t=0,i=this.m_slots;t<i.length;t++){var e=i[t];e.dispose(),utils.recover("rendermapslot",e)}this.m_slots=new Array},i.prototype.clear=function(){null!=this.m_bk&&(this.m_bk.dispose(),this.m_bk=null),this.delallslot(),this.m_mapid=0},i.prototype.is_block=function(t,i){var e=this.m_block.m_mat.m_grid_w,_=this.m_block.m_mat.m_grid_h,r=Math.floor(t/e),n=Math.floor(i/_);return this.m_block.m_mat.is_block_cache(r,n)},i.prototype.findpath=function(i,e,_,r,n,s){utils.get_render_milltm();var a=this.m_block.m_mat.m_grid_w,o=this.m_block.m_mat.m_grid_h,m=Math.floor(i/a),h=Math.floor(e/o),l=Math.floor(_/a),c=Math.floor(r/o);this.m_pathfind.set_block(this.m_block.m_mat,this.m_block.m_mat.m_block_w_num,this.m_block.m_mat.m_block_h_num);var p=this.m_pathfind.findpath(m,h,l,c,n);utils.get_render_milltm();if(null!=p){var u=null,d=utils.getitembycls("path",t.path);d.init(s);for(var f=0;f<p.length;++f)null==u?u=p[f]:(1==f?d.push_pt(i,e,p[f].x*a,p[f].y*o):d.push_pt(u.x*a,u.y*o,p[f].x*a,p[f].y*o),u=p[f]);return d}return null},i.prototype.setbk=function(i){null!=this.m_bk&&(this.m_bk.dispose(),this.m_bk=null),null!=i&&(this.m_bk=new t.rendermapbk,this.m_bk.setres(i))},i.prototype.setsp=function(i){null==this.m_bk&&(this.m_bk=new t.rendermapbk),this.m_bk.setsp(i)},i.prototype.removesp=function(){null!=this.m_bk&&this.m_bk.clearsp()},i.prototype.dispose=function(){this.clear(),null!=this.m_block&&(this.m_block.dispose(),this.m_block=null)},i.prototype.update=function(t){},i.prototype.project=function(t){var i=!1;null!=this.m_bk&&(i=this.m_bk.project(t)||i),this.m_block;for(var e=0,_=this.m_slots;e<_.length;e++){i=_[e].project(t)||i,0}return i},i}();t.rendermap=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.re_init(),t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat=null,this.m_rc=utils.getitembycls("mapbkcommand",t.mapbkcommand),this.m_rc.re_init(this)},e.prototype.setres=function(i){null!=this.m_mat&&t.mat_mgr().delmapbkres(this.m_mat),this.m_mat=t.mat_mgr().getmapbkres(i),this.addChild(this.m_mat.m_graphic)},e.prototype.setsp=function(t){this.addChild(t)},e.prototype.clearsp=function(){this.removeChildren()},e.prototype.project=function(t){return t.m_render.addrc(this.m_rc),!0},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(t.mat_mgr().delmapbkres(this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapbkcommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.rendermapbk=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.re_init(),t}return __extends(e,i),e.prototype.re_init=function(){this.m_mat=utils.getitembycls("mapblock",t.mapblock),this.m_mat.re_init(),this.addChild(this.m_mat.m_graphic),this.m_rc=utils.getitembycls("mapblockcommand",t.mapblockcommand),this.m_rc.re_init(this)},e.prototype.setmapid=function(i){t.mat_mgr().getmapblock(this.m_mat,i)},e.prototype.project=function(t){return null!=this.m_mat&&0==this.m_mat.m_init_sp&&this.m_mat.get_block_sp(),t.m_render.addrc(this.m_rc),!0},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(this.m_mat.dispose(),utils.recover("mapblock",this.m_mat),this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapblockcommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.rendermapblock=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.re_init=function(e,_,r,n,s){this.set_id(),this.m_mapid=e,this.m_rc=utils.getitembycls("mapslotcommand",t.mapslotcommand),this.m_rc.re_init(this),i.prototype.set_pos.call(this,_,r),this.m_colnum=n,this.m_rownum=s,this.m_mat=null,this.m_box.setTo(this.x,this.y,t.matinfo_mgr().m_map_grid_w,t.matinfo_mgr().m_map_grid_h)},e.prototype.project=function(e){var _=i.prototype.project.call(this,e);return _&&(null==this.m_mat&&(this.m_mat=t.mat_mgr().getmapslot(this.m_mapid,this.m_rownum,this.m_colnum)),this.addChild(this.m_mat.m_graphic)),_},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_mat&&(this.m_mat=null),null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("mapslotcommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.rendermapslot=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_w=0,i.m_h=0,i}return __extends(i,t),i.prototype.update=function(t){},i.prototype.dispose=function(){},i.prototype.selfremove=function(){},i}(laya.display.Sprite);t.renderspcontent=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_sprite=null,t.m_b_upon_unit=!0,t}return __extends(e,i),e.prototype.re_init=function(e,_,r,n){void 0===n&&(n=!0),this.set_id(),this.m_b_upon_unit=n,this.m_sprite=e,this.removeChildren(),null!=this.m_sprite&&this.addChild(this.m_sprite),this.m_rc=utils.getitembycls("spritecommand",t.spritecommand),this.m_rc.re_init(this),i.prototype.set_pos.call(this,_,r),this.m_box.setTo(this.x-e.m_w/2,this.y-e.m_h/2,e.m_w,e.m_h)},e.prototype.project=function(t){return i.prototype.project.call(this,t)},e.prototype.update=function(t){null!=this.m_sprite&&this.m_sprite.update(t)},e.prototype.dispose=function(){this.removeChildren(),null!=this.m_sprite&&this.m_sprite.selfremove(),this.m_sprite=null,null!=this.m_rc&&(this.m_rc.dispose(),utils.recover("spritecommand",this.m_rc),this.m_rc=null),i.prototype.dispose.call(this)},e}(t.renderobject);t.rendersprite=i}(core||(core={})),function(t){var i=function(){function i(t){this.m_nodes=null,this.m_dir_count=8,this.m_speed=300,this.m_ret_node=null,this.m_unit_id=0,this.m_nodes=new Array,this.init(t)}return i.prototype.init=function(i){this.m_speed=i,this.m_ret_node=utils.getitembycls("pathnode",t.pathnode),this.m_ret_node.init(0,0,0,0)},i.prototype.push_pt=function(i,e,_,r){var n=utils.getitembycls("pathnode",t.pathnode);n.init(i,e,_,r,this.m_dir_count),n.cal_total_tm(this.m_speed);var s=0;if(this.m_nodes.length>0){var a=this.m_nodes[this.m_nodes.length-1];s=a.m_start_tm+a.m_total_tm}else this.m_ret_node.x=n.x,this.m_ret_node.y=n.y,this.m_ret_node.m_dir=n.m_dir;n.m_start_tm=s,this.m_nodes.push(n)},i.prototype.start=function(){this.m_cur_tm=0,this.m_cur_node_idx=0},i.prototype.update=function(t){if(!(this.m_nodes.length<=0))for(this.m_cur_tm+=t;this.m_cur_node_idx<this.m_nodes.length;){var i=this.m_nodes[this.m_cur_node_idx];if(!(this.m_cur_tm>=i.m_start_tm+i.m_total_tm))break;this.m_cur_node_idx++}},i.prototype.get_end=function(){return this.m_nodes[this.m_nodes.length-1].m_end_pt},i.prototype.is_end=function(){return this.m_cur_node_idx>=this.m_nodes.length},i.prototype.get_cur_pt=function(){var t=this.m_cur_node_idx<this.m_nodes.length?this.m_cur_node_idx:this.m_nodes.length-1,i=this.m_nodes[t].get_pos(this.m_cur_tm);return this.m_ret_node.x=i.x,this.m_ret_node.y=i.y,this.m_ret_node.m_dir=this.m_nodes[t].m_dir,this.m_ret_node},i.prototype.dispose=function(){for(var t=0,i=this.m_nodes;t<i.length;t++){var e=i[t];utils.recover("pathnode",e)}this.m_nodes.length=0,utils.recover("pathnode",this.m_ret_node),this.m_ret_node=null},i}();t.path=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(e,_){void 0===e&&(e=0),void 0===_&&(_=0);var r=t.call(this,e,_)||this;return r.m_g=0,r.m_h=0,r.m_f=0,r.m_key=0,r.m_parent_x=0,r.m_parent_y=0,r.m_key=i._genkey(e,_),r}return __extends(i,t),i._genkey=function(t,i){return 1e4*t+i},i.prototype.init=function(t,e){this.setTo(t,e),this.m_key=i._genkey(t,e)},i.prototype.calc=function(t,i){this.m_h=Math.sqrt(Math.abs((t-this.x)*(t-this.x))+Math.abs((i-this.y)*(i-this.y))),this.m_f=this.m_g+this.m_h},i}(laya.maths.Point);t.pathfindnode=i;var e=function(){function e(t,i,e){this.m_g_h=10,this.m_g_c=14,this.m_map_block_ref=null,this.m_block_w_num=0,this.m_block_h_num=0,this.m_open_heap=new utils.small_heap,this.m_open_flag=new Object,this.m_close_flag=new Object,this.m_map_block_ref=t,this.m_block_w_num=i,this.m_block_h_num=e}return e.prototype.set_block=function(t,i,e){this.m_map_block_ref=t,this.m_block_w_num=i,this.m_block_h_num=e},e.prototype._get_pfd=function(t,e){var _=utils.getitembycls("pathfindnode",i);return _.init(t,e),_},e.prototype._del_pfd=function(t){utils.recover("pathfindnode",t)},e.prototype._clear_pfd_cache=function(){utils.clearbysign("pathfindnode")},e.prototype._clear_openclose_flag=function(){for(var t in this.m_open_flag){if(this.m_open_flag.hasOwnProperty(t))null!=(i=this.m_open_flag[t])&&null!=i&&this._del_pfd(i)}for(var t in this.m_open_flag=new Object,this.m_close_flag){var i;if(this.m_close_flag.hasOwnProperty(t))null!=(i=this.m_close_flag[t])&&null!=i&&this._del_pfd(i)}this.m_close_flag=new Object},e.prototype._add_node=function(t,e,_,r,n,s,a){var o,m,h,l;if(o=i._genkey(_,r),null==this.m_close_flag[o])if(null!=this.m_open_flag[o])n<(h=this.m_open_flag[o]).m_g&&(h.m_g=n,h.m_f=h.m_g+h.m_h,h.m_parent_x=t,h.m_parent_y=e,m=this.m_open_heap.get_idx(h.m_key),this.m_open_heap.modify(m,h.m_f));else if(0==this.m_map_block_ref.is_block_cache(_,r)){if((l=this._get_pfd(_,r)).m_parent_x=t,l.m_parent_y=e,_==s&&r==a)return this.m_close_flag[l.m_key]=l,!0;l.m_g=n,l.calc(s,a),this.m_open_heap.push(l.m_h,l.m_key),this.m_open_flag[l.m_key]=l}return!1},e.prototype.findpath=function(e,_,r,n,s){if(e==r&&_==n)return t.core_tiplog("pathfind findpath sx=dx sy=dy return null",e,_,r,n),null;if(this.m_map_block_ref.is_block_cache(e,_))return t.core_tiplog("pathfind findpath sx sy is in block return null",e,_,r,n),null;var a,o=utils.genpointlinefrom2point(e,_,r,n,this.m_map_block_ref.m_grid_w,this.m_map_block_ref.m_grid_h);if(null==o||o.length<=0)return t.core_tiplog("pathfind gen first line failed return null",e,_,r,n),null;var m,h=o.length;if(this.m_map_block_ref.is_block_cache(r,n)){if(0==s)return t.core_tiplog("pathfind findpath dx dy is in block and bclosest = false return null",e,_,r,n),null;for(a=0;a<h&&(m=o[h-a-1],this.m_map_block_ref.is_block_cache(m.x,m.y));++a)o.splice(h-a-1,1);if(o.length<=1)return t.core_tiplog("pathfind findpath firstline only have 1 point return null",e,_,r,n),null;r=o[o.length-1].x,n=o[o.length-1].y,t.core_tiplog("pathfind findpath get substitution of dest ",r,n)}if(h=o.length,0==this.has_ptline_block(o)){var l=new Array;return l.push(new laya.maths.Point(e,_)),l.push(new laya.maths.Point(r,n)),t.core_tiplog("pathfind findpath dx dy can get directly return true",e,_,r,n),l}t.core_tiplog("pathfind findpath dx dy can not get directly ",e,_,r,n,o.length,o);var c=!1;this.m_open_heap.clear(),this._clear_openclose_flag();var p=this._get_pfd(e,_);for(p.m_g=0,p.calc(r,n),p.m_parent_x=-1,p.m_parent_y=-1,this.m_open_heap.push(p.m_h,p.m_key),this.m_open_flag[p.m_key]=p;!this.m_open_heap.is_empty();){var u=this.m_open_heap.top().m_user_id;this.m_open_heap.pop();var d=this.m_open_flag[u];if(this.m_close_flag[d.m_key]=d,this.m_open_flag[d.m_key]=void 0,c=this._add_node(d.x,d.y,d.x+1,d.y,d.m_g+this.m_g_h,r,n))break;if(c=this._add_node(d.x,d.y,d.x-1,d.y,d.m_g+this.m_g_h,r,n))break;if(c=this._add_node(d.x,d.y,d.x,d.y+1,d.m_g+this.m_g_h,r,n))break;if(c=this._add_node(d.x,d.y,d.x,d.y-1,d.m_g+this.m_g_h,r,n))break;if(c=this._add_node(d.x,d.y,d.x+1,d.y+1,d.m_g+this.m_g_c,r,n))break;if(c=this._add_node(d.x,d.y,d.x+1,d.y-1,d.m_g+this.m_g_c,r,n))break;if(c=this._add_node(d.x,d.y,d.x-1,d.y+1,d.m_g+this.m_g_c,r,n))break;if(c=this._add_node(d.x,d.y,d.x-1,d.y-1,d.m_g+this.m_g_c,r,n))break}if(0==c)return t.core_tiplog("pathfind findpath failed return null",e,_,r,n),null;for(var f=i._genkey(r,n),y=Array();;){var g=this.m_close_flag[f];if(-1==g.m_parent_x&&-1==g.m_parent_y){y.push(new laya.maths.Point(g.x,g.y));break}y.push(new laya.maths.Point(g.x,g.y)),f=i._genkey(g.m_parent_x,g.m_parent_y)}if(y.reverse(),(h=y.length)>2)for(var v=0,w=1,b=2;;){var x=y[v],O=y[w],k=y[b],E=!1;if(O.x==x.x&&k.x==O.x?E=!0:O.y==x.y&&k.y==O.y?E=!0:O.x-x.x==k.x-O.x&&O.y-x.y==k.y-O.y&&(E=!0),E?(y.splice(w,1),b=(w=v+1)+1):b=(w=(v=w)+1)+1,b>=y.length)break}(h=y.length)>3&&(y=this.delsurpluspoint(y));return t.core_tiplog("pathfind findpath normal end return true ",e,_,r,n,y),y},e.prototype.has_ptline_block=function(t){for(var i=t.length,e=0;e<i;++e){var _=t[e];if(this.m_map_block_ref.is_block_cache(_.x,_.y))return!0}return!1},e.prototype.delsurpluspoint=function(t){if(t.length<3)return t;var i=new Array,e=0,_=0,r=new laya.maths.Point;r.x=t[0].x,r.y=t[0].y,t.splice(0,1),e=0,_=t.length-1;for(var n=!0;n;){if(t.length<=1){i.push(r),t.length>0&&i.push(new laya.maths.Point(t[0].x,t[0].y)),n=!1;break}var s=e+_>>1,a=t[s];if(this.has_block_between_2pt(r.x,r.y,a.x,a.y))(_=s)==e&&(i.push(r),(r=new laya.maths.Point).x=t[e].x,r.y=t[e].y,0==e&&(e=1),t.splice(0,e),e=0,_=t.length-1);else{if(0==s){var o=t[s+1];this.has_block_between_2pt(r.x,r.y,o.x,o.y)&&(i.push(r),(r=new laya.maths.Point).x=t[s].x,r.y=t[s].y),t.splice(0,1)}else t.splice(0,s);e=0,_=t.length-1}}return i},e.prototype.has_block_between_2pt=function(t,i,e,_){var r=utils.genpointlinefrom2point(t,i,e,_,this.m_map_block_ref.m_grid_w,this.m_map_block_ref.m_grid_h);return null==r||r.length<=0||this.has_ptline_block(r)},e.prototype.dispose=function(){this._clear_openclose_flag()},e}();t.pathfind=e}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(i,e,_,r,n){void 0===n&&(n=8);var s=t.call(this)||this;return s.m_end_pt=null,s.m_start_tm=0,s.m_total_tm=0,s.m_dir=0,s.m_cur_pt=null,s.m_dir_count=8,s.m_angle=0,s.m_dx=0,s.m_dy=0,s.m_dx_idis=0,s.m_dy_idis=0,s.m_idis_sec=1e3,s.m_idis_millsec=1e6,s.m_end_pt=new laya.maths.Point,s.m_cur_pt=new laya.maths.Point,s.init(i,e,_,r,n),s}return __extends(i,t),i.prototype.init=function(t,i,e,_,r){void 0===r&&(r=8),this.x=t,this.y=i,this.m_end_pt.setTo(e,_),this.m_dx=e-t,this.m_dy=_-i,this.m_angle=utils.genangle(this.m_dx,this.m_dy),this.m_dir=utils.gendir(this.m_dx,this.m_dy,this.m_dir_count,this.m_angle)},i.prototype.cal_total_tm=function(t){var i=Math.abs(this.m_dx),e=Math.abs(this.m_dy),_=Math.sqrt(i*i+e*e);this.m_total_tm=1e3*_/t},i.prototype.is_end=function(t){return t-this.m_start_tm>=this.m_total_tm},i.prototype.get_pos=function(t){var i=t-this.m_start_tm;return i<=0?(this.m_cur_pt.x=this.x,this.m_cur_pt.y=this.y):i>=this.m_total_tm?(this.m_cur_pt.x=this.m_end_pt.x,this.m_cur_pt.y=this.m_end_pt.y):(this.m_cur_pt.x=this.x+i*this.m_dx/this.m_total_tm,this.m_cur_pt.y=this.y+i*this.m_dy/this.m_total_tm),this.m_cur_pt},i.prototype.dispose=function(){},i}(laya.maths.Point);t.pathnode=i}(core||(core={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_tween=null,i.m_dst=new laya.maths.Point,i.m_viewport=new laya.maths.Rectangle,i}return __extends(i,t),i.prototype.dispose=function(){},i.prototype.update=function(t){},i.prototype.project=function(t){this.m_viewport.setTo(this.x-(this.width>>1),this.y-(this.height>>1),this.width,this.height)},i.prototype.is_project=function(t){return this.m_viewport.intersects(t)},i.prototype.set_pos=function(t,i,e){void 0===e&&(e=!0),this.m_dst.x==t&&this.m_dst.y==i||(this.m_dst.setTo(t,i),null!=this.m_tween&&(laya.utils.Tween.clear(this.m_tween),this.m_tween=null),e?this.setTo(t,i,this.width,this.height):laya.utils.Tween.to(this,{x:t,y:i},500,Laya.Ease.cubicOut,null,0,!0,!0))},i}(laya.maths.Rectangle);t.rendercamera=i}(core||(core={})),function(t){var i=function(){function t(){this.m_walk_speed=300,this.m_run_speed=8e3}return t.prototype.get_move_spd=function(t){return t?this.m_run_speed:this.m_walk_speed},t.prototype.dispose=function(){this.m_render=null,this.m_camera=null,this.m_view=null},t}();t.rendercontext=i}(core||(core={})),function(t){function i(t,i){return t.m_screen_z-i.m_screen_z}var e=function(){function e(){this.m_eye=null,this.m_eye_tm=0,this.m_camera=new t.rendercamera,this.m_view=new t.renderview,this.m_scene=new t.renderscene,this.m_renderrcs=new Array,this.m_context=new t.rendercontext,this.m_context.m_camera=this.m_camera,this.m_context.m_render=this,this.m_context.m_view=this.m_view,this.m_world_rect=new laya.maths.Rectangle}return e.prototype.initstage=function(t){this.m_view.removeSelf(),t.addChild(this.m_view)},e.prototype.setworldwh=function(t,i){this.m_world_rect.setTo(0,0,t,i)},e.prototype.getworldw=function(){return this.m_world_rect.width},e.prototype.getworldh=function(){return this.m_world_rect.height},e.prototype.set_eye=function(t){this.m_eye=t},e.prototype._get_renderavatar_ins=function(i,e,_,r){void 0===r&&(r=!0);var n=utils.getitembycls("renderavatar",t.renderavatar);return n.re_init(i,e,_,r),n},e.prototype._del_renderavatar_ins=function(t){t.dispose(),utils.recover("renderavatar",t)},e.prototype._get_rendereff_ins=function(i,e,_,r,n){var s=utils.getitembycls("rendereff",t.rendereff);return s.re_init(i,e,_,r,n),s},e.prototype._del_rendereff_ins=function(t){t.dispose(),utils.recover("rendereff",t)},e.prototype._get_renderani_ins=function(i,e,_,r){var n=utils.getitembycls("renderani",t.renderani);return n.re_init(i,e,_,r),n},e.prototype._del_renderani_ins=function(t){t.dispose(),utils.recover("renderani",t)},e.prototype._get_rendersprite_ins=function(i,e,_,r){void 0===r&&(r=!0);var n=utils.getitembycls("rendersprite",t.rendersprite);return n.re_init(i,e,_,r),n},e.prototype._del_rendersprite_ins=function(t){t.dispose(),utils.recover("rendersprite",t)},e.prototype.update_camera_pos=function(t){null!=this.m_eye&&(this.m_eye_tm+=t,this.m_eye_tm>0&&(this.m_eye_tm=0,this.setcamerapos(this.m_eye.x,this.m_eye.y,!0)))},e.prototype.setcamerapos=function(t,i,e){void 0===e&&(e=!0);var _=0,r=0,n=0,s=0;this.getviewportw()>=this.getworldw()?t=this.getworldw()>>1:(t<(_=this.getviewportw()>>1)&&(t=_),t>(r=this.getworldw()-(this.getviewportw()>>1))&&(t=r)),this.getviewporth()>=this.getworldh()?i=this.getworldh()>>1:(i<(n=this.getviewporth()>>1)&&(i=n),i>(s=this.getworldh()-(this.getviewporth()>>1))&&(i=s)),this.m_camera.set_pos(t,i,e)},e.prototype.setviewport=function(t,i){this.m_camera.setTo(this.m_camera.x,this.m_camera.y,t,i)},e.prototype.getviewportw=function(){return this.m_camera.width},e.prototype.getviewporth=function(){return this.m_camera.height},e.prototype.dispose=function(){this.m_renderrcs=null,null!=this.m_scene&&(this.m_scene.dispose(),this.m_scene=null),null!=this.m_context&&(this.m_context.dispose(),this.m_context=null),null!=this.m_camera&&(this.m_camera.dispose(),this.m_camera=null),null!=this.m_view&&(this.m_view.removeSelf(),this.m_view.dispose(),this.m_view=null)},e.prototype.addrc=function(t){this.m_renderrcs.push(t)},e.prototype.update=function(t){this.update_camera_pos(t),this.m_camera.update(t),this.m_scene.update(t),this.m_view.update(t)},e.prototype.render=function(){this.m_renderrcs.length=0,this.m_camera.project(this.m_context),this.m_view.project(this.m_context),this.m_scene.project(this.m_context),this.m_renderrcs.sort(i),this.m_view.renderbefore();for(var t=0,e=this.m_renderrcs;t<e.length;t++){e[t].render(this.m_context)}this.m_view.renderafter()},e.prototype.check_click=function(t,i){for(var e=this.m_renderrcs.length-1;e>0;--e)if(this.m_renderrcs[e].is_contain(t,i))return this.m_renderrcs[e].m_obj.m_obj_id;return 0},e}();t.renderimpl=e}(core||(core={})),function(t){var i=function(){function i(){this.m_units=new Array,this.m_units_dict=new Object,this.m_anis=new Array,this.m_effs=new Array,this.m_tempeffs=new Array,this.m_sprites=new Array,this.m_map=new t.rendermap,this.m_unitpath=new Array,this.m_follow_list=new Object}return i.prototype.findpath=function(t,i,e,_,r,n){return this.m_map.findpath(t,i,e,_,r,n)},i.prototype.addpath=function(t,i){this.delpath(i),null!=this.getunit(i)&&(t.m_unit_id=i,this.m_unitpath.push(t))},i.prototype.get_unitpath=function(t){for(var i=0,e=this.m_unitpath;i<e.length;i++){var _=e[i];if(_.m_unit_id==t)return _}return null},i.prototype.delpath=function(t){for(var i=0;i<this.m_unitpath.length;++i){var e=this.m_unitpath[i];if(e.m_unit_id==t)return e.dispose(),this.m_unitpath.splice(i,1),utils.recover("path",e),e}return null},i.prototype.addunit=function(t,i){return i.set_name(t),this.m_units.push(i),this.m_units_dict[i.m_obj_id]=i,i.m_obj_id},i.prototype.delunit=function(t){for(var i=0;i<this.m_units.length;++i){var e=this.m_units[i];if(e.m_obj_id==t)return delete this.m_units_dict[t],this.delpath(t),e.dispose(),this.m_units.splice(i,1),e}return null},i.prototype.getunitbyud=function(t){for(var i=0;i<this.m_units.length;++i){var e=this.m_units[i];if(e.m_user_data==t)return e}return null},i.prototype.getunit=function(t){var i=this.m_units_dict[t];return null!=i?i:null},i.prototype.setunit_pos=function(t,i,e){var _=this.getunit(t);null!=_&&_.set_pos(i,e)},i.prototype.setunit_dir=function(t,i){var e=this.getunit(t);null!=e&&e.change_dir(i)},i.prototype.setunit_action=function(t,i){var e=this.getunit(t);null!=e&&e.change_action(i)},i.prototype.clear=function(){},i.prototype.dispose=function(){if(null!=this.m_sprites){for(var t=0,i=this.m_sprites;t<i.length;t++){i[t].dispose()}this.m_sprites=null}if(null!=this.m_anis){for(var e=0,_=this.m_anis;e<_.length;e++){_[e].dispose()}this.m_anis=null}if(null!=this.m_effs){for(var r=0,n=this.m_effs;r<n.length;r++){n[r].dispose()}this.m_effs=null}if(null!=this.m_units){for(var s=0,a=this.m_units;s<a.length;s++){a[s].dispose()}this.m_units=null}this.m_units_dict=null,null!=this.m_map&&(this.m_map.dispose(),this.m_map=null),this.m_unitpath=null,this.m_follow_list=null},i.prototype.update=function(t){this.m_map.update(t);for(var i=0,e=this.m_units;i<e.length;i++){(a=e[i]).update(t)}for(var _=0,r=this.m_anis;_<r.length;_++){(a=r[_]).update(t)}this.m_tempeffs=new Array;for(var n=0,s=this.m_effs;n<s.length;n++){(a=s[n]).m_b_end&&a.m_b_autodel?a.dispose():(a.update(t),this.m_tempeffs.push(a))}this.m_effs=this.m_tempeffs;for(var a=this.m_unitpath.length-1;a>=0;--a){var o=this.m_unitpath[a];o.update(t);var m=o.get_cur_pt();this.setunit_pos(o.m_unit_id,m.x,m.y),this.setunit_dir(o.m_unit_id,m.m_dir),o.is_end()&&(this.setunit_action(o.m_unit_id,0),o.dispose(),this.m_unitpath.splice(a,1))}},i.prototype.project=function(t){this.m_map.project(t);for(var i=0,e=this.m_units;i<e.length;i++){e[i].project(t)}for(var _=0,r=this.m_anis;_<r.length;_++){r[_].project(t)}for(var n=0,s=this.m_sprites;n<s.length;n++){s[n].project(t)}for(var a=0,o=this.m_effs;a<o.length;a++){o[a].project(t)}},i}();t.renderscene=i}(core||(core={}));var core;__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_mapView=new laya.display.Sprite,i.addChild(i.m_mapView),i.m_map_mask=new Laya.Sprite,i.m_map_mask.graphics.drawRect(0,0,3e3,3e3,"#000000"),i.m_map_mask.alpha=.3,i.m_screeneffect_view=new Laya.Sprite,i.addChild(i.m_screeneffect_view),i.m_ani_underunit_View=new laya.display.Sprite,i.addChild(i.m_ani_underunit_View),i.m_unitshadow_View=new Laya.Sprite,i.addChild(i.m_unitshadow_View),i.m_unitname_View=new Laya.Sprite,i.addChild(i.m_unitname_View),i.m_unitground_View=new Laya.Sprite,i.addChild(i.m_unitground_View),i.m_unitView=new laya.display.Sprite,i.addChild(i.m_unitView),i.m_unitfront_View=new Laya.Sprite,i.addChild(i.m_unitfront_View),i.m_ani_uponunit_view=new laya.display.Sprite,i.addChild(i.m_ani_uponunit_view),i}return __extends(i,t),i.prototype.renderbefore=function(){this.m_mapView.graphics.clear(),this.m_mapView.removeChildren(),this.m_ani_underunit_View.graphics.clear(),this.m_ani_underunit_View.removeChildren(),this.m_unitshadow_View.removeChildren(),this.m_unitshadow_View.graphics.clear(),this.m_unitname_View.removeChildren(),this.m_unitname_View.graphics.clear(),this.m_unitground_View.graphics.clear(),this.m_unitground_View.removeChildren(),this.m_unitView.graphics.clear(),this.m_unitView.removeChildren(),this.m_unitfront_View.graphics.clear(),this.m_unitfront_View.removeChildren(),this.m_ani_uponunit_view.graphics.clear(),this.m_ani_uponunit_view.removeChildren()},i.prototype.blackscreen=function(t){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),this.m_screeneffect_view.graphics.clear(),this.m_screeneffect_view.graphics.drawRect(-500,-500,3e3,3e3,"#000000"),this.m_screeneffect_view.alpha=0,Laya.Tween.to(this.m_screeneffect_view,{alpha:1},t,Laya.Ease.linearIn,Laya.Handler.create(this,this.blackreset,[1e3])))},i.prototype.blackreset=function(t){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),Laya.Tween.to(this.m_screeneffect_view,{alpha:0},t,Laya.Ease.linearIn,Laya.Handler.create(this,this.resetscreenview)))},i.prototype.resetscreenview=function(){null!=this.m_screeneffect_view&&(Laya.Tween.clearAll(this.m_screeneffect_view),this.m_screeneffect_view.graphics.clear())},i.prototype.renderafter=function(){},i.prototype.update=function(t){},i.prototype.show_map_mask=function(t,i){void 0===i&&(i=.3),this.m_map_mask.alpha=i,t?this.addChildAt(this.m_map_mask,1):this.removeChild(this.m_map_mask)},i.prototype.project=function(t){var i=t.m_camera.x,e=t.m_camera.y;this.x=(t.m_camera.width>>1)-i,this.y=(t.m_camera.height>>1)-e,this.m_map_mask.x=t.m_camera.x-(t.m_camera.width>>1),this.m_map_mask.y=t.m_camera.y-(t.m_camera.height>>1)},i.prototype.get_mapviewport_canvas=function(t,i,e){return this.m_mapView.drawToCanvas(i,e,0,0)},i.prototype.dispose=function(){this.removeChildren(),this.m_screeneffect_view=null,this.m_map_mask=null,this.m_mapView=null,this.m_unitshadow_View=null,this.m_unitname_View=null,this.m_unitground_View=null,this.m_unitView=null,this.m_unitfront_View=null,this.m_ani_underunit_View=null,this.m_ani_uponunit_view=null},i}(laya.display.Sprite);t.renderview=i}(core||(core={})),function(t){var i=function(){function i(){this.m_update_follow_tm=0,this.m_render=new t.renderimpl}return i.prototype.set_avatar_config=function(i){t.matinfo_mgr().set_avatar_config(i)},i.prototype.set_map_config=function(i){t.matinfo_mgr().set_map_config(i)},i.prototype.set_ani_config=function(i){t.matinfo_mgr().set_ani_config(i)},i.prototype.set_eff_config=function(i){t.matinfo_mgr().set_eff_config(i)},i.prototype.initstage=function(t){this.m_render.initstage(t)},i.prototype.check_point=function(t,i){return this.m_render.check_click(t,i)},i.prototype.blackscene=function(t){this.m_render.m_view.blackscreen(t)},i.prototype.setcamerapos=function(t,i,e){void 0===e&&(e=!0),this.m_render.setcamerapos(t,i,e)},i.prototype.cameralookat=function(t){this.m_render.set_eye(t)},i.prototype.setviewport=function(t,i){this.m_render.setviewport(t,i)},i.prototype.update=function(t){this.m_render.update(t),this.m_update_follow_tm+=t,this.m_update_follow_tm>500&&(this.update_follow_pos(),this.m_update_follow_tm=0)},i.prototype.render=function(){this.m_render.render()},i.prototype.dispose=function(){null!=this.m_render&&(this.m_render.dispose(),this.m_render=null)},i.prototype.clear=function(){this.m_render.m_scene.m_map.clear(),this.delallani(),this.delalleff(),this.delallsprite(),this.delallunit()},i.prototype.check_release=function(){t.mat_mgr().check_release()},i.prototype.clearmap=function(){this.m_render.m_scene.m_map.clear()},i.prototype.clearmapslotcache=function(){t.mat_mgr().clearallmapslot()},i.prototype.set_map_filter=function(t){this.m_render.m_view.m_mapView.filters=t},i.prototype.show_map_mask=function(t,i){void 0===i&&(i=.3),this.m_render.m_view.show_map_mask(t,i)},i.prototype.setmapbk=function(t){this.m_render.m_scene.m_map.setbk(t)},i.prototype.setmapbksp=function(t){this.m_render.m_scene.m_map.setsp(t)},i.prototype.clearmapbksp=function(){this.m_render.m_scene.m_map.removesp()},i.prototype.stagepos2worldpos=function(t){return new laya.maths.Point(t.x+this.m_render.m_camera.m_viewport.x,t.y+this.m_render.m_camera.m_viewport.y)},i.prototype.worldpos2stagepos=function(t){return new laya.maths.Point(t.x-this.m_render.m_camera.m_viewport.x,t.y-this.m_render.m_camera.m_viewport.y)},i.prototype.entermap=function(t,i){void 0===i&&(i=!0),this.m_render.m_scene.m_map.setmapid(t,i),this.m_render.setworldwh(this.m_render.m_scene.m_map.m_mapw,this.m_render.m_scene.m_map.m_maph)},i.prototype.addani=function(t,i,e,_){void 0===_&&(_=!0);var r=this.m_render._get_renderani_ins(t,i,e,_);return this.m_render.m_scene.m_anis.push(r),r.m_obj_id},i.prototype.delani=function(t){for(var i=0,e=0,_=this.m_render.m_scene.m_anis;e<_.length;e++){var r=_[e];if(r.m_obj_id==t)return r.dispose(),this.m_render.m_scene.m_anis.splice(i,1),void this.m_render._del_renderani_ins(r);i++}},i.prototype.delallani=function(){for(var t=0,i=this.m_render.m_scene.m_anis;t<i.length;t++){var e=i[t];e.dispose(),this.m_render._del_renderani_ins(e)}this.m_render.m_scene.m_anis=new Array},i.prototype.addsprite=function(t,i,e,_){void 0===_&&(_=!0);var r=this.m_render._get_rendersprite_ins(t,i,e,_);return this.m_render.m_scene.m_sprites.push(r),r.m_obj_id},i.prototype.getsprite=function(t){for(var i=0,e=this.m_render.m_scene.m_sprites;i<e.length;i++){var _=e[i];if(_.m_obj_id==t)return _}return null},i.prototype.delsprite=function(t){for(var i=0,e=0,_=this.m_render.m_scene.m_sprites;e<_.length;e++){var r=_[e];if(r.m_obj_id==t)return r.dispose(),this.m_render.m_scene.m_sprites.splice(i,1),void this.m_render._del_rendersprite_ins(r);i++}},i.prototype.delallsprite=function(){for(var t=0,i=this.m_render.m_scene.m_sprites;t<i.length;t++){var e=i[t];e.dispose(),this.m_render._del_rendersprite_ins(e)}this.m_render.m_scene.m_sprites=new Array},i.prototype.addeff=function(t,i,e,_,r){void 0===_&&(_=!0),void 0===r&&(r=!1);var n=this.m_render._get_rendereff_ins(t,i,e,_,r);return this.m_render.m_scene.m_effs.push(n),n.m_obj_id},i.prototype.deleff=function(t){for(var i=0,e=0,_=this.m_render.m_scene.m_effs;e<_.length;e++){var r=_[e];if(r.m_obj_id==t)return r.dispose(),this.m_render.m_scene.m_effs.splice(i,1),void this.m_render._del_rendereff_ins(r);i++}},i.prototype.delalleff=function(){for(var t=0,i=this.m_render.m_scene.m_effs;t<i.length;t++){var e=i[t];e.dispose(),this.m_render._del_rendereff_ins(e)}this.m_render.m_scene.m_effs=new Array},i.prototype.addunit=function(t,i,e,_,r){void 0===r&&(r=!0);var n=this.m_render._get_renderavatar_ins(i,e,_,r);return this.m_render.m_scene.addunit(t,n)},i.prototype.delunit=function(t){var i=this.m_render.m_scene.delunit(t);if(null!=i&&null!=this.m_render.m_eye&&this.m_render.m_eye==i&&this.cameralookat(null),null!=i){null!=this.m_render.m_scene.m_follow_list[t]&&delete this.m_render.m_scene.m_follow_list[t];for(var e=new Array,_=0,r=Object.keys(this.m_render.m_scene.m_follow_list);_<r.length;_++){var n=r[_];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(n)){var s=parseInt(n);this.m_render.m_scene.m_follow_list[s]==t&&(e.push(s),delete this.m_render.m_scene.m_follow_list[s])}}this.m_render._del_renderavatar_ins(i);for(var a=0,o=e;a<o.length;a++){var m=o[a];this.delunit(m)}}},i.prototype.set_follow_id=function(t,i){var e=this.getunit(t);if(null!=e){var _=this.getunit(i);if(null!=_){this.m_render.m_scene.m_follow_list[t]=i;e.set_pos(_.x+100*Math.random()-50,_.y+100*Math.random()-50)}}},i.prototype.clear_follow_id=function(t){this.m_render.m_scene.m_follow_list.hasOwnProperty(t.toString())&&delete this.m_render.m_scene.m_follow_list[t]},i.prototype.clear_all_follow=function(t){for(var i=0,e=Object.keys(this.m_render.m_scene.m_follow_list);i<e.length;i++){var _=e[i];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(_))this.m_render.m_scene.m_follow_list[parseInt(_)]==t&&(this.delunit(parseInt(_)),delete this.m_render.m_scene.m_follow_list[parseInt(_)])}},i.prototype._gen_back_pos=function(t,i){switch(i){case 0:t.y-=30,t.x+=40;break;case 1:t.y+=10,t.x+=45;break;case 2:t.y+=40,t.x+=30;break;case 3:t.y+=45,t.x-=10;break;case 4:t.y+=30,t.x-=40;break;case 5:t.y-=15,t.x-=40;break;case 6:t.y-=40,t.x-=30;break;case 7:t.y+=10,t.x-=45}return t},i.prototype.update_follow_pos=function(){for(var t=new Laya.Point,i=0,e=Object.keys(this.m_render.m_scene.m_follow_list);i<e.length;i++){var _=e[i];if(this.m_render.m_scene.m_follow_list.hasOwnProperty(_)){var r=parseInt(_),n=this.m_render.m_scene.m_follow_list[r],s=this.getunit(n);null!=s&&(t.x=s.x,t.y=s.y,t=this._gen_back_pos(t,s.m_dir),this.unit_walk2(r,t.x,t.y,!0))}}},i.prototype.delallunit=function(){this.cameralookat(null);for(var t=0;t<this.m_render.m_scene.m_units.length;++t){var i=this.m_render.m_scene.m_units[t];this.m_render.m_scene.delpath(i.m_obj_id),i.dispose(),this.m_render._del_renderavatar_ins(i)}this.m_render.m_scene.m_units_dict=new Object,this.m_render.m_scene.m_units.length=0,this.m_render.m_scene.m_follow_list=new Object},i.prototype.getunitbyud=function(t){return this.m_render.m_scene.getunitbyud(t)},i.prototype.getunit=function(t){return this.m_render.m_scene.getunit(t)},i.prototype.getmap_gridw=function(){return this.m_render.m_scene.m_map.m_block.m_mat.m_grid_w},i.prototype.getmap_gridh=function(){return this.m_render.m_scene.m_map.m_block.m_mat.m_grid_h},i.prototype.unit_stop=function(t){var i=this.getunit(t);null!=i&&(this.m_render.m_scene.delpath(t),i.change_action(0))},i.prototype.is_unit_walk=function(t){return null!=this.m_render.m_scene.get_unitpath(t)},i.prototype.get_unit_walk=function(t){return this.m_render.m_scene.get_unitpath(t)},i.prototype.is_scene_block=function(t,i){return this.m_render.m_scene.m_map.is_block(t,i)},i.prototype.get_map_canvas=function(t,i,e,_){return this.m_render.m_view.get_mapviewport_canvas(this.m_render.m_context,t,i)},i.prototype.get_camera_x=function(){return this.m_render.m_camera.x},i.prototype.get_view_x=function(){return this.m_render.m_view.x},i.prototype.get_view_y=function(){return this.m_render.m_view.y},i.prototype.get_camera_y=function(){return this.m_render.m_camera.y},i.prototype.set_walk_spd=function(t){this.m_render.m_context.m_walk_speed=t},i.prototype.set_run_spd=function(t){this.m_render.m_context.m_run_speed=t},i.prototype.unit_walk2inspd=function(i,e,_,r,n){var s=this.getunit(i);if(null!=s){var a=s.x,o=s.y;if(a==e&&o==_)return;t.core_tiplog("unit_walk2 findpath start ",i,a,o,e,_);var m=null;if(r?((m=utils.getitembycls("path",t.path)).init(n),m.push_pt(a,o,e,_)):m=this.m_render.m_scene.findpath(a,o,e,_,!0,n),t.core_tiplog("unit_walk2 findpath end ",i,a,o,e,_,m),null==m)return;return m.start(),this.m_render.m_scene.addpath(m,i),s.change_action(1),m.get_end()}},i.prototype.unit_walk2=function(t,i,e,_,r){return void 0===_&&(_=!1),void 0===r&&(r=!1),this.unit_walk2inspd(t,i,e,_,this.m_render.m_context.get_move_spd(r))},i}();t.renderagent=i}(core||(core={})),function(t){var i=function(){return function(){this.m_key=0,this.m_size=0,this.m_offset=0}}(),e=function(){function e(t){this.m_sign=0,this.m_version=0,this.m_filecount=0,this.m_filehead_arr=new Array,this.m_filehead_dict=new Object,this.m_buff=null,this.m_fh_sign="pack_file_head",this.m_buff=t,this.m_buff.pos=0,this.m_sign=this.m_buff.getUint32(),this.m_version=this.m_buff.getUint8(),this.m_filecount=this.m_buff.getUint32();for(var e=0;e<this.m_filecount;++e){var _=this.m_buff.getUint32(),r=this.m_buff.getUint32(),n=this.m_buff.getUint32(),s=utils.getitembycls(this.m_fh_sign,i);s.m_key=_,s.m_size=r,s.m_offset=n,this.m_filehead_arr.push(s),this.m_filehead_dict[_]=s}}return e.prototype.dispose=function(){for(var t=0,i=this.m_filehead_arr;t<i.length;t++){var e=i[t];utils.recover(this.m_fh_sign,e)}this.m_filehead_arr.length=0,this.m_filehead_dict=new Object,this.m_buff.clear(),this.m_buff=null},e.prototype._gen_key=function(i){var e=t.get_file_key(i);return t.core_tiplog("filepack _gen_key ",i,e.toString(16)),e},e.prototype.get_file=function(t){var i=this._gen_key(t);if(null==this.m_filehead_dict[i])return null;var e=this.m_filehead_dict[i];this.m_buff.pos=e.m_offset;e.m_size;return this.m_buff},e.prototype.get_file_len=function(t){var i=this._gen_key(t);return null==this.m_filehead_dict[i]?0:this.m_filehead_dict[i].m_size},e}(),_=function(){function t(){this.m_pack_dict=new Object}return t.prototype.delpack=function(t){if(0!=this.m_pack_dict.hasOwnProperty(t)){var i=this.m_pack_dict[t];null!=i&&null!=i&&i.dispose(),this.m_pack_dict[t]=null}},t.prototype.addpack=function(t,i){this.m_pack_dict.hasOwnProperty(t)&&this.delpack(t);var _=new e(i);this.m_pack_dict[t]=_},t.prototype.get_file=function(t,i){if(0!=this.m_pack_dict.hasOwnProperty(t)){var e=this.m_pack_dict[t];return null!=e&&null!=e?e.get_file(i):null}},t.prototype.get_file_len=function(t,i){if(0==this.m_pack_dict.hasOwnProperty(t))return 0;var e=this.m_pack_dict[t];return null!=e&&null!=e?e.get_file_len(i):0},t}();t.filepackmgr=_;var r=null;t.filepack_ins=function(){return null==r&&(r=new _),r}}(core||(core={})),function(t){var i=function(){function t(){this.m_data_class_map=new Object,this.m_data_map=new Object}return t.prototype.register_data=function(t,i){this.m_data_class_map[t]=i},t.prototype.get_data=function(t){if(this.m_data_map.hasOwnProperty(t))return this.m_data_map[t];if(this.m_data_class_map.hasOwnProperty(t)){var i=new(0,this.m_data_class_map[t]);return this.m_data_map[t]=i,i}return null},t.prototype.dispose=function(){this.m_data_class_map=new Object;for(var t=0,i=Object.keys(this.m_data_map);t<i.length;t++){var e=i[t];this.m_data_map[e].dispose()}this.m_data_map=new Object},t}();t.game_data_mgr=i;var e=null;t.data_ins=function(){return null==e&&(e=new i),e}}(utils||(utils={})),function(t){var i=function(){function t(){}return t.prototype.dispose=function(){},t}();t.game_data=i}(utils||(utils={})),function(t){var i=function(){function t(){this.m_event_func=new Object}return t.prototype.register_event_func=function(t,i){this.m_event_func[t]=i},t.prototype.unregister_event_func=function(t){this.m_event_func.hasOwnProperty(t)&&delete this.m_event_func[t]},t.prototype.unregister_all_event_func=function(){this.m_event_func=new Object},t.prototype.on_event=function(t,i){(void 0===i&&(i=null),this.m_event_func.hasOwnProperty(t))&&this.m_event_func[t].apply(this,[i])},t.prototype.dispose=function(){this.unregister_all_event_func()},t}();t.game_event_receiver=i;var e=function(){function t(){this.m_pause=!1,this.m_handler_map=new Object,this.m_handler_next_frame_map=new Object}return t.prototype.pause=function(){this.m_pause=!0},t.prototype.resume=function(){this.m_pause=!1},t.prototype.register_event=function(t,i){0==this.m_handler_map.hasOwnProperty(t)&&(this.m_handler_map[t]=new Array);var e=this.m_handler_map[t];e.indexOf(i)<0&&e.push(i)},t.prototype.unregister_event=function(t,i){if(this.m_handler_map.hasOwnProperty(t)){var e=this.m_handler_map[t],_=e.indexOf(i);_>=0&&e.splice(_,1)}},t.prototype.unregister_allevent=function(t){for(var i in this.m_handler_map)this.m_handler_map.hasOwnProperty(i)&&this.unregister_event(i,t)},t.prototype.fire_event=function(t,i){if(void 0===i&&(i=null),this.m_handler_map.hasOwnProperty(t))for(var e=0,_=this.m_handler_map[t];e<_.length;e++){_[e].on_event(t,i)}},t.prototype.fire_event_next_frame=function(t,i){void 0===i&&(i=null),this.m_handler_next_frame_map[t]=i},t.prototype.dispatch_all_delay_event=function(){if(!this.m_pause){var t=this.m_handler_next_frame_map;this.m_handler_next_frame_map=new Object;for(var i=0,e=Object.keys(t);i<e.length;i++){var _=e[i];this.fire_event(_,t[_])}}},t.prototype.dispose=function(){this.m_handler_map=new Object,this.m_handler_next_frame_map=new Object},t}();t.game_event_dispatcher=e;var _=null;t.event_ins=function(){return null==_&&(_=new e),_}}(utils||(utils={})),function(t){var i=function(){function t(){this.m_module_class_map=new Object,this.m_module_map=new Object}return t.prototype.register_module=function(t,i){this.m_module_class_map[t]=i},t.prototype.get_module=function(t){if(this.m_module_map.hasOwnProperty(t))return this.m_module_map[t];if(this.m_module_class_map.hasOwnProperty(t)){var i=new(0,this.m_module_class_map[t]);return this.m_module_map[t]=i,i}return null},t.prototype.dispose=function(){this.m_module_class_map=new Object;for(var t=0,i=Object.keys(this.m_module_map);t<i.length;t++){var e=i[t];this.m_module_map[e].dispose()}this.m_module_map=new Object},t}();t.game_module_mgr=i;var e=null;t.module_ins=function(){return null==e&&(e=new i),e}}(utils||(utils={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.register_net_event=function(i,e){var _=game_event.gen_netcmd_event(i);t.event_ins().register_event(_,this),this.register_event_func(_,e)},e.prototype.unregister_net_event=function(i){var e=game_event.gen_netcmd_event(i);t.event_ins().unregister_event(e,this),this.unregister_event_func(e)},e.prototype.register_event=function(i,e){t.event_ins().register_event(i,this),this.register_event_func(i,e)},e.prototype.unregister_event=function(i){t.event_ins().unregister_event(i,this),this.unregister_event_func(i)},e.prototype.fire_event=function(i,e){void 0===e&&(e=null),t.event_ins().fire_event(i,e)},e.prototype.unregister_allevent=function(){t.event_ins().unregister_allevent(this),this.unregister_all_event_func()},e.prototype.fire_event_next_frame=function(i,e){void 0===e&&(e=null),t.event_ins().fire_event_next_frame(i,e)},e.prototype.start=function(){},e.prototype.update=function(t){},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.unregister_allevent()},e}(t.game_event_receiver);t.game_module=i}(utils||(utils={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(t){function i(){var i=t.call(this)||this;return i.m_b_use_ani=!0,i}return __extends(i,t),i.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.uiView)},i.prototype.init=function(){this.m_mask=new Laya.Sprite,this.m_mask.x=0,this.m_mask.graphics.drawRect(0,0,this.m_logo.width,this.m_logo.height,"#000000")},i.prototype.start=function(){this.m_b_use_ani?(this.m_logo.visible=!1,this.m_logo_grey.visible=!1,this.m_mask.visible=!1,this.m_progress.visible=!1,this.m_ani.play(),this.m_ani.visible=!0):(this.m_logo.visible=!0,this.m_logo_grey.visible=!0,this.m_mask.visible=!0,this.m_progress.visible=!0,this.m_ani.stop(),this.m_ani.visible=!1,this.m_mask.x=0)},i.prototype.update=function(){this.m_b_use_ani||(this.m_mask.x>=this.m_logo_grey.width?this.m_mask.x=0:this.m_mask.x+=2)},i.uiView={type:"Dialog",props:{y:0,x:0,width:800,height:400,anchorY:0,anchorX:0},child:[{type:"Image",props:{y:0,x:0,var:"m_logo",skin:"bigpic/ui_loading.png",gray:!1}},{type:"Label",props:{y:309,x:326,width:192,var:"m_progress",height:88,fontSize:50,color:"#ffffff",align:"center"}},{type:"Image",props:{y:0,x:0,var:"m_logo_grey",skin:"bigpic/ui_loading.png",gray:!0}},{type:"Animation",props:{y:231,x:400,width:0,var:"m_ani",source:"game_ani/uiloading.ani",name:"m_ani",height:0}}]},i}(laya.ui.Dialog);t.ui_loadingUI=i;var e=function(){function e(){this.m_widget_class_map=new Object,this.m_widget_group_map=new Object,this.m_widget_map=new Object,this.m_root_view=null,this.m_view_ins=new t.game_widget_view,this.m_release_dict=new Object,this.m_loading_ui=null,this.m_loadingui_dict=new Object,this.m_loadingui_refs=0}return e.prototype.show_loadingui=function(){null==this.m_loading_ui&&(this.m_loading_ui=new i,this.m_loading_ui.init(),this.m_loading_ui.x=Laya.stage.width-this.m_loading_ui.width>>1,this.m_loading_ui.y=Laya.stage.height-this.m_loading_ui.height>>1),this.m_loading_ui.visible=!0,this.m_loading_ui.start(),this.m_view_ins.m_view_topmost.addChild(this.m_loading_ui)},e.prototype.hide_loadingui=function(){null!=this.m_loading_ui&&(this.m_loading_ui.visible=!1,this.m_loading_ui.removeSelf())},e.prototype.update_loadingui=function(){null!=this.m_loading_ui&&0!=this.m_loading_ui.visible&&this.m_loading_ui.update()},e.prototype.del_loadingui=function(){null!=this.m_loading_ui&&(this.m_loading_ui.removeSelf(),this.m_loading_ui.destroy(),this.m_loading_ui=null)},e.prototype.start_load=function(t){0==this.m_loadingui_dict.hasOwnProperty(t.m_id.toString())&&(this.m_loadingui_dict[t.m_id.toString()]=!0,this.m_loadingui_refs+=1,this.show_loadingui())},e.prototype.end_load=function(t){this.m_loadingui_dict.hasOwnProperty(t.m_id.toString())&&(delete this.m_loadingui_dict[t.m_id.toString()],this.m_loadingui_refs-=1,this.m_loadingui_refs<=0&&this.hide_loadingui())},e.prototype.add_preload_res=function(i){t.game_widget.s_loaded_dict[i]=!0},e.prototype.set_root=function(t){this.m_view_ins.removeSelf(),this.m_root_view=t,this.m_root_view.addChild(this.m_view_ins)},e.prototype.get_view=function(t){return this.m_view_ins.get_view(t)},e.prototype.register_widget=function(i,e,_){void 0===_&&(_=t.WIDGET_GROUP.GROUP_DEFAULT),this.m_widget_class_map[i]=e,this.m_widget_group_map[i]=_},e.prototype.set_widget_group=function(t,i){this.m_widget_group_map[t]=i},e.prototype.get_module=function(t){if(this.m_widget_map.hasOwnProperty(t))return this.m_widget_map[t];if(this.m_widget_class_map.hasOwnProperty(t)){var i=new(0,this.m_widget_class_map[t]);return this.m_widget_map[t]=i,i.m_widget_name=t,i}return null},e.prototype.show_widget=function(i,e,_){void 0===_&&(_=null);var r=this.get_module(i);null!=r&&(null!=_&&(r.m_ud=_),r.show(e),e?delete this.m_release_dict[i]:this.m_release_dict[i]=[r,t.get_render_milltm()])},e.prototype.call_widget_hide=function(i){this.m_release_dict[i.m_widget_name]=[i,t.get_render_milltm()]},e.prototype.check_release=function(){this.update_loadingui();for(var i=0,e=Object.keys(this.m_release_dict);i<e.length;i++){var _=e[i];if(this.m_release_dict.hasOwnProperty(_)){var r=this.m_release_dict[_][1];if(t.get_render_milltm()-r>1e4){var n=this.m_widget_map[_];return t.event_ins().fire_event(game_event.EVENT_WIDGET_ONDISPOSE,n),n.dispose(),delete this.m_widget_map[_],delete this.m_release_dict[_],void core.core_errlog("game_widget_mgr release ",_)}}}},e.prototype.show_widget_bygroup=function(t,i,e){for(var _ in void 0===e&&(e=null),this.m_widget_group_map){if(this.m_widget_group_map.hasOwnProperty(_))t==this.m_widget_group_map[_]&&this.show_widget(_,i,e)}},e.prototype.is_widget_show=function(t){var i=this.get_module(t);return null!=i&&i.m_b_show},e.prototype.dispose=function(){this.del_loadingui(),this.m_widget_class_map=new Object,t.event_ins().fire_event(game_event.EVENT_WIDGET_ALLDISPOSE);for(var i=0,e=Object.keys(this.m_widget_map);i<e.length;i++){var _=e[i];this.m_widget_map[_].dispose()}null!=this.m_view_ins&&(this.m_view_ins.removeSelf(),this.m_view_ins.dispose(),this.m_view_ins=null),this.m_root_view=null,this.m_widget_map=new Object,this.m_widget_group_map=new Object},e}();t.game_widget_mgr=e;var _=null;t.widget_ins=function(){return null==_&&(_=new e),_}}(utils||(utils={})),function(t){var i,e;(i=t.WIDGET_LAYER||(t.WIDGET_LAYER={}))[i.SCENE=0]="SCENE",i[i.BACKGROUND=1]="BACKGROUND",i[i.BOTTOM=2]="BOTTOM",i[i.NORMAL=3]="NORMAL",i[i.POPUP=4]="POPUP",i[i.TIPS=5]="TIPS",i[i.TOP=6]="TOP",i[i.TOPMOST=7]="TOPMOST",(e=t.WIDGET_GROUP||(t.WIDGET_GROUP={}))[e.GROUP_DEFAULT=0]="GROUP_DEFAULT",e[e.GROUP_0=1]="GROUP_0",e[e.GROUP_1=2]="GROUP_1",e[e.GROUP_2=3]="GROUP_2",e[e.GROUP_3=4]="GROUP_3",e[e.GROUP_4=5]="GROUP_4"}(utils||(utils={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.m_view_scene=new laya.display.Sprite,t.m_view_bk=new laya.display.Sprite,t.m_view_bottom=new laya.display.Sprite,t.m_view_normal=new laya.display.Sprite,t.m_view_tips=new laya.display.Sprite,t.m_view_popup=new laya.display.Sprite,t.m_view_top=new laya.display.Sprite,t.m_view_topmost=new laya.display.Sprite,t.addChild(t.m_view_scene),t.addChild(t.m_view_bk),t.addChild(t.m_view_bottom),t.addChild(t.m_view_normal),t.addChild(t.m_view_popup),t.addChild(t.m_view_tips),t.addChild(t.m_view_top),t.addChild(t.m_view_topmost),t}return __extends(e,i),e.prototype.get_view=function(i){var e=null;switch(i){case t.WIDGET_LAYER.SCENE:e=this.m_view_scene;break;case t.WIDGET_LAYER.BACKGROUND:e=this.m_view_bk;break;case t.WIDGET_LAYER.BOTTOM:e=this.m_view_bottom;break;case t.WIDGET_LAYER.NORMAL:e=this.m_view_normal;break;case t.WIDGET_LAYER.TIPS:e=this.m_view_tips;break;case t.WIDGET_LAYER.POPUP:e=this.m_view_popup;break;case t.WIDGET_LAYER.TOP:e=this.m_view_top;break;case t.WIDGET_LAYER.TOPMOST:e=this.m_view_topmost;break;default:e=this.m_view_normal}return e},e.prototype.dispose=function(){this.removeChildren(),this.m_view_scene.removeChildren(),this.m_view_bk.removeChildren(),this.m_view_bottom.removeChildren(),this.m_view_normal.removeChildren(),this.m_view_top.removeChildren(),this.m_view_scene=null,this.m_view_bk=null,this.m_view_bottom=null,this.m_view_normal=null,this.m_view_popup=null,this.m_view_tips=null,this.m_view_top=null,this.m_view_topmost=null},e}(laya.display.Sprite);t.game_widget_view=i}(utils||(utils={}));var utils;__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(_,r){var n=i.call(this)||this;return n.m_res_path=null,n.m_extra_res_list=new Array,n.m_ui_cls=null,n.m_ui=null,n.m_b_loaded=!1,n.m_b_loading=!1,n.m_b_show=!1,n.m_b_disposed=!1,n.m_layer=t.WIDGET_LAYER.NORMAL,n.m_id=0,n.m_widget_name="unknown_widget",n.m_ud=null,n.m_res_path=_,n.m_ui_cls=r,e.m_start_id+=1,n.m_id=e.m_start_id,n}return __extends(e,i),e.prototype.append_extrares=function(t,i){this.m_extra_res_list.push({url:t,type:i})},e.prototype.move_center=function(){this.m_ui.x=Laya.stage.width-this.m_ui.width>>1,this.m_ui.y=Laya.stage.height-this.m_ui.height>>1},e.prototype.register_event=function(i,e){t.event_ins().register_event(i,this),this.register_event_func(i,e)},e.prototype.unregister_event=function(i){t.event_ins().unregister_event(i,this),this.unregister_event_func(i)},e.prototype.unregister_allevent=function(){t.event_ins().unregister_allevent(this),this.unregister_all_event_func()},e.prototype.fire_event=function(i,e){void 0===e&&(e=null),t.event_ins().fire_event(i,e)},e.prototype.fire_event_next_frame=function(i,e){void 0===e&&(e=null),t.event_ins().fire_event_next_frame(i,e)},e.prototype.register_btn_click=function(t,i){var e=this.get_con(t);null!=e&&e.on(Laya.Event.CLICK,this,i)},e.prototype.unregister_btn_click=function(t,i){var e=this.get_con(t);null!=e&&e.off(Laya.Event.CLICK,this,i)},e.prototype._get_con=function(t,i){for(var e=0;e<t.numChildren;++e){var _=t.getChildAt(e);if(_.name==i)return _;if(null!=(_=this._get_con(_,i)))return _}return null},e.prototype.get_con=function(t){return this.m_b_loaded?this._get_con(this.m_ui,t):null},e.prototype.load=function(){for(var i=!1,_=0,r=this.m_extra_res_list;_<r.length;_++){var n=r[_];0==e.s_loaded_dict.hasOwnProperty(n.url)&&(core.ui_tiplog("game_widget load need download ",n.url),i=!0)}i&&t.widget_ins().start_load(this),this.m_b_loading=!0,Laya.loader.on(Laya.Event.ERROR,this,this.on_load_error),core.res_tiplog("game_widget load res ",this.m_extra_res_list),core.myload(this.m_extra_res_list,laya.utils.Handler.create(this,this.on_load_complete),null,null,0)},e.prototype.init_uiins=function(){this.m_ui=new this.m_ui_cls,this.on_init(),this.m_b_show&&(this.m_b_show=!1,this.show(!0))},e.prototype.on_load_complete=function(){if(!this.m_b_disposed)if(0!=this.m_b_loading){t.widget_ins().end_load(this);for(var i=0,_=this.m_extra_res_list;i<_.length;i++){var r=_[i];null!=Laya.loader.getRes(r.url)&&(e.s_loaded_dict[r.url]=!0)}this.m_b_loading=!1,Laya.loader.off(Laya.Event.ERROR,this,this.on_load_error),null!=Laya.loader.getRes(this.m_res_path)?(this.m_b_loaded=!0,this.init_uiins()):core.res_errlog("game_widget on_load_complete getRes(this.m_res_path) == null ",this.m_res_path)}else core.res_errlog("game_widget on_load_complete this.m_b_loading = false")},e.prototype.on_load_error=function(t){core.res_errlog("game_widget on_load_error ",t)},e.prototype.on_init=function(){},e.prototype.on_show=function(t){},e.prototype.on_dispose=function(){},e.prototype.show=function(i){if(this.m_b_show!=i)if(this.m_b_show=i,0!=this.m_b_loaded){this.m_b_show?t.widget_ins().get_view(this.m_layer).addChild(this.m_ui):this.m_ui.removeSelf(),this.on_show(this.m_b_show),this.m_b_show?t.event_ins().fire_event(game_event.EVENT_WIDGET_ONSHOW,this):t.event_ins().fire_event(game_event.EVENT_WIDGET_ONHIDE,this),this.m_b_show||t.widget_ins().call_widget_hide(this)}else{if(!this.m_b_show)return void core.core_tiplog("game_widget do not load when it is hiden");if(null==this.m_res_path||this.m_res_path.length<=0)return void core.core_tiplog("game_widget load error,invalided res path! ");if(null==this.m_ui_cls)return void core.core_tiplog("game_widget load error,invalided ui cls! ");if(this.m_b_loading)return void core.core_tiplog("game_widget loading,return");this.m_extra_res_list.push({url:this.m_res_path,type:Laya.Loader.ATLAS});for(var _=0,r=this.m_extra_res_list;_<r.length;_++){var n=r[_];e.s_res_dict.hasOwnProperty(n.url)?e.s_res_dict[n.url]+=1:e.s_res_dict[n.url]=1}this.load()}},e.prototype.dispose=function(){if(!this.m_b_disposed){if(this.unregister_allevent(),this.on_dispose(),null!=this.m_ui&&(this.m_ui.removeSelf(),this.m_ui.destroy(),this.m_ui=null),this.m_b_loaded)for(var i=0,_=this.m_extra_res_list;i<_.length;i++){var r=_[i];e.s_res_dict.hasOwnProperty(r.url)&&(e.s_res_dict[r.url]-=1,e.s_res_dict[r.url]<=0&&(core.res_tiplog("widget dispose release res ",e.s_res_dict[r.url],r.url),Laya.loader.clearTextureRes(r.url),delete e.s_res_dict[r.url]))}this.m_b_loading&&(t.widget_ins().end_load(this),Laya.loader.off(Laya.Event.ERROR,this,this.on_load_error)),this.m_b_loading=!1,this.m_extra_res_list=null,this.m_ui_cls=null,this.m_res_path=null,this.m_b_loaded=!1,this.m_b_disposed=!0,this.m_b_show=!1}},e.m_start_id=0,e.s_res_dict=new Object,e.s_loaded_dict=new Object,e}(t.game_event_receiver);t.game_widget=i}(utils||(utils={})),function(t){var i=function(){function t(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=null),this.m_value=0,this.m_user_data=null,this.m_user_id=0,this.m_value=t,this.m_user_id=i,null==e&&(e=new Object),this.m_user_data=e}return t.prototype.init=function(t,i,e){this.m_value=t,this.m_user_id=i,null==e&&(e=new Object),this.m_user_data=e},t}();t.heap_node=i;var e=function(){function e(){this.m_array=new Array}return e.prototype._get_nd=function(e,_,r){void 0===_&&(_=0),void 0===r&&(r=null);var n=t.getitembycls("heap_node",i);return n.init(e,_,r),n},e.prototype._del_nd=function(i){t.recover("heap_node",i)},e.prototype._clear_nd=function(){t.clearbysign("heap_node")},e.prototype._cmp_v=function(t,i){return t<i},e.prototype._filter_up=function(t){for(var i,e=t,_=this.m_array[e],r=_.m_value,n=_.m_user_id,s=_.m_user_data;e>0&&(i=e-1>>1,this._cmp_v(r,this.m_array[i].m_value));)this.m_array[e].m_value=this.m_array[i].m_value,this.m_array[e].m_user_id=this.m_array[i].m_user_id,this.m_array[e].m_user_data=this.m_array[i].m_user_data,this.m_array[e].m_user_data.idx=e,e=i;return this.m_array[e].m_value=r,this.m_array[e].m_user_id=n,this.m_array[e].m_user_data=s,this.m_array[e].m_user_data.idx=e,e},e.prototype._filter_down=function(t){for(var i=t,e=0,_=0,r=0,n=this.m_array.length,s=this.m_array[i],a=s.m_value,o=s.m_user_id,m=s.m_user_data;r=2+(i<<1),!((_=1+(i<<1))>=n);){if(e=r<n&&this._cmp_v(this.m_array[r].m_value,this.m_array[_].m_value)?r:_,!this._cmp_v(this.m_array[e].m_value,a))break;this.m_array[i].m_value=this.m_array[e].m_value,this.m_array[i].m_user_id=this.m_array[e].m_user_id,this.m_array[i].m_user_data=this.m_array[e].m_user_data,this.m_array[i].m_user_data.idx=i,i=e}return this.m_array[i].m_value=a,this.m_array[i].m_user_id=o,this.m_array[i].m_user_data=m,this.m_array[i].m_user_data.idx=i,i},e.prototype.push=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=null);var _=this._get_nd(t,i,e);return this.m_array.push(_),this._filter_up(this.m_array.length-1),_},e.prototype.pop=function(){if(this.m_array.length<=1)return this._del_nd(this.top()),void this.m_array.pop();var t=this.m_array[this.m_array.length-1],i=t.m_value,e=t.m_user_id,_=t.m_user_data;this.m_array[0].m_value=i,this.m_array[0].m_user_id=e,this.m_array[0].m_user_data=_,this.m_array[0].m_user_data.idx=0,this._del_nd(this.m_array[this.m_array.length-1]),this.m_array.splice(this.m_array.length-1,1),this._filter_down(0)},e.prototype.get_idx=function(t){for(var i=0;i<this.m_array.length;++i){if(this.m_array[i].m_user_id==t)return i}return-1},e.prototype.modify=function(t,i){var e=this.m_array[t];e.m_value!=i&&(this._cmp_v(e.m_value,i)?(e.m_value=i,this._filter_down(t)):(e.m_value=i,this._filter_up(t)))},e.prototype.clear=function(){for(var t=0;t<this.m_array.length;++t)this._del_nd(this.m_array[t]);this.m_array=new Array},e.prototype.top=function(){return this.m_array[0]},e.prototype.is_empty=function(){return this.m_array.length<=0},e.prototype.print_data=function(t){void 0===t&&(t=""),core.core_tiplog("smallheap begin ",t,this.m_array.length);for(var i=0,e=this.m_array;i<e.length;i++){var _=e[i];core.core_tiplog("smallheap ",t,_.m_value,_.m_user_id)}core.core_tiplog("smallheap end ",t)},e}();t.small_heap=e}(utils||(utils={})),function(t){function i(t,i,e,_){return(i-_)/(t-e)}function e(t,i,e){return i-t*e}t.get_view_wh=function(){var t={w:640,h:960};return Laya.Browser.clientWidth,Laya.Browser.clientHeight,t},t.get_render_milltm=function(){return laya.utils.Browser.now()},t.getRandom=function(t,i){return Math.round(Math.random()*(i-t)+t)},t.genangle=function(t,i){return Math.atan2(1.4142135623731*i,t)},t.gendir=function(t,i,e,_){return void 0===e&&(e=8),void 0===_&&(_=null),0==t?i>0?0:i<0?4:0:0==i?t>0?6:t<0?2:0:t>0&&i>0?7:t>0&&i<0?5:t<0&&i>0?1:t<0&&i<0?3:0},t.genafrom2point=i,t.genbfrom2point=e,t.genpointlinefrom2point=function(t,_,r,n,s,a){void 0===s&&(s=32),void 0===a&&(a=32);var o,m,h,l,c=new Array,p=Math.abs(r-t),u=Math.abs(n-_);if(0==p&&0==u)return c;var d,f,y,g=new Object;if(0==p||0==u||p==u)for(o=1,0==p?o=0:r<t&&(o=-1),m=1,0==u?m=0:n<_&&(m=-1);h=t,l=_,0==p||0==u?c.push(new laya.maths.Point(h,l)):(y=(1e5*(d=h)+(f=l)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d=h-1)+(f=l)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d=h+1)+(f=l-1)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d=h-1)+(f=l)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f)))),t!=r||_!=n;)t+=o,_+=m;else{var v=i(t*s,_*a,r*s,n*a),w=e(t*s+(s>>1),_*a+(a>>1),v);h=t*s+(s>>1),l=_*a+(a>>1);var b=r*s+(s>>1),x=n*a+(a>>1);if(o=s,m=a,r<t&&(o=0-s),n<_&&(m=0-a),y=(1e5*t+_).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(t,_))),p>u)for(;l=v*(h+=o/2)+w,h%s==0&&l%a==0?(y=(1e5*(d=Math.floor(h/s))+(f=Math.floor(l/a))).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d-=1)+(f=f)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d+=1)+(f-=1)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d-=1)+(f=f)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f)))):(y=(1e5*(d=Math.floor(h/s))+(f=Math.floor(l/a))).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d-=1)+(f=f)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f)))),(h+=o/2)!=b;);else if(p<u)for(;(h=((l+=m/2)-w)/v)%s==0&&l%a==0?(y=(1e5*(d=Math.floor(h/s))+(f=Math.floor(l/a))).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d-=1)+(f=f)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d+=1)+(f-=1)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d-=1)+(f=f)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f)))):(y=(1e5*(d=Math.floor(h/s))+(f=Math.floor(l/a))).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f))),y=(1e5*(d=d)+(f-=1)).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(d,f)))),(l+=m/2)!=x;);}return y=(1e5*r+n).toString(),0==g.hasOwnProperty(y)&&(g[y]=!0,c.push(new laya.maths.Point(r,n))),c}}(utils||(utils={})),function(t){var i=function(){function i(t,i,e){this.m_type=0,this.m_mgr=null,this.m_type=t,this.m_data=i,this.m_mgr=e}return i.prototype.do=function(){switch(this.m_mgr.clearplayernode(),this.m_type){case t.ACTION_ADDWARRIOR:this.do_addwarrior();break;case t.ACTION_INITWARRIORS:this.do_initwarrior();break;case t.ACTION_INITWARRIORHPS:this.do_initwarriorhps();break;case t.ACTION_SETWARRIORADORN:this.do_setadorn();break;case t.ACTION_CUSTOMEVENT:this.do_customevent();break;case t.ACTION_ENTER:this.do_enter();break;case t.ACTION_CHANGELINEUP:this.do_changelineup();break;case t.ACTION_SKILL:this.do_skill();break;case t.ACTION_DELWARRIOR:this.do_delwarrior();break;case t.ACTION_SETHP:this.do_sethp();break;case t.ACTION_ADDBUFF:this.do_addbuff();break;case t.ACTION_DELBUFF:this.do_delbuff();break;case t.ACTION_BUFFCD:this.do_buffcd();break;case t.ACTION_BUFFAUTOCD:this.do_buffautocd();break;case t.ACTION_PROPCHANGE:this.do_propchange()}this.m_mgr.startplayernode()},i.prototype._get_skill_unitid=function(t){return"dst"==t?this.m_data.dst_list[0]:this.m_data.id},i.prototype._pop_skill_dst=function(){this.m_data.dst_list.pop()},i.prototype._parse_skill_move=function(i,e){var _={src:this._get_skill_unitid(e.param1),dst:this._get_skill_unitid(e.param2)};this._add_node(i,t.COMBATSCENE_WARRIORMOVE2WARRIOR,_)},i.prototype._parse_skill_move2=function(i,e){var _={src:this._get_skill_unitid(e.param1),x:parseInt(e.param2),y:parseInt(e.param3)};this._add_node(i,t.COMBATSCENE_WARRIORMOVE,_)},i.prototype._is_downteam=function(t,i){return this.m_mgr.m_scene.is_downteambywid(t,i)},i.prototype._parse_skill_blacks=function(i,e){var _={tm:parseInt(e.param1)};this._add_node(i,t.COMBATSCENE_BLACKSCENE,_)},i.prototype._parse_skill_dir=function(i,e,_){var r=this._get_skill_unitid(e.param1),n=e.param2;if("self"==n)if(this._is_downteam(r,_)){var s={src:r,dir:7};this._add_node(i,t.COMBATSCENE_WARRIORDIR,s)}else{s={src:r,dir:3};this._add_node(i,t.COMBATSCENE_WARRIORDIR,s)}else if("enemy"==n)if(this._is_downteam(r,_)){s={src:r,dir:3};this._add_node(i,t.COMBATSCENE_WARRIORDIR,s)}else{s={src:r,dir:7};this._add_node(i,t.COMBATSCENE_WARRIORDIR,s)}else if("dst"==n){s={src:r,dst:this.m_data.dst_list[0]};this._add_node(i,t.COMBATSCENE_WARRIORDIR2W,s)}else if("src"==n){s={src:r,dst:this.m_data.id};this._add_node(i,t.COMBATSCENE_WARRIORDIR2W,s)}},i.prototype._parse_skill_act=function(i,e){var _={src:this._get_skill_unitid(e.param1),actionid:parseInt(e.param2)};this._add_node(i,t.COMBATSCENE_WARRIORACTION,_)},i.prototype._get_skill_atkstatus=function(t,i){for(var e=0,_=t.atkstatus_list;e<_.length;e++){var r=_[e];if(r.id==i)return r}return null},i.prototype._parse_ninjaatk=function(i,e,_){var r=this.m_data.id,n=3,s=0,a=0;this._is_downteam(r,_)?(n=3,s=this.m_mgr.m_scene.m_pos_dx,a=this.m_mgr.m_scene.m_pos_dy):(n=7,s=-this.m_mgr.m_scene.m_pos_dx,a=-this.m_mgr.m_scene.m_pos_dy);var o=this.m_mgr.m_scene.get_pos(r),m={src:r,x:0,y:0};this._add_node(i,t.COMBATSCENE_WARRIORSETPOS,m);for(var h=0,l=this.m_data.dst_list;h<l.length;h++){var c=l[h],p=c,u=1e4+c,d=this.m_mgr.m_scene.get_pos(p);d.x+3*s,d.y+3*a;var f={src:r,dst:u,x:o.x,y:o.y,dir:n};this._add_node(i,t.COMBATSCENE_ADDCLONEWARRIOR,f);var y={src:u,x:d.x+s,y:d.y+a};this._add_node(i+10,t.COMBATSCENE_WARRIORMOVE,y);var g={src:u,actionid:3};this._add_node(i+400,t.COMBATSCENE_WARRIORACTION,g)}},i.prototype._parse_clearninja=function(i,e){var _={src:this.m_data.id};this._add_node(i,t.COMBATSCENE_WARRIORREADY,_),this._add_node(i,t.COMBATSCENE_DELNINJA,1e4)},i.prototype._parse_skill_attacked=function(i,e){var _=new Array;if("dst"==e.param1)_.push(this.m_data.dst_list[0]);else for(var r=0,n=this.m_data.dst_list;r<n.length;r++){var s=n[r];_.push(s)}for(var a=this.m_data,o=0,m=_;o<m.length;o++){s=m[o];var h=this._get_skill_atkstatus(a,s);null!=h&&this._gen_propchange(s,i,h)}for(var l=0,c=a.subbuff_list;l<c.length;l++){var p={src:(f=s=c[l]).id,buffid:f.buffid,shape:f.buffshape};this._add_node(i,t.COMBATSCENE_DELBUFF,p)}for(var u=0,d=a.addbuff_list;u<d.length;u++){var f;p={src:(f=s=d[u]).id,buffid:f.buffid,shape:f.buffshape,cd:f.cd,overlay:f.overlay,datas:f.datas,buffeffid:f.buffeffid};this._add_node(i,t.COMBATSCENE_ADDBUFF,p)}},i.prototype._parse_skill_effect=function(i,e,_){var r=parseInt(e.param1),n=e.param2;if("src"==n){var s={src:this.m_data.id,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT2W,s)}else if("dst"==n){s={src:this.m_data.dst_list[0],effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT2W,s)}else if("all"==n)for(var a=0,o=this.m_data.dst_list;a<o.length;a++){s={src:o[a],effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT2W,s)}else if("center"==n){var m=this.m_mgr.m_scene.get_pos(1),h=this.m_mgr.m_scene.get_pos(21);s={x:m.x+(h.x-m.x)/2,y:m.y+(h.y-m.y)/2,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT,s)}else if("self"==n)if(this._is_downteam(this.m_data.id,_)){s={x:(m=this.m_mgr.m_scene.get_pos(1)).x,y:m.y,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT,s)}else{s={x:(m=this.m_mgr.m_scene.get_pos(21)).x,y:m.y,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT,s)}else if("enemy"==n)if(this._is_downteam(this.m_data.id,_)){s={x:(m=this.m_mgr.m_scene.get_pos(21)).x,y:m.y,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT,s)}else{s={x:(m=this.m_mgr.m_scene.get_pos(1)).x,y:m.y,effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT,s)}else{s={x:parseInt(e.param2),y:parseInt(e.param3),effectid:r};this._add_node(i,t.COMBATSCENE_EFFECT_SCREENPOS,s)}},i.prototype._parse_skill_moveback=function(i,e,_){var r=this._get_skill_unitid(e.param1),n={src:r};if(this._add_node(i,t.COMBATSCENE_WARRIORMOVEBACK,n),this._is_downteam(r,_)){var s={src:r,dir:3};this._add_node(i+500,t.COMBATSCENE_WARRIORDIR,s)}else{var a={src:r,dir:7};this._add_node(i+500,t.COMBATSCENE_WARRIORDIR,a)}},i.prototype._add_node=function(t,i,e){var _=this.m_mgr._get_player_ins(t,i,e);this.m_mgr.addplayernode(_)},i.prototype._parse_skill_end=function(i,e){this._add_node(i,t.COMBATSCENE_EMPTY,this.m_data)},i.prototype._parse_skill_action=function(t,i,e,_){switch(i){case"move":this._parse_skill_move(t,e);break;case"ninjaatk":this._parse_ninjaatk(t,e,_);break;case"clearninja":this._parse_clearninja(t,e);break;case"move2":this._parse_skill_move2(t,e);break;case"dir":this._parse_skill_dir(t,e,_);break;case"action":this._parse_skill_act(t,e);break;case"attacked":this._parse_skill_attacked(t,e);break;case"effect":this._parse_skill_effect(t,e,_);break;case"black":this._parse_skill_blacks(t,e);break;case"moveback":this._parse_skill_moveback(t,e,_);break;case"nextdst":this._pop_skill_dst();break;case"end":this._parse_skill_end(t,e)}},i.prototype._gen_propchange=function(e,_,r){if(0==r.b_dodge){var n={src:e,type:r.damagetype,damage:r.damage,crack:r.b_crack};if(this._add_node(_,t.COMBATSCENE_POPNUMBER,n),r.b_dead||r.b_fly){var s=new t.warrior_hp;s.hp=0,s.hpmax=1e3,s.id=e,this._add_node(_,t.COMBATSCENE_SETHP,s)}}if(r.b_dead){n={src:e,stopf:1};this._add_node(_,t.COMBATSCENE_WARRIORATTACKED,n),n={src:e,dst:1},this._add_node(_,t.COMBATSCENE_WARRIORBACKMOVE,n),n.effectid=106,this._add_node(_,t.COMBATSCENE_EFFECT2W,n),r.b_vanish?this._add_node(_+i.DEAD_ATTACKED_TM,t.COMBATSCENE_WARRIORDEADVANISH,n):this._add_node(_+i.DEAD_ATTACKED_TM,t.COMBATSCENE_WARRIORDEAD,n),this._add_node(_+i.DEAD_TM,t.COMBATSCENE_EMPTY,null)}else if(r.b_fly){n=null;n={src:e,dst:1},this._add_node(_,t.COMBATSCENE_WARRIORBACKMOVE,n),n={src:e,stopf:1},this._add_node(_,t.COMBATSCENE_WARRIORATTACKED,n),n.effectid=106,this._add_node(_,t.COMBATSCENE_EFFECT2W,n),this._add_node(_+i.FLY_ATTACKED_TM,t.COMBATSCENE_WARRIORFLY,n),this._add_node(_+i.FLY_TM,t.COMBATSCENE_EMPTY,null)}else if(r.b_dodge){n={src:e};this._add_node(_,t.COMBATSCENE_WARRIORDODGE,n),this._add_node(_+i.DODGE_TM,t.COMBATSCENE_WARRIORREADY,n)}else if(r.b_defend){n={src:e,stopf:0};this._add_node(_,t.COMBATSCENE_WARRIORDEFEND,n),n.effectid=102,this._add_node(_,t.COMBATSCENE_EFFECT2W,n),n={src:e,dst:1},this._add_node(_,t.COMBATSCENE_WARRIORBACKMOVE,n),this._add_node(_+i.DEFEND_TM,t.COMBATSCENE_WARRIORREADY,n)}else if(r.b_revive){n={src:e};this._add_node(_,t.COMBATSCENE_WARRIORREVIVE,n),this._add_node(_+i.REVIVE_TM,t.COMBATSCENE_EMPTY,null)}else if(r.damagetype!=t.DAMAGETYPE_HP_ADD){n={src:e,stopf:1};this._add_node(_,t.COMBATSCENE_WARRIORATTACKED,n),n.effectid=101,this._add_node(_,t.COMBATSCENE_EFFECT2W,n),this._add_node(_+i.ATTACKED_TM,t.COMBATSCENE_WARRIORREADY,n)}},i.prototype.do_propchange=function(){var t=this.m_data;this._gen_propchange(t.id,0,t)},i.prototype.do_skill=function(){var i=this.m_data,e=200;if(2==i.m_type){var _={src:i.id,content:""};this._add_node(0,t.COMBATSCENE_CRYOUT,_)}else if(3==i.m_type){_={src:i.id,content:""};this._add_node(0,t.COMBATSCENE_CRYOUT,_)}else if(0==i.m_type){_={src:i.id,content:""};e=0}else if(1==i.m_type){var r=this.m_mgr.get_skillperformcryout(i.skillid);if(null==r||null==r||r.length<=0)e=0;else{_={src:i.id,content:r};this._add_node(0,t.COMBATSCENE_CRYOUT,_)}}else e=0;var n=this.m_mgr.get_skillperformconfig(i.skillid,i.skilllv,i.m_config_id);null==n&&(n=this.m_mgr.get_skillperformconfig(10001,1,i.m_config_id));var s=n.data;core.combat_errlog("combat_action do_skill ",i.skillid,i.skilllv,s);for(var a=0,o=s;a<o.length;a++){var m=o[a];core.combat_errlog("do_skill ",m);var h=m.tm,l=m.action;this._parse_skill_action(h+e,l,m,i.self_group)}},i.prototype.do_enter=function(){this._add_node(0,t.COMBATSCENE_ENTER,this.m_data)},i.prototype.do_changelineup=function(){this._add_node(0,t.COMBATSCENE_CHANGELINEUP,this.m_data)},i.prototype.do_customevent=function(){this._add_node(0,t.COMBATSCENE_CUSTOMEVENT,this.m_data)},i.prototype.do_addwarrior=function(){this._add_node(0,t.COMBATSCENE_ADDWARRIOR,this.m_data)},i.prototype.do_initwarrior=function(){this._add_node(0,t.COMBATSCENE_INITWARRIOR,this.m_data)},i.prototype.do_setadorn=function(){this._add_node(0,t.COMBATSCENE_SETADORN,this.m_data)},i.prototype.do_delwarrior=function(){this._add_node(0,t.COMBATSCENE_DELWARRIOR,this.m_data)},i.prototype.do_sethp=function(){this._add_node(0,t.COMBATSCENE_SETHP,this.m_data)},i.prototype.do_initwarriorhps=function(){for(var i=0,e=this.m_data;i<e.length;i++){var _=e[i];this._add_node(0,t.COMBATSCENE_SETHP,_)}},i.prototype.do_addbuff=function(){var i=this.m_data,e={src:i.id,buffid:i.buffid,shape:i.buffshape,cd:i.cd,overlay:i.overlay,datas:i.datas,buffeffid:i.buffeffid};this._add_node(0,t.COMBATSCENE_ADDBUFF,e)},i.prototype.do_delbuff=function(){var i=this.m_data,e={src:i.id,buffid:i.buffid,shape:i.buffshape};this._add_node(0,t.COMBATSCENE_DELBUFF,e)},i.prototype.do_buffcd=function(){var i=this.m_data,e={src:i.id,buffid:i.buffid,cd:i.cd};this._add_node(0,t.COMBATSCENE_BUFFCD,e)},i.prototype.do_buffautocd=function(){this.m_data;this._add_node(0,t.COMBATSCENE_BUFFAUTOCD,null)},i.ATTACKED_TM=450,i.DEAD_ATTACKED_TM=500,i.DEAD_TM=400,i.FLY_ATTACKED_TM=500,i.FLY_TM=400,i.DODGE_TM=300,i.DEFEND_TM=200,i.REVIVE_TM=400,i}();t.combat_action=i}(combat||(combat={})),function(t){t.COMBATSCENE_ENTER="combatscene_enter",t.COMBATSCENE_CHANGELINEUP="combatscene_changelineup",t.COMBATSCENE_QUIT="combatscene_quit",t.COMBATSCENE_POPNUMBER="combatscene_popnumber",t.COMBATSCENE_ADDWARRIOR="combatscene_addwarrior",t.COMBATSCENE_ADDCLONEWARRIOR="combatscene_addclonewarrior",t.COMBATSCENE_INITWARRIOR="combatscene_initwarrior",t.COMBATSCENE_SETADORN="combatscene_setadorn",t.COMBATSCENE_DELWARRIOR="combatscene_delwarrior",t.COMBATSCENE_DELNINJA="combatscene_delninja",t.COMBATSCENE_ADDBUFF="combatscene_addbuff",t.COMBATSCENE_DELBUFF="combatscene_delbuff",t.COMBATSCENE_BUFFCD="combatscene_buffcd",t.COMBATSCENE_BUFFAUTOCD="combatscene_buffautocd",t.COMBATSCENE_WARRIORACTION="combatscene_warrioraction",t.COMBATSCENE_WARRIORDEAD="combatscene_warriordead",t.COMBATSCENE_WARRIORDEADVANISH="combatscene_warriordeadvanish",t.COMBATSCENE_WARRIORFLY="combatscene_warriorfly",t.COMBATSCENE_WARRIORREVIVE="combatscene_warriorrevive",t.COMBATSCENE_WARRIORDODGE="combatscene_warriordodge",t.COMBATSCENE_WARRIORDEFEND="combatscene_warriordefend",t.COMBATSCENE_WARRIORATTACKED="combatscene_warriorattacked",t.COMBATSCENE_WARRIORBACKMOVE="combatscene_warriorbackmove",t.COMBATSCENE_WARRIORMOVE="combatscene_warriormove",t.COMBATSCENE_WARRIORSETPOS="combatscene_warriorsetpos",t.COMBATSCENE_WARRIORMOVEBACK="combatscene_warriormoveback",t.COMBATSCENE_WARRIORMOVE2WARRIOR="combatscene_warriormove2warrior",t.COMBATSCENE_WARRIORDIR="combatscene_warriordir",t.COMBATSCENE_WARRIORDIR2W="combatscene_warriordir2w",t.COMBATSCENE_EFFECT="combatscene_effect",t.COMBATSCENE_EFFECT_SCREENPOS="combatscene_effect_screenpos",t.COMBATSCENE_EFFECT2W="combatscene_effect2w",t.COMBATSCENE_WARRIORREADY="combatscene_warriorready",t.COMBATSCENE_ACTIONBEGIN="combatscene_actionbegin",t.COMBATSCENE_ACTIONEND="combatscene_actionend",t.COMBATSCENE_EMPTY="combatscene_empty",t.COMBATSCENE_SETHP="combatscene_sethp",t.COMBATSCENE_CRYOUT="combatscene_cryout",t.COMBATSCENE_BLACKSCENE="combatscene_blackscene",t.COMBATSCENE_CUSTOMEVENT="combatscene_customevent",t.ACTION_INVALID=0,t.ACTION_ADDWARRIOR=1,t.ACTION_DELWARRIOR=2,t.ACTION_SKILL=3,t.ACTION_ADDBUFF=4,t.ACTION_DELBUFF=5,t.ACTION_BUFFCD=6,t.ACTION_BUFFAUTOCD=7,t.ACTION_PROPCHANGE=8,t.ACTION_END=9,t.ACTION_ENTER=10,t.ACTION_SETHP=11,t.ACTION_SETWARRIORADORN=12,t.ACTION_CUSTOMEVENT=13,t.ACTION_INITWARRIORS=14,t.ACTION_INITWARRIORHPS=15,t.ACTION_CHANGELINEUP=16,t.DAMAGETYPE_HP_SUB=0,t.DAMAGETYPE_HP_ADD=1,t.DAMAGETYPE_CRACK=6,t.DAMAGETYPE_DODGE=2,t.DAMAGETYPE_SHAKE=3,t.DAMAGETYPE_COUNTERATK=4,t.DAMAGETYPE_CRYOUT=5}(combat||(combat={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(i){function e(){var e=i.call(this)||this;return e.m_value=0,e.m_root="combat_num/",e.m_prex="damage_",e.m_w=0,e.m_h=0,e.m_type=t.DAMAGETYPE_HP_SUB,e.m_text=null,e}return __extends(e,i),e.prototype.re_init=function(i){this.m_type=i,this.m_type==t.DAMAGETYPE_HP_ADD?this.m_prex="heal_":this.m_type==t.DAMAGETYPE_CRACK?this.m_prex="countdown_":this.m_prex="damage_"},e.prototype.set_content=function(t){this.release_pic(),null==this.m_text&&(this.m_text=new Laya.Label,this.m_text.color="#0000ff",this.m_text.stroke=1,this.m_text.strokeColor="#ffffff",this.m_text.fontSize=32,this.m_text.bold=!0,this.m_text.align="center",this.m_text.size(120,40),this.addChild(this.m_text)),this.m_text.text=t,this.init_wh()},e.prototype.set_value=function(i){this.m_value=i,this.release_pic(),this.m_type==t.DAMAGETYPE_DODGE?0==this.m_value?this.loadImage(this.m_root+"damage_shan.png"):this.loadImage(this.m_root+"damage_bi.png"):this.m_type==t.DAMAGETYPE_SHAKE?(null==this.m_text&&(this.m_text=new Laya.Label,this.m_text.color="#0000ff",this.m_text.stroke=1,this.m_text.strokeColor="#ffffff",this.m_text.fontSize=32,this.m_text.bold=!0,this.m_text.align="center",this.m_text.size(120,40),this.addChild(this.m_text)),this.m_text.text=""):this.m_type==t.DAMAGETYPE_COUNTERATK?(null==this.m_text&&(this.m_text=new Laya.Label,this.m_text.color="#0000ff",this.m_text.stroke=1,this.m_text.strokeColor="#ffffff",this.m_text.fontSize=32,this.m_text.bold=!0,this.m_text.align="center",this.m_text.size(120,40),this.addChild(this.m_text)),this.m_text.text=""):this.loadImage(this.m_root+this.m_prex+i.toString()+".png"),this.init_wh()},e.prototype._init_cryout_wh=function(){this.m_w=120,this.m_h=40},e.prototype._init_counteratk_wh=function(){this.m_w=120,this.m_h=40},e.prototype._init_shake_wh=function(){this.m_w=120,this.m_h=40},e.prototype._init_dodge_wh=function(){this.m_w=32,this.m_h=32},e.prototype._init_sub_wh=function(){switch(this.m_w=16,this.m_h=16,this.m_value){case 0:this.m_w=34,this.m_h=34;break;case 1:this.m_w=22,this.m_h=33;break;case 2:case 3:this.m_w=32,this.m_h=34;break;case 4:case 5:this.m_w=34,this.m_h=34;break;case 6:this.m_w=32,this.m_h=34;break;case 7:this.m_w=34,this.m_h=36;break;case 8:case 9:this.m_w=32,this.m_h=34}},e.prototype.init_add_wh=function(){switch(this.m_w=16,this.m_h=16,this.m_value){case 0:this.m_w=34,this.m_h=31;break;case 1:this.m_w=18,this.m_h=31;break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:this.m_w=34,this.m_h=31}},e.prototype._init_countdown_wh=function(){switch(this.m_w=16,this.m_h=16,this.m_value){case 0:this.m_w=48,this.m_h=47;break;case 1:this.m_w=32,this.m_h=47;break;case 2:case 3:case 4:this.m_w=48,this.m_h=47;break;case 5:this.m_w=50,this.m_h=47;break;case 6:this.m_w=48,this.m_h=47;break;case 7:this.m_w=50,this.m_h=47;break;case 8:this.m_w=48,this.m_h=47;break;case 9:this.m_w=50,this.m_h=47}this.m_w-=2},e.prototype._init_crack_wh=function(){switch(this.m_w=16,this.m_h=16,this.m_value){case 0:this.m_w=32,this.m_h=30;break;case 1:this.m_w=20,this.m_h=30;break;case 2:case 3:this.m_w=32,this.m_h=30;break;case 4:this.m_w=30,this.m_h=30;break;case 5:case 6:case 7:case 8:case 9:this.m_w=32,this.m_h=30}},e.prototype.init_wh=function(){this.m_type==t.DAMAGETYPE_HP_ADD?this.init_add_wh():this.m_type==t.DAMAGETYPE_HP_SUB?this._init_sub_wh():this.m_type==t.DAMAGETYPE_DODGE?this._init_dodge_wh():this.m_type==t.DAMAGETYPE_SHAKE?this._init_shake_wh():this.m_type==t.DAMAGETYPE_CRYOUT?this._init_cryout_wh():this.m_type==t.DAMAGETYPE_COUNTERATK?this._init_counteratk_wh():this.m_type==t.DAMAGETYPE_CRACK&&this._init_countdown_wh()},e.prototype.release_pic=function(){this.removeChildren(),null!=this.m_text&&(this.m_text=null),this.graphics.clear()},e.prototype.dispose=function(){this.release_pic()},e}(laya.display.Sprite);t.combat_number_sp=i;var e=function(e){function _(){var t=e.call(this)||this;return t.m_value=0,t.m_type=0,t.m_life=0,t.m_obj_id=0,t.m_text="",t.m_sp_list=new Array,t}return __extends(_,e),_.prototype.re_init=function(t,i,e){void 0===e&&(e=""),this.m_value=t,this.m_type=i,this.m_sp_list.length=0,this.m_text=e},_.prototype.release_allsp=function(){this.removeChildren();for(var t=0,i=this.m_sp_list;t<i.length;t++){var e=i[t];laya.utils.Tween.clearAll(e),this._del_sp(e)}this.m_sp_list=new Array},_.prototype._get_sp=function(t){var e=utils.getitembycls("combat_number_sp",i);return e.re_init(t),e},_.prototype._del_sp=function(t){t.dispose(),utils.recover("combat_number_sp",t)},_.prototype.start=function(){this.release_allsp();var i=0,e=0,_=0;if(this.m_type==t.DAMAGETYPE_DODGE){(n=this._get_sp(this.m_type)).set_value(0),this.m_sp_list.push(n),n.x=0,n.y=150,this.addChild(n),laya.utils.Tween.to(n,{y:50},300,laya.utils.Ease.elasticOut,null,0);var r=this._get_sp(this.m_type);r.set_value(1),this.m_sp_list.push(r),r.x=n.m_w,r.y=150,this.addChild(r),laya.utils.Tween.to(r,{y:50},300,laya.utils.Ease.elasticOut,null,0),this.m_w=n.m_w+r.m_w,this.m_h=200,this.m_life=500}else if(this.m_type==t.DAMAGETYPE_SHAKE||this.m_type==t.DAMAGETYPE_COUNTERATK){(n=this._get_sp(this.m_type)).set_value(0),this.m_sp_list.push(n),n.x=0,n.y=0,this.addChild(n),laya.utils.Tween.from(n,{y:-160},300,laya.utils.Ease.elasticOut,null,0),this.m_w=n.m_w,this.m_h=200,this.m_life=500}else if(this.m_type==t.DAMAGETYPE_CRYOUT){var n;(n=this._get_sp(this.m_type)).set_content(this.m_text),this.m_sp_list.push(n),n.x=0,n.y=0,this.addChild(n),laya.utils.Tween.to(n,{y:-50},500,laya.utils.Ease.elasticOut,null,0),this.m_w=n.m_w,this.m_h=200,this.m_life=700}else{for(var s=0,a=this.m_value.toString();s<a.length;s++){var o=a[s],m=this._get_sp(this.m_type);m.set_value(parseInt(o)),this.m_sp_list.push(m),m.x=i,m.y=0,this.addChild(m),laya.utils.Tween.from(m,{y:-50},300,laya.utils.Ease.elasticOut,null,50*e),e+=1,i+=m.m_w}this.m_life=50*(e-1)+300,_=i,this.m_w=_,this.m_h=200}this.y=-100,this.x=0-this.m_w/2},_.prototype.tick=function(t){this.m_life-=t},_.prototype.is_end=function(){return this.m_life<=0},_.prototype.dispose=function(){this.release_allsp(),utils.recover("combat_number",this)},_.prototype.selfremove=function(){},_}(core.renderspcontent);t.combat_number=e;var _=function(t){function i(){var i=t.call(this)||this;return i.m_graphic=null,i.m_life=0,i.m_obj_id=0,i.m_text=null,i.m_framecurrent=0,i.m_framemillsec=0,i.m_frametotalmillsec=0,i.m_framecurrenttm=0,i.m_graphic=new laya.display.Animation,i.m_text=new Laya.Label,i.m_text.color="#ffffff",i.m_text.stroke=1,i.m_text.strokeColor="#1794f9",i.m_text.fontSize=24,i.m_text.align="center",i.m_text.font="h5font",i.m_text.x=-40,i.m_text.y=-10,i.m_text.size(120,40),i.addChild(i.m_graphic),i.addChild(i.m_text),i}return __extends(i,t),i.prototype.re_init=function(t){void 0===t&&(t=""),this.m_text.text=t,this.m_graphic.visible=!1,this.m_text.visible=!1},i.prototype.start=function(){this.m_text.visible=!0,this.m_graphic.visible=!0,this.m_graphic.loadAnimation("game_ani/combat/cryout.ani"),this.m_graphic.stop(),this.m_graphic.play(0,!1,"ani1"),this.m_graphic.gotoAndStop(0),this.m_life=1500,this.y=-150,this.x=-20,this.m_framecount=5,this.m_framespeed=10,this.m_framecurrenttm=0,this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed},i.prototype.tick=function(t){this.m_life-=t,this.m_framecurrenttm+=t;var i=Math.floor(this.m_framecurrenttm/this.m_framemillsec);this.m_framecurrent=i%this.m_framecount,this.m_framecurrenttm>=this.m_frametotalmillsec&&(this.m_framecurrent=this.m_framecount-1),this.m_graphic.gotoAndStop(this.m_framecurrent)},i.prototype.is_end=function(){return this.m_life<=0},i.prototype.dispose=function(){utils.recover("combat_cryout",this)},i.prototype.selfremove=function(){},i}(core.renderspcontent);t.combat_cryout=_;var r=function(t){function i(){var i=t.call(this)||this;return i.m_graphic=null,i.m_framecurrent=0,i.m_framemillsec=0,i.m_frametotalmillsec=0,i.m_framecurrenttm=0,i.m_graphic=new laya.display.Animation,i.addChild(i.m_graphic),i}return __extends(i,t),i.prototype.re_init=function(i,e,_){void 0===_&&(_=""),t.prototype.re_init.call(this,i,e,_),this.m_graphic.visible=!1,this.m_graphic.scale(2,2)},i.prototype.start=function(){this.release_allsp(),this.addChild(this.m_graphic);for(var t=0,i=0,e=0,_=this.m_value.toString();e<_.length;e++){var r=_[e],n=this._get_sp(this.m_type);n.set_value(parseInt(r)),this.m_sp_list.push(n),n.x=t,n.y=0,this.addChild(n),1,t+=n.m_w,i+=n.m_w}this.m_graphic.visible=!0,this.m_graphic.loadAnimation("game_ani/combat/crack.ani"),this.m_graphic.stop(),this.m_graphic.play(0,!1,"ani1"),this.m_graphic.gotoAndStop(0),this.m_framecount=11,this.m_framespeed=20,this.m_framemillsec=1e3/this.m_framespeed,this.m_frametotalmillsec=1e3*this.m_framecount/this.m_framespeed,this.m_life=800,this.m_w=i,this.m_h=200,this.y=-100,this.x=0-this.m_w/2,this.m_graphic.x=this.m_w/2,this.m_graphic.y=20,this.m_framecurrenttm=0},i.prototype.tick=function(t){this.m_life-=t,this.m_framecurrenttm+=t;var i=Math.floor(this.m_framecurrenttm/this.m_framemillsec);if(this.m_framecurrent=i%this.m_framecount,this.m_framecurrenttm>=this.m_frametotalmillsec)return this.m_framecurrent=this.m_framecount-1,void(this.m_graphic.visible=!1);this.m_graphic.gotoAndStop(this.m_framecurrent)},i.prototype.is_end=function(){return this.m_life<=0},i.prototype.dispose=function(){this.release_allsp(),utils.recover("combat_crack",this)},i.prototype.selfremove=function(){},i}(e);t.combat_crack=r;var n=function(t){function i(){var i=t.call(this)||this;return i.m_graphic=null,i.m_obj_id=0,i.m_graphic=new Laya.Sprite,i.addChild(i.m_graphic),i}return __extends(i,t),i.prototype.re_init=function(){this.m_obj_id=0,this.m_graphic.x=0,this.m_graphic.y=0,this.m_graphic.graphics.clear()},i.prototype.set_respath=function(t,i,e){this.m_graphic.graphics.loadImage(t),this.m_graphic.x=i,this.m_graphic.y=e},i.prototype.dispose=function(){utils.recover("combat_lineup",this)},i.prototype.selfremove=function(){},i}(core.renderspcontent);t.combat_lineup=n}(combat||(combat={})),function(t){function i(t,i){return t.m_sortnum-i.m_sortnum}var e=function(){function t(t,i,e,_){this.m_tm=0,this.m_idx=0,this.m_sortnum=0,this.m_event="",this.m_ud=null,this.m_tm=t,this.m_event=i,this.m_ud=e,this.m_mgr=_}return t.prototype.set_idx=function(t){this.m_idx=t,this.m_sortnum=this.m_tm+1*this.m_idx/100},t.prototype.do=function(t){return!(t<this.m_tm)&&(this.m_mgr.fire_event(this.m_event,this.m_ud),!0)},t}();t.combat_playernode=e;var _=function(){function t(){this.m_arr=new Array,this.m_b_end=!1,this.m_cur_tm=0,this.m_cur_idx=0,this.m_max_idx=0}return t.prototype.addnode=function(t){t.set_idx(this.m_arr.length),this.m_arr.push(t)},t.prototype.start=function(){this.m_arr.sort(i),this.m_cur_tm=0,this.m_cur_idx=0,this.m_max_idx=this.m_arr.length,this.m_b_end=!1},t.prototype.clear=function(){this.m_arr=new Array,this.m_b_end=!0},t.prototype.is_end=function(){return this.m_b_end},t.prototype.update=function(t){if(!this.is_end()){this.m_cur_tm=this.m_cur_tm+t;for(var i=this.m_cur_idx;i<this.m_max_idx;++i){if(0==this.m_arr[i].do(this.m_cur_tm))return void(this.m_cur_idx=i)}this.m_b_end=!0}},t}();t.combat_player=_}(combat||(combat={}));__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(){function t(){this.id=0,this.roleid=0,this.pos=0,this.shape=0,this.group=0,this.cls=0,this.lv=0,this.scale=1,this.name="undefine",this.b_dead=!1,this.desc=null,this.m_desc=new Array;for(var t=0;t<10;++t)this.m_desc.push(0)}return t.prototype.clone_data=function(t){if(t.id=this.id,t.roleid=this.roleid,t.pos=this.pos,t.shape=this.shape,t.group=this.group,t.cls=this.cls,t.lv=this.lv,t.scale=this.scale,t.name=this.name,t.b_dead=this.b_dead,null!=this.desc)for(t.desc=new Laya.Byte,this.desc.pos=0;this.desc.bytesAvailable>0;)t.desc.writeByte(this.desc.getByte());if(this.m_desc.length>0)for(var i=0;i<this.m_desc.length;++i)t.m_desc.push(this.m_desc[i])},t}();t.warrior=i;var e=function(){return function(){this.id=0,this.hp=0,this.hpmax=0,this.mp=0,this.mpmax=0}}();t.warrior_hp=e;var _=function(){return function(){this.damagetype=0,this.b_crack=!1,this.b_dead=!1,this.b_vanish=!1,this.b_fly=!1,this.b_revive=!1,this.b_defend=!1,this.b_dodge=!1}}();t.atk_status=_;var r=function(){return function(){this.datas=new Array}}();t.buff_status=r;var n=function(){return function(){this.self_group=0,this.dst_list=new Array,this.atkstatus_list=new Array,this.addbuff_list=new Array,this.subbuff_list=new Array,this.m_config_id=1}}();t.skillatk=n;var s=function(){function t(t){this.m_num=0,this.m_action_list=new Array,this.m_action_idx=0,this.m_add_list=new Array,this.m_sethp_list=new Array,this.m_num=t}return t.prototype.is_end=function(){return this.m_action_idx>=this.m_action_list.length},t.prototype.do=function(){0==this.is_end()&&(this.m_action_list[this.m_action_idx].do(),this.m_action_idx+=1)},t.prototype.dispose=function(){},t}();t.combat_turn=s;var a=function(a){function o(i){var e=a.call(this)||this;return e.m_scene=null,e.m_turn_list=new Array,e.m_turn_idx=0,e.m_cur_turn=null,e.m_player=new t.combat_player,e.m_b_end=!0,e.m_skillperform_config=null,e.m_skill_config=null,e.m_skill_configmap=new Object,e.m_skillperform_cache=new Object,e.m_scene=new t.combatscene(e,i),e}return __extends(o,a),o.prototype.set_tm=function(i,e){switch(i){case 0:t.combat_action.ATTACKED_TM=e;break;case 1:t.combat_action.DEAD_ATTACKED_TM=e;break;case 2:t.combat_action.DEAD_TM=e;break;case 3:t.combat_action.FLY_ATTACKED_TM=e;break;case 4:t.combat_action.FLY_TM=e;break;case 5:t.combat_action.DODGE_TM=e;break;case 6:t.combat_action.DEFEND_TM=e;break;case 7:t.combat_action.REVIVE_TM=e}},o.prototype.get_skillperformcryout=function(t){var i=this.m_skillperform_config(t);return null==i||null==i?""+t.toString():i.cryout},o.prototype.parse_skillcfg_by_s=function(t,i){var e=new Object;e.id=t,e.data=[];for(var _=0,r=i.split("\r\n");_<r.length;_++){var n=r[_].split(",");if(n.length>1){var s=parseInt(n[0]),a=n[1],o=new Object;o.tm=s,o.action=a;for(var m=1,h=2;h<n.length;++h){var l=n[h];o["param"+m.toString()]=l,m+=1}e.data.push(o)}}return e},o.prototype.set_skillperformcfg_cache=function(t,i){this.m_skillperform_cache[t]=i},o.prototype.get_skillperformcfg_cache_frompack=function(t){if(null!=this.m_skillperform_cache[t])return this.m_skillperform_cache[t];var i="/"+t.toString()+".txt",e=core.filepack_ins().get_file_len("skillperform",i);if(e>0){var _=core.filepack_ins().get_file("skillperform",i).getUTFBytes(e),r=this.parse_skillcfg_by_s(t,_);this.set_skillperformcfg_cache(t,r)}return this.m_skillperform_cache[t]},o.prototype.get_skillperformcfg=function(t){var i=this.get_skillperformcfg_cache_frompack(t);return null!=i&&null!=i||(i=this.m_skill_config(t)),null==i&&(i=this.m_skill_config(1)),i},o.prototype.get_skillperformconfig=function(t,i,e){var _=1e4*t+10*i+e;if(null==this.m_skill_configmap[_]){var r=this.m_skillperform_config(t);if(null==r||null==r)return core.combat_errlog("get skillperform config error! ",t,i),null;for(var n=null,s=0,a=r.data;s<a.length;s++){var o=a[s];if(o.skilllv==i){n=o;break}}null==n&&(n=r.data[0]),1==e?null!=n.config1?this.m_skill_configmap[_]=this.get_skillperformcfg(n.config1):null!=n.config2?this.m_skill_configmap[_]=this.get_skillperformcfg(n.config2):this.m_skill_configmap[_]=this.get_skillperformcfg(1):null!=n.config2?this.m_skill_configmap[_]=this.get_skillperformcfg(n.config2):null!=n.config1?this.m_skill_configmap[_]=this.get_skillperformcfg(n.config1):this.m_skill_configmap[_]=this.get_skillperformcfg(1)}return this.m_skill_configmap[_]},o.prototype.set_skill_config=function(t){this.m_skill_config=t},o.prototype.set_skillperform_config=function(t){this.m_skillperform_config=t},o.prototype.addplayernode=function(t){this.m_player.addnode(t)},o.prototype.clearplayernode=function(){for(var t=0,i=this.m_player.m_arr;t<i.length;t++){var e=i[t];this._del_player_ins(e)}this.m_player.clear()},o.prototype.startplayernode=function(){this.m_player.start()},o.prototype.isplayerend=function(){return this.m_player.is_end()},o.prototype.isturnend=function(){return!(this.m_turn_idx<this.m_turn_list.length)},o.prototype._get_turn_ins=function(t){return new s(t)},o.prototype._del_turn_ins=function(t){},o.prototype._get_action_ins=function(i,e){return new t.combat_action(i,e,this)},o.prototype._del_action_ins=function(t){},o.prototype._get_player_ins=function(i,e,_){return new t.combat_playernode(i,e,_,this)},o.prototype._del_player_ins=function(t){},o.prototype.get_warrior_ins=function(){return new i},o.prototype.del_warrior_ins=function(t){},o.prototype.get_skillatk_ins=function(){return new n},o.prototype.del_skillatk_ins=function(t){},o.prototype.get_atkstatus_ins=function(){return new _},o.prototype.del_atkstatus_ins=function(t){},o.prototype.get_buffstatus_ins=function(){return new r},o.prototype.del_buffstatus_ins=function(t){},o.prototype.get_warriorhp_ins=function(){return new e},o.prototype.del_warriorhp_ins=function(t){},o.prototype.start=function(i,e,_,r,n,s,a){void 0===i&&(i=null),void 0===e&&(e=0),void 0===_&&(_=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=null),core.combat_errlog("combat start");for(var o=0,m=this.m_turn_list;o<m.length;o++){for(var h=m[o],l=0,c=h.m_action_list;l<c.length;l++){var p=c[l];this._del_action_ins(p)}this._del_turn_ins(h)}this.m_turn_list=new Array,this.m_turn_idx=0,this.m_cur_turn=null,this.m_b_end=!1,this.m_scene.start();var u=this._get_turn_ins(-1);u.m_action_list.push(this._get_action_ins(t.ACTION_ENTER,[i,e,_,r,n,s,a])),this.m_turn_list.push(u)},o.prototype.end=function(){core.combat_errlog("combat end"),this.m_b_end=!0;for(var t=0,i=this.m_turn_list;t<i.length;t++){for(var e=i[t],_=0,r=e.m_action_list;_<r.length;_++){var n=r[_];this._del_action_ins(n)}this._del_turn_ins(e)}this.m_turn_list=new Array,this.m_turn_idx=0,this.m_cur_turn=null,this.m_scene.clear(),this.m_player.clear()},o.prototype.combatend=function(){var i=this._get_turn_ins(-1);i.m_action_list.push(this._get_action_ins(t.ACTION_END,null)),this.m_turn_list.push(i)},o.prototype.addwarrior=function(i){0==this.m_cur_turn.m_num?this.m_cur_turn.m_add_list.push(i):this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_ADDWARRIOR,i))},o.prototype.change_lineup=function(i,e,_){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_CHANGELINEUP,[i,e,_]))},o.prototype.changeweapon=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,1,e]))},o.prototype.changewing=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,2,e]))},o.prototype.changeride=function(i,e,_,r){void 0===r&&(r=30),this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,3,[e,_,r]]))},o.prototype.changehair=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,4,e]))},o.prototype.changeshape=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,0,e]))},o.prototype.changeaurn=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,5,e]))},o.prototype.changetitle=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,6,e]))},o.prototype.changefairy=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETWARRIORADORN,[i,7,e]))},o.prototype.attack=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SKILL,i))},o.prototype.send_event=function(i,e){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_CUSTOMEVENT,[i,e]))},o.prototype.delwarrior=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_DELWARRIOR,i))},o.prototype.addbuff=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_ADDBUFF,i))},o.prototype.delbuff=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_DELBUFF,i))},o.prototype.buffcd=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_BUFFCD,i))},o.prototype.buffautocd=function(){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_BUFFAUTOCD,null))},o.prototype.propchange=function(i){this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_PROPCHANGE,i))},o.prototype.set_warrior_hp=function(i){0==this.m_cur_turn.m_num?this.m_cur_turn.m_sethp_list.push(i):this.m_cur_turn.m_action_list.push(this._get_action_ins(t.ACTION_SETHP,i))},o.prototype.turnstart=function(i){null!=this.m_cur_turn&&(this.m_cur_turn.m_sethp_list.length>0&&this.m_cur_turn.m_action_list.unshift(this._get_action_ins(t.ACTION_INITWARRIORHPS,this.m_cur_turn.m_sethp_list.concat([]))),this.m_cur_turn.m_add_list.length>0&&this.m_cur_turn.m_action_list.unshift(this._get_action_ins(t.ACTION_INITWARRIORS,this.m_cur_turn.m_add_list.concat([]))),this.m_turn_list.push(this.m_cur_turn)),this.m_cur_turn=this._get_turn_ins(i)},o.prototype.turnend=function(){null!=this.m_cur_turn&&(this.m_cur_turn.m_sethp_list.length>0&&this.m_cur_turn.m_action_list.unshift(this._get_action_ins(t.ACTION_INITWARRIORHPS,this.m_cur_turn.m_sethp_list.concat([]))),this.m_cur_turn.m_add_list.length>0&&this.m_cur_turn.m_action_list.unshift(this._get_action_ins(t.ACTION_INITWARRIORS,this.m_cur_turn.m_add_list.concat([]))),this.m_turn_list.push(this.m_cur_turn)),this.m_cur_turn=null},o.prototype.update=function(t){if(!this.m_b_end){if(this.m_player.is_end()&&this.m_turn_idx<this.m_turn_list.length){var i=this.m_turn_list[this.m_turn_idx];i.is_end()?this.m_turn_idx+=1:i.do()}this.dispatch_all_delay_event(),this.m_scene.update(t),this.m_player.update(t)}},o.prototype.render=function(){this.m_scene.render()},o.prototype.dispose=function(){null!=this.m_scene&&(this.m_scene.dispose(),this.m_scene=null),a.prototype.dispose.call(this)},o}(utils.game_event_dispatcher);t.combatimpl=a}(combat||(combat={}));var combat;__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function _(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(_.prototype=e.prototype,new _)}}();!function(t){var i=function(){function t(){this.m_id=0,this.m_warrior=null,this.m_is_end=!0,this.m_start_tm=0}return t.prototype.re_init=function(){this.m_id=0,this.m_warrior=null,this.m_is_end=!0,this.m_start_tm=0},t.prototype.start=function(t){this.m_start_tm=t},t.prototype.update=function(t){},t.prototype.is_end=function(){return this.m_is_end},t.prototype.clear=function(){},t.prototype.dispose=function(){this.m_warrior=null},t}();t.combat_warrior_action=i;var e=function(t){function i(){var i=t.call(this)||this;return i.m_b_open=!0,i.m_fade_max=6,i.m_fade_tm=200,i.m_cur_fadeidx=0,i.m_cur_tm=0,i.m_fadeout=!0,i}return __extends(i,t),i.prototype.start=function(t){if(this.m_start_tm=t,this.m_b_open)return this.m_is_end=!1,this.m_fadeout=!0,this.m_cur_fadeidx=0,this.m_cur_tm=this.m_start_tm,void this.m_warrior.change_action(0);this.m_warrior.change_action(5,!1),this.m_is_end=!0},i.prototype.update=function(t){if(!this.m_is_end){if(this.m_cur_tm+=t,this.m_cur_tm>this.m_start_tm+this.m_fade_tm){if(this.m_cur_fadeidx+=1,this.m_cur_fadeidx>=this.m_fade_max)return this.m_is_end=!0,void(this.m_warrior.alpha=1);this.m_start_tm=this.m_cur_tm,this.m_fadeout=!this.m_fadeout}var i=1;(i=(this.m_cur_tm-this.m_start_tm)/this.m_fade_tm)>1&&(i=1),i<0&&(i=0),this.m_fadeout&&(i=1-i),this.m_warrior.alpha=i}},i.prototype.is_end=function(){return this.m_is_end},i.prototype.dispose=function(){null!=this.m_warrior&&(this.m_warrior.alpha=1,this.m_warrior=null),utils.recover("dead_action",this)},i}(i);t.dead_action=e;var _=function(t){function i(){var i=t.call(this)||this;return i.m_start_pt=new Laya.Point,i.m_from_pt=new Laya.Point,i.m_lt_pt=new Laya.Point,i.m_rb_pt=new Laya.Point,i.m_collision_max=2,i.m_collision_num=0,i.m_a=0,i.m_b=0,i.m_cur_tm=0,i.m_cur_rtm=0,i.m_start_rtm=0,i.m_rspeed=1800,i.m_speed=1800,i.m_bsign=1,i}return __extends(i,t),i.prototype.start=function(t){this.m_start_pt.x!=this.m_from_pt.x&&this.m_start_pt.y!=this.m_from_pt.y?(this.m_start_tm=t,this.m_cur_rtm=this.m_start_tm,this.m_start_rtm=this.m_start_tm,this.m_collision_num=this.m_collision_max,this.m_warrior.change_action(0),this.m_cur_tm=this.m_start_tm,this.m_warrior.rotation=0,this.m_is_end=!1,this._cal_param()):this.m_is_end=!0},i.prototype._cal_param=function(){this.m_a=utils.genafrom2point(this.m_from_pt.x,this.m_from_pt.y,this.m_start_pt.x,this.m_start_pt.y),this.m_b=utils.genbfrom2point(this.m_from_pt.x,this.m_from_pt.y,this.m_a),this.m_bsign=(this.m_start_pt.x-this.m_from_pt.x)/Math.abs(this.m_start_pt.x-this.m_from_pt.x)},i.prototype._rotate=function(t){this.m_cur_rtm+=t;var i=(this.m_cur_rtm-this.m_start_rtm)*this.m_rspeed/1e3;i%=360,this.m_warrior.rotation=i},i.prototype._is_out=function(t,i){return t<this.m_lt_pt.x||t>this.m_rb_pt.x||(i<this.m_lt_pt.y||i>this.m_rb_pt.y)},i.prototype._collision=function(){var t=0;if((t=this.m_bsign<0?this.m_a*this.m_lt_pt.x+this.m_b:this.m_a*this.m_rb_pt.x+this.m_b)!=this.m_lt_pt.y&&t!=this.m_rb_pt.y){if(t<this.m_lt_pt.y){this.m_start_pt.x=(this.m_lt_pt.y-this.m_b)/this.m_a,this.m_start_pt.y=this.m_lt_pt.y;var i=2*(this.m_from_pt.y-this.m_lt_pt.y);this.m_from_pt.y-=i}else if(t>this.m_rb_pt.y){this.m_start_pt.x=(this.m_rb_pt.y-this.m_b)/this.m_a,this.m_start_pt.y=this.m_rb_pt.y;i=2*(this.m_rb_pt.y-this.m_from_pt.y);this.m_from_pt.y+=i}else if(this.m_bsign<0){this.m_start_pt.x=this.m_lt_pt.x,this.m_start_pt.y=this.m_a*this.m_start_pt.x+this.m_b;i=2*(this.m_from_pt.x-this.m_lt_pt.x);this.m_from_pt.x-=i}else{this.m_start_pt.x=this.m_rb_pt.x,this.m_start_pt.y=this.m_a*this.m_start_pt.x+this.m_b;i=2*(this.m_rb_pt.x-this.m_from_pt.x);this.m_from_pt.x+=i}this._cal_param()}else this.m_collision_num=-1},i.prototype.update=function(t){if(!this.m_is_end){this._rotate(t),this.m_cur_tm+=t;var i=this.m_speed*(this.m_cur_tm-this.m_start_tm)/1e3,e=this.m_start_pt.x+i*this.m_bsign,_=this.m_a*e+this.m_b;if(this._is_out(e,_)){if(this.m_collision_num-=1,this.m_collision_num<0)return void(this.m_is_end=!0);if(this._collision(),this.m_collision_num<0)return void(this.m_is_end=!0);this.m_start_tm=this.m_cur_tm}this.m_warrior.set_pos(e,_)}},i.prototype.is_end=function(){return this.m_is_end},i.prototype.dispose=function(){null!=this.m_warrior&&(this.m_warrior.alpha=0,this.m_warrior=null),utils.recover("fly_action",this)},i}(i);t.fly_action=_;var r=function(i){function r(t,e){var _=i.call(this)||this;return _.m_combat_mgr=null,_.m_render=null,_.m_pos_map=new Object,_.m_warrior_map=new Object,_.m_mw=2560,_.m_mh=2560,_.m_map="1704.jpg",_.m_camera_x=0,_.m_camera_y=0,_.m_pos_centerx=0,_.m_pos_centerdx=40,_.m_pos_centerdy=-60,_.m_pos_centery=0,_.m_view_w=0,_.m_view_h=0,_.m_pos_dx=92,_.m_pos_dy=52,_.m_pos_c2dx=0+_.m_pos_dx,_.m_pos_c2dy=120+_.m_pos_dy,_.m_numpic_list=new Array,_.m_tempnumpic_list=new Array,_.m_cryout_list=new Array,_.m_tempcryout_list=new Array,_.m_waction_list=new Array,_.m_bk_htmlcanvas=null,_.m_bk_htmltexture=null,_.m_bk_sp=null,_.m_lineupsp=null,_.m_combat_mgr=t,_._init_event(),_.m_render=new core.renderagent,_.m_render.initstage(e),_.m_render.m_render.setworldwh(_.m_mw,_.m_mh),_.m_view_w=720,_.m_view_h=1280,_.m_render.setviewport(_.m_view_w,_.m_view_h),e.width=_.m_view_w,e.height=_.m_view_h,_.m_render.setcamerapos(_.m_camera_x,_.m_camera_y),_._init_pos_map(),e.on(Laya.Event.CLICK,_,_.onClick),_}return __extends(r,i),r.prototype._init_pos_map=function(){var t=this.m_pos_dx,i=this.m_pos_dy,e=this.m_pos_centerx,_=this.m_pos_centery;this.m_pos_map[1]=[e+this.m_pos_c2dx,_+this.m_pos_c2dy,3],this.m_pos_map[2]=[this.m_pos_map[1][0]-this.m_pos_dx,this.m_pos_map[1][1]+this.m_pos_dy,3],this.m_pos_map[3]=[this.m_pos_map[1][0]+this.m_pos_dx,this.m_pos_map[1][1]-this.m_pos_dy,3],this.m_pos_map[4]=[this.m_pos_map[2][0]-this.m_pos_dx,this.m_pos_map[2][1]+this.m_pos_dy,3],this.m_pos_map[5]=[this.m_pos_map[3][0]+this.m_pos_dx,this.m_pos_map[3][1]-this.m_pos_dy,3];for(var r=6;r<11;++r){var n=this.m_pos_map[r-5][0]-t,s=this.m_pos_map[r-5][1]-i;this.m_pos_map[r]=[n,s,3]}var a=2*this.m_pos_c2dx,o=2*this.m_pos_c2dy;for(r=21;r<26;++r){n=this.m_pos_map[r-15][0]-a,s=this.m_pos_map[r-15][1]-o;this.m_pos_map[r]=[n,s,7]}for(r=26;r<31;++r){n=this.m_pos_map[r-5][0]+t,s=this.m_pos_map[r-5][1]+i;this.m_pos_map[r]=[n,s,7]}this.m_pos_map[11]=[100,100,3],this.m_pos_map[12]=[100,100,3],this.m_pos_map[31]=[100,100,7],this.m_pos_map[32]=[100,100,7]},r.prototype.get_pos=function(t){var i=this.m_pos_map[t][0],e=this.m_pos_map[t][1];return new laya.maths.Point(i,e)},r.prototype.get_dir=function(t){return this.m_pos_map[t][2]},r.prototype.get_warrior=function(t){return null==this.m_warrior_map[t]?null:this.m_warrior_map[t]},r.prototype.get_warrior_avatar=function(t){var i=this.get_warrior(t);return null==i?null:this.m_render.getunit(i.roleid)},r.prototype.get_warrior_avatarid=function(t){var i=this.get_warrior(t);return null==i?0:i.roleid},r.prototype.onClick=function(t){var i=t.stageX,e=t.stageY;i*=.5,e*=.5;var _=new laya.maths.Point(i,e),r=this.m_render.stagepos2worldpos(_);core.combat_tiplog("combatscene onClick ",t.stageX,t.stageY,r.x,r.y)},r.prototype._init_event=function(){this.register_event(t.COMBATSCENE_ENTER,this.on_enter),this.register_event(t.COMBATSCENE_CHANGELINEUP,this.on_change_lineup),this.register_event(t.COMBATSCENE_QUIT,this.on_quit),this.register_event(t.COMBATSCENE_POPNUMBER,this.on_popnumber),this.register_event(t.COMBATSCENE_CRYOUT,this.on_cryout),this.register_event(t.COMBATSCENE_ADDWARRIOR,this.on_addwarrior),this.register_event(t.COMBATSCENE_ADDCLONEWARRIOR,this.on_addclonewarrior),this.register_event(t.COMBATSCENE_INITWARRIOR,this.on_initwarrior),this.register_event(t.COMBATSCENE_SETADORN,this.on_setadorn),this.register_event(t.COMBATSCENE_DELWARRIOR,this.on_delwarrior),this.register_event(t.COMBATSCENE_DELNINJA,this.on_delninja),this.register_event(t.COMBATSCENE_ADDBUFF,this.on_addbuff),this.register_event(t.COMBATSCENE_DELBUFF,this.on_delbuff),this.register_event(t.COMBATSCENE_BUFFCD,this.on_buffcd),this.register_event(t.COMBATSCENE_BUFFAUTOCD,this.on_buffautocd),this.register_event(t.COMBATSCENE_WARRIORACTION,this.on_warrioraction),this.register_event(t.COMBATSCENE_WARRIORDEAD,this.on_warriordead),this.register_event(t.COMBATSCENE_WARRIORDEADVANISH,this.on_warriordeadvanish),this.register_event(t.COMBATSCENE_WARRIORFLY,this.on_warriorfly),this.register_event(t.COMBATSCENE_WARRIORREVIVE,this.on_warriorrevive),this.register_event(t.COMBATSCENE_WARRIORDEFEND,this.on_warriordefend),this.register_event(t.COMBATSCENE_WARRIORDODGE,this.on_warriordodge),this.register_event(t.COMBATSCENE_WARRIORATTACKED,this.on_warriorattacked),this.register_event(t.COMBATSCENE_WARRIORBACKMOVE,this.on_warriorbackmove),this.register_event(t.COMBATSCENE_WARRIORSETPOS,this.on_warriorsetpos),this.register_event(t.COMBATSCENE_WARRIORMOVE,this.on_warriormove),this.register_event(t.COMBATSCENE_WARRIORMOVEBACK,this.on_warriormoveback),this.register_event(t.COMBATSCENE_WARRIORMOVE2WARRIOR,this.on_warriormove2warrior),this.register_event(t.COMBATSCENE_EFFECT,this.on_effect),this.register_event(t.COMBATSCENE_EFFECT_SCREENPOS,this.on_effect_screenpos),this.register_event(t.COMBATSCENE_EFFECT2W,this.on_effect2w),this.register_event(t.COMBATSCENE_ACTIONBEGIN,this.on_actionbegin),this.register_event(t.COMBATSCENE_ACTIONEND,this.on_actionend),this.register_event(t.COMBATSCENE_WARRIORDIR,this.on_warriordir),this.register_event(t.COMBATSCENE_WARRIORDIR2W,this.on_warriordir2w),this.register_event(t.COMBATSCENE_WARRIORREADY,this.on_warriorready),this.register_event(t.COMBATSCENE_SETHP,this.on_sethp),this.register_event(t.COMBATSCENE_BLACKSCENE,this.on_blackscene),this.register_event(t.COMBATSCENE_CUSTOMEVENT,this.on_customevent)},r.prototype.on_actionend=function(t){},r.prototype.on_actionbegin=function(t){},r.prototype.clearallwarrior=function(){for(var t=0,i=this.m_waction_list;t<i.length;t++){(e=i[t]).dispose()}for(var e in this.m_waction_list.length=0,this.m_warrior_map)if(this.m_warrior_map.hasOwnProperty(e)){var _=this.m_warrior_map[e];if(null!=_){var r=this.m_render.getunit(_.roleid);null!=r&&laya.utils.Tween.clearAll(r),this.m_render.delunit(_.roleid)}}this.m_warrior_map=new Object},r.prototype.init_bk_htmlcanvas=function(t,i,e){this.clear_bk_htmlcanvas(),null!=t&&(this.m_bk_htmlcanvas=t,this.m_bk_htmltexture=new Laya.Texture(this.m_bk_htmlcanvas),this.m_bk_sp=new Laya.Sprite,this.m_bk_sp.graphics.fillTexture(this.m_bk_htmltexture,0,0,i,e,"no-repeat"))},r.prototype.clear_bk_htmlcanvas=function(){null!=this.m_bk_sp&&(this.m_bk_sp.graphics.clear(),this.m_bk_sp.destroy(!0),this.m_bk_sp=null),null!=this.m_bk_htmlcanvas&&(this.m_bk_htmlcanvas.clear(),this.m_bk_htmlcanvas.releaseResource(!0),this.m_bk_htmlcanvas.destroy(),this.m_bk_htmltexture.destroy(!0),this.m_bk_htmlcanvas=null,this.m_bk_htmltexture=null)},r.prototype.on_change_lineup=function(i){this.clear_lineupsp();var e=i[0],_=i[1],r=i[2];core.combat_tiplog("combatscene on_change_lineup ",e,_,r);var n=utils.getitembycls("combat_lineup",t.combat_lineup);n.re_init(),n.set_respath(e,_,r),n.m_obj_id=this.m_render.addsprite(n,this.m_pos_centerx,this.m_pos_centery,!1),this.m_lineupsp=n},r.prototype.clear_lineupsp=function(){null!=this.m_lineupsp&&(this.m_render.delsprite(this.m_lineupsp.m_obj_id),this.m_lineupsp.dispose(),this.m_lineupsp=null)},r.prototype.on_enter=function(t){var i=t[0],e=t[1],_=t[2],r=t[3],n=t[4],s=t[5],a=t[6];if(this.m_render.clearmapbksp(),this.m_camera_x=this.m_mw>>1,this.m_camera_y=this.m_mh>>1,this.m_pos_centerx=this.m_camera_x+this.m_pos_centerdx,this.m_pos_centery=this.m_camera_y+this.m_pos_centerdy,null!=i)this.init_bk_htmlcanvas(i,e,_),this.m_render.setmapbksp(this.m_bk_sp),this.m_bk_sp.x=this.m_camera_x-r,this.m_bk_sp.y=this.m_camera_y-n;else if(0==s)this.m_render.setmapbk(this.m_map);else{var o=null==a;this.m_render.entermap(s,o),o||this.m_render.setmapbk(a),this.m_camera_x=r,this.m_camera_y=n,this.m_pos_centerx=this.m_camera_x+this.m_pos_centerdx,this.m_pos_centery=this.m_camera_y+this.m_pos_centerdy}this._init_pos_map(),core.combat_tiplog("combatscene on_enter setcamerapos ",this.m_mw>>1,this.m_mh>>1),this.m_render.setcamerapos(this.m_camera_x,this.m_camera_y);for(var m=0,h=this.m_waction_list;m<h.length;m++){h[m].dispose()}this.m_waction_list.length=0,this.m_render.show_map_mask(!0,.5)},r.prototype.on_quit=function(t){},r.prototype.on_setadorn=function(t){var i=t[0],e=t[1],_=t[2];if(null!=this.get_warrior(i)){var r=this.get_warrior_avatar(i);if(null!=r)switch(e){case 0:r.change_shape(_);break;case 1:r.change_weapon(_);break;case 2:r.change_wing(_);break;case 3:r.change_ride(_[0],_[1]),0!=_[0]?(r.set_ride_h(30),_.length>2&&r.set_ride_h(_[2])):r.set_ride_h(30);break;case 4:r.change_hair(_);break;case 5:r.change_aura(_);break;case 6:r.change_title(_);break;case 7:var n=_;if(this.m_render.clear_all_follow(i),0!=n){var s=this.get_warrior_avatarid(i),a=this.m_render.addunit("",n,0,0);this.m_render.set_follow_id(a,s),this.m_render.getunit(a).set_dxy(0,-100)}}}},r.prototype.get_posid_bywid=function(t){var i=this.get_warrior(t);return null!=i?i.pos:t},r.prototype.on_initwarrior=function(t){var i=t;core.combat_tiplog("combatscene initwarrior ",i);for(var e=0,_=i;e<_.length;e++){var r=_[e];this.on_addwarrior(r)}},r.prototype.on_addclonewarrior=function(i){core.combat_tiplog("combatscene on_addclonewarrior ",i);var e=i.src,_=i.dst,r=i.x,n=i.y,s=i.dir;if(null!=this.get_warrior(e)){null!=this.get_warrior(_)&&this.on_delwarrior(_);var a=this.get_warrior(e),o=new t.warrior;a.clone_data(o),o.id=_,o.roleid=this._add_warrior_ins(o,r,n),this.m_warrior_map[o.id]=o;var m=this.m_render.getunit(o.roleid);m.change_action(2),m.change_dir(s)}else core.combat_errlog("on_addclonewarrior have not this warrior ",e,_)},r.prototype._add_warrior_ins=function(t,i,e){core.combat_tiplog("combatscene _add_warrior_ins ",t.id,i,e);var _=null;t.roleid=this.m_render.addunit(t.name,t.shape,i,e),(_=this.m_render.getunit(t.roleid)).set_scale(t.scale,t.scale);var r=t.m_desc[0];if(0!=r&&_.change_shape(r),0!=(r=t.m_desc[1])&&_.change_weapon(r),0!=(r=t.m_desc[2])&&_.change_wing(r),0!=(r=t.m_desc[3])){var n=this.m_render.addunit("",r,0,0);this.m_render.set_follow_id(n,t.roleid),this.m_render.getunit(n).set_dxy(0,-100)}if(0!=(r=t.m_desc[4])&&_.change_aura(r),0!=(r=t.m_desc[5])&&_.change_title(r),0!=(r=t.m_desc[6])){var s=t.m_desc[7],a=t.m_desc[8];0==a&&(a=30),_.change_ride(r,s),_.set_ride_h(a)}else _.set_ride_h(30);return t.roleid},r.prototype.on_addwarrior=function(t){var i=t,e=null;null!=this.get_warrior(i.id)&&(null!=(e=this.m_render.getunit(this.get_warrior(i.id).roleid))&&laya.utils.Tween.clearAll(e),this.m_render.delunit(this.get_warrior(i.id).roleid));var _=this.get_pos(i.pos),r=this.get_dir(i.pos);core.combat_tiplog("combatscene addwarrior ",i.id,_.x,_.y,r),i.roleid=this._add_warrior_ins(i,_.x,_.y),this.m_warrior_map[i.id]=i,this.on_warriorready({src:i.id})},r.prototype.on_delninja=function(t){var i=t;core.combat_tiplog("combatscene on_delninja ",i);for(var e=0,_=Object.keys(this.m_warrior_map);e<_.length;e++){var r=_[e];if(this.m_warrior_map.hasOwnProperty(r)){var n=parseInt(r);n>=i&&this.on_delwarrior(n)}}},r.prototype.on_delwarrior=function(t){var i=t;if(core.combat_tiplog("combatscene on_delwarrior ",i),this._del_waction_obj(i),null!=this.get_warrior(i)){var e=this.m_render.getunit(this.get_warrior(i).roleid);null!=e&&laya.utils.Tween.clearAll(e),this.m_render.delunit(this.get_warrior(i).roleid),this.m_warrior_map[i]=null}},r.prototype._add_waction_obj=function(t){return this._del_waction_obj(t.m_id),this.m_waction_list.push(t),!0},r.prototype._del_waction_obj=function(t){for(var i=0,e=0,_=this.m_waction_list;e<_.length;e++){var r=_[e];if(r.m_id==t)return r.dispose(),void this.m_waction_list.splice(i,1);i+=1}},r.prototype.on_warrioraction=function(t){var i=t.src,e=t.actionid,_=this.get_warrior_avatar(i);null!=_&&(this.m_render.unit_stop(_.m_obj_id),_.change_action(e,!1,0))},r.prototype.on_addbuff=function(t){var i=t.src,e=t.buffid,_=t.shape,r=t.buffeffid,n=t.cd,s=t.overlay,a=t.datas,o=this.get_warrior_avatar(i);if(null!=o){var m=o.get_buffui(),h=0;h=null==m.getbuff(e)?o.add_buffeff(r):m.getbuff(e).m_effid,m.addbuff(e,_,n,s,a,h)}},r.prototype.on_delbuff=function(t){var i=t.src,e=t.buffid,_=this.get_warrior_avatar(i);if(null!=_){var r=_.get_buffui(),n=r.getbuff(e);null!=n&&(_.del_buffeff(n.m_effid),r.delbuff(e))}},r.prototype.on_buffcd=function(t){var i=t.src,e=t.buffid,_=t.cd,r=this.get_warrior_avatar(i);if(null!=r){var n=r.get_buffui().getbuff(e);null!=n&&n.set_cd(_)}},r.prototype.on_buffautocd=function(t){for(var i in this.m_warrior_map)if(this.m_warrior_map.hasOwnProperty(i)){var e=this.m_warrior_map[i];if(null!=e){var _=this.m_render.getunit(e.roleid);if(null!=_)_.get_buffui().buffautocd()}}},r.prototype.on_cryout=function(t){var i=t.src,e=t.content,_=this.get_warrior_avatar(i);if(null!=_){var r=this._get_combatcryout(e);r.start();var n=_.x,s=_.y;r.m_obj_id=this.m_render.addsprite(r,n,s),this.m_cryout_list.push(r)}},r.prototype.clearallcryout=function(){for(var t=0,i=this.m_cryout_list;t<i.length;t++){var e=i[t];e.dispose(),this.m_render.delsprite(e.m_obj_id)}this.m_cryout_list.length=0},r.prototype.on_popnumber=function(i){var e=i.src,_=i.type,r=i.damage;i.crack&&(_=t.DAMAGETYPE_CRACK);var n=this.get_warrior_avatar(e);if(null!=n){var s;(s=_==t.DAMAGETYPE_CRACK?this._get_combatcrack(r,_):this._get_combatnum(r,_)).start();var a=n.x,o=n.y;s.m_obj_id=this.m_render.addsprite(s,a,o),this.m_numpic_list.push(s)}},r.prototype.on_warriorfly=function(t){var i=t.src;if(null!=this.get_warrior(i)){var e=this.get_warrior_avatar(i);if(null!=e){var r=utils.getitembycls("fly_action",_);r.re_init(),r.m_id=i,r.m_warrior=e;r.m_lt_pt.x=this.m_camera_x-this.m_view_w/2-0,r.m_lt_pt.y=this.m_camera_y-this.m_view_h/2-0,r.m_rb_pt.x=this.m_camera_x+this.m_view_w/2+0,r.m_rb_pt.y=this.m_camera_y+this.m_view_h/2+0,r.m_start_pt.x=e.x,r.m_start_pt.y=e.y,this.is_downteam(this.get_posid_bywid(i))?(r.m_from_pt.x=e.x-this.m_pos_dx,r.m_from_pt.y=e.y-this.m_pos_dy):(r.m_from_pt.x=e.x+this.m_pos_dx,r.m_from_pt.y=e.y+this.m_pos_dy),r.start(utils.get_render_milltm()),this._add_waction_obj(r)}else core.combat_errlog("combatscene on_warriorfly error!have not this role ",i)}},r.prototype.on_warriordeadvanish=function(t){var i=t.src,_=this.get_warrior(i);if(null!=_){_.b_dead=!0;var r=this.get_warrior_avatar(i);if(null!=r){var n=utils.getitembycls("dead_action",e);n.re_init(),n.m_id=i,n.m_warrior=r,n.start(utils.get_render_milltm()),this._add_waction_obj(n)}else core.combat_errlog("combatscene on_warriordeadvanish error!have not this guy!",i)}},r.prototype.on_warriordead=function(t){var i=t.src,e=this.get_warrior(i);if(null!=e){e.b_dead=!0;var _=this.get_warrior_avatar(i);null!=_?_.change_action(5,!1):core.combat_errlog("combatscene on_warriordead error!have not this guy!",i)}},r.prototype.on_warriorrevive=function(t){var i=t.src,e=this.get_warrior(i);null!=e&&(e.b_dead=!0,this.on_warriorready({src:i}))},r.prototype.on_warriordodge=function(i){var e=i.src,_=this.get_warrior_avatar(e);if(null!=_){var r=_.x,n=_.y;this.is_downteam(this.get_posid_bywid(e))?(r+=this.m_pos_dx,n+=this.m_pos_dy):(r-=this.m_pos_dx,n-=this.m_pos_dy),laya.utils.Tween.to(_,{set_x:r,set_y:n},500,laya.utils.Ease.strongOut);var s=this._get_combatnum(0,t.DAMAGETYPE_DODGE);s.start();var a=_.x-(s.m_w>>1),o=_.y-100;s.m_obj_id=this.m_render.addsprite(s,a,o),this.m_numpic_list.push(s)}},r.prototype.clearallnumpic=function(){for(var t=0,i=this.m_numpic_list;t<i.length;t++){var e=i[t];e.dispose(),this.m_render.delsprite(e.m_obj_id)}this.m_numpic_list.length=0},r.prototype.on_warriorsetpos=function(t){var i=t.src,e=t.x,_=t.y,r=this.get_warrior_avatar(i);null!=r?r.set_pos(e,_):core.combat_errlog("combatscene on_warriorsetpos error!have not this guy!",i)},r.prototype.on_warriorbackmove=function(t){var i=t.src,e=t.dst,_=this.get_warrior_avatar(i);if(null!=_){var r=_.x,n=_.y;this.is_downteam(this.get_posid_bywid(i))?(r+=this.m_pos_dx*e,n+=this.m_pos_dy*e):(r-=this.m_pos_dx*e,n-=this.m_pos_dy*e),laya.utils.Tween.to(_,{set_x:r,set_y:n},500,laya.utils.Ease.elasticOut)}else core.combat_errlog("combatscene on_warriorbackmove error!have not this guy!",i)},r.prototype.on_warriorattacked=function(t){var i=t.src,e=t.stopf,_=!0;null!=e&&null!=e&&(_=!1);var r=this.get_warrior_avatar(i);null!=r?r.change_action(4,_,e):core.combat_errlog("combatscene on_warriorattacked error!have not this guy!",i)},r.prototype.on_warriordefend=function(t){var i=t.src,e=this.get_warrior_avatar(i);null!=e&&e.change_action(6)},r.prototype.on_warriorready=function(t){var i=t.src;core.combat_tiplog("combatscene warrior ready ",i);var e=this.get_warrior_avatar(i);if(null!=e){laya.utils.Tween.clearAll(e),e.change_action(2);var _=this.get_pos(this.get_posid_bywid(i)),r=this.get_dir(this.get_posid_bywid(i));e.change_dir(r),e.set_pos(_.x,_.y)}},r.prototype.on_sethp=function(t){var i=t;core.combat_tiplog("combatscene on_sethp ",i.id,i.hp,i.hpmax);var e=this.get_warrior_avatar(i.id);null!=e&&e.set_hp(i.hp,i.hpmax)},r.prototype.on_warriormove=function(t){var i=t.src,e=t.x,_=t.y;this.m_render.unit_walk2(this.get_warrior_avatarid(i),e,_,!0,!0)},r.prototype.on_warriormoveback=function(t){var i=t.src,e=this.get_pos(this.get_posid_bywid(i));this.m_render.unit_walk2(this.get_warrior_avatarid(i),e.x,e.y,!0,!0)},r.prototype.on_warriormove2warrior=function(t){var i=t.src,e=t.dst,_=this.get_pos(this.get_posid_bywid(e));this.is_downteam(this.get_posid_bywid(i))?(_.x+=this.m_pos_dx,_.y+=this.m_pos_dy):(_.x-=this.m_pos_dx,_.y-=this.m_pos_dy),this.m_render.unit_walk2(this.get_warrior_avatarid(i),_.x,_.y,!0,!0)},r.prototype.on_warriordir2w=function(t){var i=t.src,e=t.dst,_=this.m_render.getunit(this.get_warrior_avatarid(i)),r=this.m_render.getunit(this.get_warrior_avatarid(e));if(null!=_&&null!=r){var n=utils.gendir(r.x-_.x,r.y-_.y);_.change_dir(n)}},r.prototype.on_warriordir=function(t){var i=t.src,e=t.dir,_=this.m_render.getunit(this.get_warrior_avatarid(i));null!=_&&_.change_dir(e)},r.prototype.on_effect_screenpos=function(t){var i=t.effectid,e=t.x,_=t.y,r=this.m_render.stagepos2worldpos(new Laya.Point(e,_));this.m_render.addeff(i,r.x,r.y,!1,!0)},r.prototype.on_effect=function(t){var i=t.effectid,e=t.x,_=t.y;this.m_render.addeff(i,e,_,!1,!0)},r.prototype.on_effect2w=function(t){var i=t.effectid,e=t.src,_=this.get_warrior_avatar(e);if(null!=_){var r=_.x,n=_.y;this.m_render.addeff(i,r,n,!1,!0)}},r.prototype.on_customevent=function(t){core.combat_tiplog("combatscene customevent ",t),utils.event_ins().fire_event_next_frame(t[0],t[1])},r.prototype.on_blackscene=function(t){var i=t.tm;this.m_render.blackscene(i)},r.prototype.is_downteambywid=function(t,i){var e=t;return 0!=i&&(e<=12?e+=20:e-=20),this.is_downteam(e)},r.prototype.is_downteam=function(t){return t<=12},r.prototype.mgr=function(){return this.m_combat_mgr},r.prototype.register_event=function(t,i){this.mgr().register_event(t,this),this.register_event_func(t,i)},r.prototype.unregister_event=function(t){this.mgr().unregister_event(t,this),this.unregister_event_func(t)},r.prototype.fire_event=function(t,i){void 0===i&&(i=null),this.mgr().fire_event(t,i)},r.prototype.unregister_allevent=function(){this.mgr().unregister_allevent(this),this.unregister_all_event_func()},r.prototype.fire_event_next_frame=function(t,i){void 0===i&&(i=null),this.mgr().fire_event_next_frame(t,i)},r.prototype.start=function(){},r.prototype._get_combatnum=function(i,e,_){void 0===_&&(_="");var r=utils.getitembycls("combat_number",t.combat_number);return r.re_init(i,e,_),r},r.prototype._get_combatcrack=function(i,e,_){void 0===_&&(_="");var r=utils.getitembycls("combat_crack",t.combat_crack);return r.re_init(i,e,_),r},r.prototype._get_combatcryout=function(i){void 0===i&&(i="");var e=utils.getitembycls("combat_cryout",t.combat_cryout);return e.re_init(i),e},r.prototype.clear=function(){this.clear_bk_htmlcanvas(),this.clearallwarrior();for(var t=0,i=this.m_waction_list;t<i.length;t++){i[t].dispose()}this.m_waction_list.length=0,this.clear_lineupsp(),this.clearallnumpic(),this.clearallcryout(),this.m_render.clearmapbksp(),this.m_render.clear()},r.prototype.update=function(t){this.m_tempnumpic_list.length=0;for(var i=0,e=this.m_numpic_list;i<e.length;i++){(a=e[i]).is_end()?(a.dispose(),this.m_render.delsprite(a.m_obj_id)):(a.tick(t),this.m_tempnumpic_list.push(a))}var _=this.m_numpic_list;this.m_numpic_list=this.m_tempnumpic_list,this.m_tempnumpic_list=_,this.m_tempcryout_list.length=0;for(var r=0,n=this.m_cryout_list;r<n.length;r++){(a=n[r]).is_end()?(a.dispose(),this.m_render.delsprite(a.m_obj_id)):(a.tick(t),this.m_tempcryout_list.push(a))}var s=this.m_cryout_list;this.m_cryout_list=this.m_tempcryout_list,this.m_tempcryout_list=s;for(var a=this.m_waction_list.length-1;a>=0;--a){var o=this.m_waction_list[a];o.update(t),o.is_end()&&(o.dispose(),this.m_waction_list.splice(a,1))}this.m_render.update(t)},r.prototype.render=function(){this.m_render.render()},r.prototype.dispose=function(){this.clear(),null!=this.m_render&&(this.m_render.dispose(),this.m_render=null),this.m_combat_mgr=null,i.prototype.dispose.call(this),this.unregister_allevent()},r}(utils.game_event_receiver);t.combatscene=r}(combat||(combat={}));